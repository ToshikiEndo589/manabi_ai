[{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\api\\qa\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[355,358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[355,358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[446,449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[446,449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6286,6289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6286,6289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7453,7456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7453,7456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport OpenAI from 'openai'\n\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n})\n\ntype HistoryMsg = { role: 'user' | 'assistant'; content: string; imageUrl?: string }\n\nconst buildResponsesInput = (\n  history: HistoryMsg[],\n  message?: string,\n  image?: string\n) => {\n  const input: any[] = (history || []).map((msg) => {\n    if (msg.role === 'user') {\n      const content: any[] = [{ type: 'input_text', text: msg.content }]\n      if (msg.imageUrl) {\n        content.push({ type: 'input_image', image_url: msg.imageUrl, detail: 'auto' })\n      }\n      return {\n        role: 'user',\n        content,\n      }\n    }\n    return {\n      role: 'assistant',\n      content: [{ type: 'output_text', text: msg.content }],\n    }\n  })\n\n  if (image) {\n    input.push({\n      role: 'user',\n      content: [\n        {\n          type: 'input_text',\n          text: message || 'この画像について具体的に説明してください。',\n        },\n        {\n          type: 'input_image',\n          image_url: image, // URL でも data URL でもOK\n          detail: 'auto', // 'low' | 'high' | 'auto'\n        },\n      ],\n    })\n  } else {\n    input.push({\n      role: 'user',\n      content: [{ type: 'input_text', text: message || '' }],\n    })\n  }\n\n  return input\n}\n\nconst formatMathResponse = (text: string): string => {\n  let out = text\n\n  // ¥/¥¥ を \\\\ に変換（日本語キーボードのバックスラッシュ問題を解決）\n  out = out.replace(/¥+/g, '\\\\\\\\')\n\n  // LaTeX記法をMarkdown形式に変換（数式はすべてブロック $$ $$ に統一）\n  // \\( \\) をブロック数式に変換\n  out = out.replace(/\\\\\\(([\\s\\S]*?)\\\\\\)/g, (_match, content) => `\\n\\n$$${content}$$\\n\\n`)\n\n  // \\[ \\] をブロック数式に変換\n  out = out.replace(/\\\\\\[(?:\\s*\\n)?([\\s\\S]*?)(?:\\s*\\n)?\\\\\\]/g, '\\n\\n$$$1$$\\n\\n')\n\n  // 単独の $...$ を $$...$$ に統一（同一行内のみ）\n  // ただし日本語を含む場合は数式として扱わず $ を外す\n  out = out.replace(/(^|[^$])\\$(?!\\$)([^\\n$]+)\\$(?!\\$)/g, (_m, prefix, content) => {\n    const hasJapanese = /[\\u3040-\\u30ff\\u4e00-\\u9faf]/.test(content)\n    if (hasJapanese) {\n      return `${prefix}${content}`\n    }\n    return `${prefix}\\n\\n$$${content}$$\\n\\n`\n  })\n\n  // 囲まれていないcases環境を検出してブロック数式に変換\n  out = out.replace(/(\\\\begin\\{cases\\}[\\s\\S]*?\\\\end\\{cases\\})/g, (match) => {\n    if (!match.includes('\\\\(') && !match.includes('\\\\[') && !match.includes('$$')) {\n      return `\\n\\n$$${match}$$\\n\\n`\n    }\n    return match\n  })\n\n  // cases環境の区切りを補正（「;」「；」「、」を行区切りにする）\n  out = out.replace(/\\\\begin\\{cases\\}([\\s\\S]*?)\\\\end\\{cases\\}/g, (_match, content) => {\n    const fixed = content\n      // 日本語キーボード由来の \"\\;\" を改行扱いにする\n      .replace(/\\\\\\s*;/g, '\\\\\\\\')\n      // カンマ区切りも改行扱いにする\n      .replace(/,\\s*/g, '\\\\\\\\')\n      .replace(/；\\s*/g, '\\\\\\\\')\n      .replace(/;\\s*/g, '\\\\\\\\')\n      .replace(/、\\s*/g, '\\\\\\\\')\n    return `\\\\begin{cases}${fixed}\\\\end{cases}`\n  })\n\n  // $$$$ / $$$ を $$ に正規化\n  out = out.replace(/\\$\\$\\$\\$+/g, '$$')\n  out = out.replace(/\\$\\$\\$+/g, '$$')\n\n  // $$...$$ をブロック数式として独立行に強制\n  // 日本語が含まれる場合は数式として扱わず $$ を外す\n  out = out.replace(/\\$\\$([\\s\\S]*?)\\$\\$/g, (_match, content) => {\n    const trimmed = String(content).trim()\n    const hasJapanese = /[\\u3040-\\u30ff\\u4e00-\\u9faf]/.test(trimmed)\n    if (hasJapanese) {\n      return `\\n\\n${trimmed}\\n\\n`\n    }\n    return `\\n\\n$$\\n${trimmed}\\n$$\\n\\n`\n  })\n\n  // 既に$$で囲まれているcases環境の¥¥を\\\\に変換\n  out = out.replace(/\\$\\$([\\s\\S]*?)\\$\\$/g, (match, content) => {\n    if (content.includes('\\\\begin{cases}') || content.includes('cases')) {\n      const fixed = content.replace(/¥¥/g, '\\\\\\\\')\n      return `$$${fixed}$$`\n    }\n    return match\n  })\n\n  // 孤立した $（単独行や余分な閉じ$）を除去\n  out = out.replace(/^\\s*\\$\\s*$/gm, '')\n  out = out.replace(/\\n\\s*\\$\\s*$/gm, '\\n')\n  out = out.replace(/\\n{3,}/g, '\\n\\n').trim()\n\n  // 見出しの整理（ただし、LaTeXコマンドを含む行は除外）\n  out = out.replace(/^.*解説して.*$/m, (match) => {\n    if (/\\\\[a-zA-Z]+\\{/.test(match) || /\\\\[a-zA-Z]+/.test(match)) return match\n    return '## 問題'\n  })\n  out = out.replace(/^\\s*解説\\s*$/m, (match) => {\n    if (/\\\\[a-zA-Z]+\\{/.test(match) || /\\\\[a-zA-Z]+/.test(match)) return match\n    return '## 解法'\n  })\n  out = out.replace(/^\\s*ステップ\\d+[:：]\\s*/gm, (match) => {\n    if (/\\\\[a-zA-Z]+\\{/.test(match) || /\\\\[a-zA-Z]+/.test(match)) return match\n    return '- '\n  })\n  \n  if (!/^\\s*ポイント\\s*$/m.test(out)) {\n    out = out.replace(\n      /^\\s*解法\\s*$/m,\n      (match) => {\n        if (/\\\\[a-zA-Z]+\\{/.test(match) || /\\\\[a-zA-Z]+/.test(match)) return match\n        return '## ポイント\\n- 最大値条件と範囲条件を確認\\n\\n## 解法'\n      }\n    )\n  }\n  \n  // 見出しの正規化（Markdown形式に、ただしLaTeXコマンドを含む行は除外）\n  out = out.replace(/^\\s*問題\\s*$/m, (match) => {\n    if (/\\\\[a-zA-Z]+\\{/.test(match) || /\\\\[a-zA-Z]+/.test(match)) return match\n    return '## 問題'\n  })\n  out = out.replace(/^\\s*ポイント\\s*$/m, (match) => {\n    if (/\\\\[a-zA-Z]+\\{/.test(match) || /\\\\[a-zA-Z]+/.test(match)) return match\n    return '## ポイント'\n  })\n  out = out.replace(/^\\s*解法\\s*$/m, (match) => {\n    if (/\\\\[a-zA-Z]+\\{/.test(match) || /\\\\[a-zA-Z]+/.test(match)) return match\n    return '## 解法'\n  })\n  out = out.replace(/^\\s*結論\\s*$/m, (match) => {\n    if (/\\\\[a-zA-Z]+\\{/.test(match) || /\\\\[a-zA-Z]+/.test(match)) return match\n    return '## 結論'\n  })\n  \n  // 箇条書きの整形\n  out = out.replace(/^\\s*-\\s+/gm, '- ')\n  \n  // 余計な空行を整形\n  out = out.replace(/\\n{3,}/g, '\\n\\n').trim()\n  \n  return out\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { message, image, history } = await request.json()\n\n    if (!message && !image) {\n      return NextResponse.json(\n        { error: 'メッセージまたは画像が必要です' },\n        { status: 400 }\n      )\n    }\n\n    const systemPromptBase =\n      'あなたは受験生向けの学習サポートAIです。' +\n      '数式はLaTeX記法で記述し、すべての数式を必ずブロック数式（$$ ... $$）として単独行で示してください。' +\n      'インライン数式は使わず、数式を文中に混ぜないでください。' +\n      '見出しはMarkdown形式（## 見出し）を使用してください。' +\n      'cases環境や長い式は必ず $$ ... $$ で囲み、途中で改行しても構いません。'\n    const systemPrompt = image\n      ? `${systemPromptBase} 画像がある場合は必ず画像内容に言及してください。`\n      : systemPromptBase\n\n    // モデルは標準的な gpt-4o を使用します（gpt-5 はまだ一般公開されていないAPIの可能性があります）\n    const model = 'gpt-4o'\n    \n    // 会話履歴を最新3件に制限（コスト削減）\n    const limitedHistory = (history || []).slice(-3)\n    const input = buildResponsesInput(limitedHistory, message, image)\n\n    // system message を messages 配列の先頭に追加\n    const messages = [\n        { role: 'system', content: systemPrompt },\n        ...input\n    ]\n\n    const completion = await openai.chat.completions.create({\n      model,\n      messages: messages as any, // buildResponsesInput の戻り値の型合わせ\n      max_tokens: 2000,\n    })\n\n    // トークン数の取得とコスト計算\n    const usage = completion.usage || {}\n    const inputTokens = usage.prompt_tokens || 0\n    const outputTokens = usage.completion_tokens || 0\n    \n    // Cost calculation (approximate for gpt-4o)\n    // Input: $5.00 / 1M tokens, Output: $15.00 / 1M tokens\n    const INPUT_RATE = 5.00 / 1_000_000\n    const OUTPUT_RATE = 15.00 / 1_000_000\n    \n    const cost = \n      inputTokens * INPUT_RATE +\n      outputTokens * OUTPUT_RATE\n    \n    // ログ出力\n    console.log('=== OpenAI API Usage ===')\n    console.log(`Input tokens: ${inputTokens.toLocaleString()}`)\n    console.log(`Output tokens: ${outputTokens.toLocaleString()}`)\n    console.log(`Total tokens: ${(inputTokens + outputTokens).toLocaleString()}`)\n    console.log(`Estimated cost: $${cost.toFixed(6)} (約¥${(cost * 150).toFixed(2)})`)\n    console.log('=======================')\n\n    const extractedText = completion.choices[0]?.message?.content?.trim()\n\n    const response =\n      extractedText || '出力が途中で打ち切られました。もう一度送ってください。'\n\n    return NextResponse.json({ response: formatMathResponse(response) })\n  } catch (error: any) {\n    console.error('OpenAI API Error:', error)\n    return NextResponse.json(\n      { error: error.message || 'AIからの応答を取得できませんでした' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\api\\quiz\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1887,1890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1887,1890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1935,1938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1935,1938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1986,1989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1986,1989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":77,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2582,2585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2582,2585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport OpenAI from 'openai'\n\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n})\n\ntype QuizQuestion = {\n  question: string\n  choices: string[]\n  correct_index: number\n  explanation?: string\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { note, count, difficulty } = await req.json()\n    const questionCount = Number.isFinite(count) ? Math.min(Math.max(count, 1), 5) : 3\n    const normalizedDifficulty =\n      difficulty === 'easy' || difficulty === 'normal' || difficulty === 'hard'\n        ? difficulty\n        : 'normal'\n    const difficultyText =\n      normalizedDifficulty === 'easy'\n        ? '易しい（基本・基礎中心）'\n        : normalizedDifficulty === 'hard'\n          ? '難しい（応用・ひっかけ含む）'\n          : '普通（標準レベル）'\n\n    if (!note || typeof note !== 'string' || note.trim().length === 0) {\n      return NextResponse.json({ error: 'note is required' }, { status: 400 })\n    }\n\n    const instructions =\n      'あなたは受験生向けの復習クイズ作成AIです。' +\n      'ユーザーの学習内容から4択問題を作成してください。' +\n      `難易度は${difficultyText}に合わせてください。` +\n      '必ずJSONのみで出力し、形式は次の通りです。' +\n      '{\"questions\":[{\"question\":\"...\",\"choices\":[\"...\",\"...\",\"...\",\"...\"],\"correct_index\":0,\"explanation\":\"...\"}]}' +\n      'choicesは必ず4つ、correct_indexは0-3の整数、explanationは簡潔に。'\n\n    const completion = await openai.responses.create({\n      model: 'gpt-5',\n      instructions,\n      input: [\n        {\n          role: 'user',\n          content: [\n            {\n              type: 'input_text',\n              text: `学習内容:\\n${note}\\n\\n問題数:${questionCount}\\n難易度:${difficultyText}`,\n            },\n          ],\n        },\n      ],\n      max_output_tokens: 700,\n      reasoning: { effort: 'minimal' },\n      text: { verbosity: 'low' },\n    })\n\n    const extractedText =\n      completion.output_text?.trim() ||\n      completion.output\n        ?.flatMap((item: any) => item.content || [])\n        .filter((c: any) => c.type === 'output_text')\n        .map((c: any) => c.text)\n        .join('\\n')\n        .trim()\n\n    if (!extractedText) {\n      return NextResponse.json({ error: 'empty response' }, { status: 500 })\n    }\n\n    let parsed: { questions: QuizQuestion[] }\n    try {\n      parsed = JSON.parse(extractedText)\n    } catch (error) {\n      return NextResponse.json({ error: 'invalid json' }, { status: 500 })\n    }\n\n    const questions = (parsed.questions || [])\n      .filter((q) => q && Array.isArray(q.choices) && q.choices.length === 4)\n      .map((q) => ({\n        question: String(q.question || '').trim(),\n        choices: q.choices.map((c: any) => String(c)),\n        correct_index: Number(q.correct_index ?? 0),\n        explanation: String(q.explanation || '').trim() || undefined,\n      }))\n      .filter((q) => q.question && q.correct_index >= 0 && q.correct_index < 4)\n\n    return NextResponse.json({ questions })\n  } catch (error) {\n    console.error('Quiz API error:', error)\n    return NextResponse.json({ error: 'server error' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\app\\home\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\app\\log\\page-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'startEditLog' is assigned a value but never used.","line":305,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":305,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updated' is assigned a value but never used.","line":413,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":413,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":453,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13924,13927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13924,13927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'deleteLog' is assigned a value but never used.","line":459,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":459,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":478,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":478,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14551,14554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14551,14554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":503,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":503,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15187,15190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15187,15190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":777,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":777,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23349,23352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23349,23352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport dynamic from 'next/dynamic'\nimport { createClient } from '@/lib/supabase/client'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { getTodayStart, getThisMonthStart, getWeekStart, getMonthStart, isInPeriod, getStudyDay, getStudyDayDate } from '@/lib/date-utils'\nimport { getMaterialColor } from '@/lib/color-utils'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Plus, Share2 } from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport type { StudyLog, ReferenceBook, Profile } from '@/types/database'\n\nconst CategoryStackedChart = dynamic(\n  () => import('@/components/category-stacked-chart').then((mod) => mod.CategoryStackedChart),\n  {\n    ssr: false,\n    loading: () => <div className=\"text-sm text-muted-foreground\">グラフを読み込み中...</div>,\n  }\n)\n\nconst ReferenceBookChart = dynamic(\n  () => import('@/components/reference-book-chart').then((mod) => mod.ReferenceBookChart),\n  {\n    ssr: false,\n    loading: () => (\n      <div className=\"text-center py-6 text-muted-foreground\">グラフを読み込み中...</div>\n    ),\n  }\n)\n\nexport function LogPageClient() {\n  const getLocalDateString = () => {\n    const now = new Date()\n    const year = now.getFullYear()\n    const month = String(now.getMonth() + 1).padStart(2, '0')\n    const day = String(now.getDate()).padStart(2, '0')\n    return `${year}-${month}-${day}`\n  }\n\n  const [studyLogs, setStudyLogs] = useState<StudyLog[]>([])\n  const [referenceBooks, setReferenceBooks] = useState<ReferenceBook[]>([])\n  const [profile, setProfile] = useState<Profile | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const [showPastGoals, setShowPastGoals] = useState(false)\n  const [todayMinutes, setTodayMinutes] = useState(0)\n  const [thisMonthMinutes, setThisMonthMinutes] = useState(0)\n  const [totalMinutes, setTotalMinutes] = useState(0)\n  const [showManualInput, setShowManualInput] = useState(false)\n  const [selectedBookId, setSelectedBookId] = useState<string | null>(null)\n  const [manualMinutes, setManualMinutes] = useState('')\n  const [manualDate, setManualDate] = useState(getLocalDateString())\n  const [manualNotes, setManualNotes] = useState<string[]>([''])\n  const [attachNoteToExisting, setAttachNoteToExisting] = useState(false)\n  const [isSaving, setIsSaving] = useState(false)\n  const [materialRangeType, setMaterialRangeType] = useState<'day' | 'week' | 'month' | 'total'>('day')\n  const [dailyIndex, setDailyIndex] = useState(0)\n  const [weeklyIndex, setWeeklyIndex] = useState(0)\n  const [monthlyIndex, setMonthlyIndex] = useState(0)\n  const [weekOffset, setWeekOffset] = useState(1)\n  const [monthOffset, setMonthOffset] = useState(1)\n  const [editingLogId, setEditingLogId] = useState<string | null>(null)\n  const [editBookId, setEditBookId] = useState<string | null>(null)\n  const [editSubject, setEditSubject] = useState('')\n  const [editMinutes, setEditMinutes] = useState('')\n  const [editDate, setEditDate] = useState(getLocalDateString())\n  const [editNote, setEditNote] = useState('')\n  const [showEditLogs, setShowEditLogs] = useState(false)\n  const [showMemoLogs, setShowMemoLogs] = useState(false)\n  const [editingGroupIds, setEditingGroupIds] = useState<string[]>([])\n\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        const supabase = createClient()\n        const {\n          data: { user },\n        } = await supabase.auth.getUser()\n\n        if (!user) return\n\n        // 学習記録、参考書、プロフィールを同時に取得\n        const [logsResult, booksResult, profileResult] = await Promise.all([\n          supabase\n            .from('study_logs')\n            .select('*')\n            .eq('user_id', user.id)\n            .order('started_at', { ascending: false }),\n          supabase\n            .from('reference_books')\n            .select('*')\n            .eq('user_id', user.id)\n            .is('deleted_at', null)\n            .order('created_at', { ascending: false }),\n          supabase\n            .from('profiles')\n            .select('*')\n            .eq('user_id', user.id)\n            .single(),\n        ])\n\n        if (logsResult.error) throw logsResult.error\n        if (booksResult.error) throw booksResult.error\n\n        const logs = logsResult.data || []\n        const books = booksResult.data || []\n        setReferenceBooks(books)\n        if (profileResult.data) {\n          setProfile(profileResult.data)\n        }\n        applyLogs(logs)\n      } catch (error) {\n        console.error('Failed to load study logs:', error)\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    loadData()\n\n    // 定期的にデータを更新（3秒ごと）\n    const interval = setInterval(loadData, 3000)\n    \n    // カスタムイベントでデータ更新を通知\n    const handleStudyLogSaved = () => {\n      loadData()\n    }\n    window.addEventListener('studyLogSaved', handleStudyLogSaved)\n    \n    return () => {\n      clearInterval(interval)\n      window.removeEventListener('studyLogSaved', handleStudyLogSaved)\n    }\n  }, [])\n\n  const formatTime = (minutes: number): string => {\n    const hours = Math.floor(minutes / 60)\n    const mins = minutes % 60\n    if (hours > 0 && mins > 0) {\n      return `${hours}時間${mins}分`\n    } else if (hours > 0) {\n      return `${hours}時間`\n    } else {\n      return `${mins}分`\n    }\n  }\n\n  const applyLogs = (logs: StudyLog[]) => {\n    setStudyLogs(logs)\n    const todayStart = getTodayStart()\n    const monthStart = getThisMonthStart()\n\n    const today = logs\n      .filter((log) => {\n        const logDate = new Date(log.started_at)\n        return isInPeriod(logDate, todayStart)\n      })\n      .reduce((sum, log) => sum + log.study_minutes, 0)\n\n    const thisMonth = logs\n      .filter((log) => {\n        const logDate = new Date(log.started_at)\n        return isInPeriod(logDate, monthStart)\n      })\n      .reduce((sum, log) => sum + log.study_minutes, 0)\n\n    const total = logs.reduce((sum, log) => sum + log.study_minutes, 0)\n\n    setTodayMinutes(today)\n    setThisMonthMinutes(thisMonth)\n    setTotalMinutes(total)\n  }\n\n  const getMinutesInRange = (start: Date, end: Date): number => {\n    return studyLogs\n      .filter((log) => {\n        const logDate = new Date(log.started_at)\n        return logDate >= start && logDate < end\n      })\n      .reduce((sum, log) => sum + log.study_minutes, 0)\n  }\n\n  const getWeekLabel = (offset: number) => {\n    if (offset === 1) return '先週'\n    return `${offset}週間前`\n  }\n\n  const getMonthLabel = (offset: number) => {\n    if (offset === 1) return '先月'\n    return `${offset}ヶ月前`\n  }\n\n  const getDayLabel = (offset: number) => {\n    if (offset === 0) return '今日'\n    if (offset === 1) return '昨日'\n    return `${offset}日前`\n  }\n\n  const getDayRange = (offset: number) => {\n    const todayStart = getTodayStart()\n    const start = new Date(todayStart)\n    start.setDate(start.getDate() - offset)\n    const end = new Date(start)\n    end.setDate(end.getDate() + 1)\n    return { start, end }\n  }\n\n  const getWeekRangeFromIndex = (index: number) => {\n    const start = getWeekStart(index)\n    const end = new Date(start)\n    end.setDate(end.getDate() + 7)\n    return { start, end }\n  }\n\n  const getMonthRangeFromIndex = (index: number) => {\n    const start = getMonthStart(-index)\n    const end = getMonthStart(-index + 1)\n    return { start, end }\n  }\n\n  const getWeekRange = (offset: number) => {\n    const start = getWeekStart(offset)\n    const end = new Date(start)\n    end.setDate(end.getDate() + 7)\n    return { start, end }\n  }\n\n  const weekRange = getWeekRange(weekOffset)\n  const weekMinutes = getMinutesInRange(weekRange.start, weekRange.end)\n\n  const currentWeekRange = getWeekRange(0)\n  const currentWeekMinutes = getMinutesInRange(currentWeekRange.start, currentWeekRange.end)\n\n  const monthRange = getMonthRangeFromIndex(monthOffset)\n  const monthMinutes = getMinutesInRange(monthRange.start, monthRange.end)\n\n  const logsWithNotes = studyLogs.filter((log) => log.note && log.note.trim().length > 0)\n  const groupedEditLogs = (() => {\n    const groups = new Map<\n      string,\n      {\n        ids: string[]\n        subject: string\n        reference_book_id: string | null\n        started_at: string\n        study_minutes: number\n        note: string | null\n        studyDay: string\n      }\n    >()\n\n    studyLogs.forEach((log) => {\n      const studyDay = getStudyDay(new Date(log.started_at))\n      const keyBase = log.reference_book_id ? `book:${log.reference_book_id}` : `subject:${log.subject}`\n      const key = `${studyDay}::${keyBase}`\n      const existing = groups.get(key)\n      if (!existing) {\n        groups.set(key, {\n          ids: [log.id],\n          subject: log.subject,\n          reference_book_id: log.reference_book_id || null,\n          started_at: log.started_at,\n          study_minutes: log.study_minutes,\n          note: log.note || null,\n          studyDay,\n        })\n      } else {\n        existing.ids.push(log.id)\n        existing.study_minutes += log.study_minutes\n        if (log.note && log.note.trim()) {\n          existing.note = existing.note\n            ? `${existing.note}\\n\\n${log.note.trim()}`\n            : log.note.trim()\n        }\n      }\n    })\n\n    return Array.from(groups.values())\n  })()\n\n  const handleToggleManualInput = () => {\n    if (!showManualInput) {\n      setManualDate(getLocalDateString())\n    }\n    setShowManualInput(!showManualInput)\n  }\n\n  const handleToggleEditLogs = () => {\n    if (editingLogId) {\n      cancelEditLog()\n    }\n    setShowEditLogs(!showEditLogs)\n  }\n\n  const toLocalDateInput = (dateStr: string) => {\n    const date = new Date(dateStr)\n    const year = date.getFullYear()\n    const month = String(date.getMonth() + 1).padStart(2, '0')\n    const day = String(date.getDate()).padStart(2, '0')\n    return `${year}-${month}-${day}`\n  }\n\n  const startEditLog = (log: StudyLog) => {\n    setEditingLogId(log.id)\n    setEditingGroupIds([log.id])\n    setEditBookId(log.reference_book_id || null)\n    setEditSubject(log.subject)\n    setEditMinutes(String(log.study_minutes))\n    setEditDate(toLocalDateInput(log.started_at))\n    setEditNote(log.note || '')\n  }\n\n  const startEditGroup = (group: {\n    ids: string[]\n    subject: string\n    reference_book_id: string | null\n    started_at: string\n    study_minutes: number\n    note: string | null\n    studyDay: string\n  }) => {\n    const representativeId = group.ids[0]\n    setEditingLogId(representativeId)\n    setEditingGroupIds(group.ids)\n    setEditBookId(group.reference_book_id || null)\n    setEditSubject(group.subject)\n    setEditMinutes(String(group.study_minutes))\n    setEditDate(group.studyDay)\n    setEditNote(group.note || '')\n  }\n\n  const cancelEditLog = () => {\n    setEditingLogId(null)\n    setEditBookId(null)\n    setEditSubject('')\n    setEditMinutes('')\n    setEditDate(getLocalDateString())\n    setEditNote('')\n    setEditingGroupIds([])\n  }\n\n  const getManualNoteValue = () => {\n    return manualNotes\n      .map((note) => note.trim())\n      .filter(Boolean)\n      .map((note) => `・${note}`)\n      .join('\\n')\n  }\n\n  const ensureReviewTasks = async (\n    supabase: ReturnType<typeof createClient>,\n    userId: string,\n    studyLogId: string,\n    startedAt: string,\n    note: string\n  ) => {\n    if (!note.trim()) return\n    const { data: existing } = await supabase\n      .from('review_tasks')\n      .select('id')\n      .eq('study_log_id', studyLogId)\n      .limit(1)\n\n    if (existing && existing.length > 0) return\n\n    const baseDate = new Date(startedAt)\n    baseDate.setHours(12, 0, 0, 0)\n    const reviewDays = [1, 3, 7, 14, 30]\n    const tasks = reviewDays.map((days) => {\n      const due = new Date(baseDate)\n      due.setDate(due.getDate() + days)\n      return {\n        user_id: userId,\n        study_log_id: studyLogId,\n        due_at: due.toISOString(),\n        status: 'pending',\n      }\n    })\n    const { error } = await supabase.from('review_tasks').insert(tasks)\n    if (error) {\n      console.warn('Failed to create review tasks:', error)\n    }\n  }\n\n  const saveEditLog = async () => {\n    if (!editingLogId) return\n    const minutes = parseInt(editMinutes)\n    if (isNaN(minutes) || minutes < 1) {\n      alert('1分以上の学習時間を入力してください')\n      return\n    }\n    const inputDate = new Date(editDate)\n    inputDate.setHours(12, 0, 0, 0)\n    const startedAt = inputDate.toISOString()\n    const selectedBook = referenceBooks.find((b) => b.id === editBookId)\n    const subject = selectedBook?.name?.trim() || editSubject.trim() || 'その他'\n\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n\n      if (!user) {\n        alert('ログインが必要です')\n        return\n      }\n\n      const noteValue = editNote.trim() || null\n\n      const { data: updated, error } = await supabase\n        .from('study_logs')\n        .update({\n          subject,\n          reference_book_id: editBookId || null,\n          study_minutes: minutes,\n          started_at: startedAt,\n          note: noteValue,\n        })\n        .eq('id', editingLogId)\n        .select()\n\n      if (error) throw error\n\n      await ensureReviewTasks(supabase, user.id, editingLogId, startedAt, editNote)\n\n      if (editingGroupIds.length > 1) {\n        const idsToDelete = editingGroupIds.filter((id) => id !== editingLogId)\n        if (idsToDelete.length > 0) {\n          const { error: deleteError } = await supabase\n            .from('study_logs')\n            .delete()\n            .in('id', idsToDelete)\n          if (deleteError) {\n            console.warn('Failed to delete merged logs:', deleteError)\n          }\n        }\n      }\n\n      // 最新のデータを再取得\n      const { data: logsData } = await supabase\n        .from('study_logs')\n        .select('*')\n        .order('started_at', { ascending: false })\n\n      if (logsData) {\n        applyLogs(logsData)\n      }\n\n      cancelEditLog()\n    } catch (err: any) {\n      console.error('Update study log error:', err)\n      alert(err.message || '更新に失敗しました。もう一度お試しください。')\n    }\n  }\n\n  const deleteLog = async (logId: string) => {\n    if (!confirm('この学習記録を削除しますか？')) return\n    try {\n      const supabase = createClient()\n      const { error } = await supabase\n        .from('study_logs')\n        .delete()\n        .eq('id', logId)\n\n      if (error) throw error\n\n      const { data: logsData } = await supabase\n        .from('study_logs')\n        .select('*')\n        .order('started_at', { ascending: false })\n\n      if (logsData) {\n        applyLogs(logsData)\n      }\n    } catch (err: any) {\n      console.error('Delete study log error:', err)\n      alert(err.message || '削除に失敗しました。もう一度お試しください。')\n    }\n  }\n\n  const deleteLogGroup = async (logIds: string[]) => {\n    if (!confirm('この学習記録を削除しますか？')) return\n    try {\n      const supabase = createClient()\n      const { error } = await supabase\n        .from('study_logs')\n        .delete()\n        .in('id', logIds)\n\n      if (error) throw error\n\n      const { data: logsData } = await supabase\n        .from('study_logs')\n        .select('*')\n        .order('started_at', { ascending: false })\n\n      if (logsData) {\n        applyLogs(logsData)\n      }\n    } catch (err: any) {\n      console.error('Delete study log error:', err)\n      alert(err.message || '削除に失敗しました。もう一度お試しください。')\n    }\n  }\n\n  const buildShareText = () => {\n    return `今日の学習: ${formatTime(todayMinutes)} / 今月: ${formatTime(thisMonthMinutes)} / 累計: ${formatTime(totalMinutes)}`\n  }\n\n  const shareUrl = typeof window !== 'undefined' ? window.location.origin : ''\n\n  const shareLinks = {\n    x: `https://twitter.com/intent/tweet?text=${encodeURIComponent(buildShareText())}&url=${encodeURIComponent(shareUrl)}`,\n  }\n\n  const getLocalDateStringFromDate = (date: Date) => {\n    const year = date.getFullYear()\n    const month = String(date.getMonth() + 1).padStart(2, '0')\n    const day = String(date.getDate()).padStart(2, '0')\n    return `${year}-${month}-${day}`\n  }\n\n  const getDailyTargetForDate = (date: Date, profile: Profile | null): number => {\n    if (!profile) return 60\n    const day = date.getDay()\n    const isWeekend = day === 0 || day === 6\n    const defaultTarget = isWeekend\n      ? profile.weekend_target_minutes ?? 120\n      : profile.weekday_target_minutes ?? 60\n\n    const dateString = getLocalDateStringFromDate(date)\n    if (profile.today_target_date === dateString && profile.today_target_minutes) {\n      return profile.today_target_minutes\n    }\n\n    return defaultTarget\n  }\n\n  const getWeekTarget = (weekStart: Date, profile: Profile | null): number => {\n    if (!profile) return 420 // デフォルト60分×7日\n    const weekStartDateString = getLocalDateStringFromDate(weekStart)\n    if (profile.week_target_date === weekStartDateString && profile.week_target_minutes) {\n      return profile.week_target_minutes\n    }\n    // 週の目標がない場合は、日ごとの目標を合計\n    let total = 0\n    const cursor = new Date(weekStart)\n    for (let i = 0; i < 7; i++) {\n      total += getDailyTargetForDate(cursor, profile)\n      cursor.setDate(cursor.getDate() + 1)\n    }\n    return total\n  }\n\n  const getMonthTarget = (monthStart: Date, profile: Profile | null): number => {\n    if (!profile) return 1800 // デフォルト60分×30日\n    const monthStartDateString = getLocalDateStringFromDate(monthStart)\n    if (profile.month_target_date === monthStartDateString && profile.month_target_minutes) {\n      return profile.month_target_minutes\n    }\n    // 月の目標がない場合は、日ごとの目標を合計\n    let total = 0\n    const cursor = new Date(monthStart)\n    const end = new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 1)\n    while (cursor < end) {\n      total += getDailyTargetForDate(cursor, profile)\n      cursor.setDate(cursor.getDate() + 1)\n    }\n    return total\n  }\n\n  const getPastGoalsData = () => {\n    if (!profile) return { days: [], weeks: [], months: [] }\n\n    const days = []\n    for (let i = 1; i <= 30; i++) {\n      const date = new Date()\n      date.setDate(date.getDate() - i)\n      const dayStart = new Date(date)\n      dayStart.setHours(3, 0, 0, 0)\n      const dayEnd = new Date(dayStart)\n      dayEnd.setDate(dayEnd.getDate() + 1)\n\n      const target = getDailyTargetForDate(date, profile)\n      const actual = getMinutesInRange(dayStart, dayEnd)\n      const progress = Math.min(100, Math.round((actual / Math.max(1, target)) * 100))\n\n      days.push({\n        date: date,\n        target,\n        actual,\n        progress,\n      })\n    }\n\n    const weeks = []\n    for (let i = 1; i <= 12; i++) {\n      const weekStart = getWeekStart(i)\n      const weekEnd = new Date(weekStart)\n      weekEnd.setDate(weekEnd.getDate() + 7)\n\n      const target = getWeekTarget(weekStart, profile)\n      const actual = getMinutesInRange(weekStart, weekEnd)\n      const progress = Math.min(100, Math.round((actual / Math.max(1, target)) * 100))\n\n      weeks.push({\n        weekStart,\n        target,\n        actual,\n        progress,\n      })\n    }\n\n    const months = []\n    for (let i = 1; i <= 12; i++) {\n      const monthStart = getMonthStart(-i)\n      const monthEnd = getMonthStart(-i + 1)\n\n      const target = getMonthTarget(monthStart, profile)\n      const actual = getMinutesInRange(monthStart, monthEnd)\n      const progress = Math.min(100, Math.round((actual / Math.max(1, target)) * 100))\n\n      months.push({\n        monthStart,\n        target,\n        actual,\n        progress,\n      })\n    }\n\n    return { days, weeks, months }\n  }\n\n  const handleManualSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (attachNoteToExisting) {\n      if (!manualDate) {\n        alert('日付を入力してください')\n        return\n      }\n      const noteValue = getManualNoteValue()\n      if (!noteValue) {\n        alert('勉強内容を入力してください')\n        return\n      }\n    } else {\n      if (!selectedBookId || !manualDate) {\n        alert('教材と日付を入力してください')\n        return\n      }\n      if (!manualMinutes) {\n        alert('学習時間を入力してください')\n        return\n      }\n    }\n\n    setIsSaving(true)\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n\n      if (!user) {\n        alert('ログインが必要です')\n        return\n      }\n\n      if (attachNoteToExisting) {\n        const dateStart = new Date(manualDate)\n        dateStart.setHours(3, 0, 0, 0)\n        const dateEnd = new Date(dateStart)\n        dateEnd.setDate(dateEnd.getDate() + 1)\n\n        let query = supabase\n          .from('study_logs')\n          .select('id, note, started_at')\n          .eq('user_id', user.id)\n          .gte('started_at', dateStart.toISOString())\n          .lt('started_at', dateEnd.toISOString())\n          .order('started_at', { ascending: false })\n          .limit(1)\n\n        if (selectedBookId) {\n          query = query.eq('reference_book_id', selectedBookId)\n        }\n\n        const { data: existingLogs, error: existingError } = await query\n\n        if (existingError) throw existingError\n\n        const existing = existingLogs?.[0]\n        if (!existing) {\n          alert('指定した日の学習記録が見つかりませんでした。時間を入力して新規で保存してください。')\n          return\n        }\n\n        const noteValue = getManualNoteValue()\n        const newNote = existing.note ? `${existing.note}\\n\\n${noteValue}` : noteValue\n\n        const { error: updateError } = await supabase\n          .from('study_logs')\n          .update({ note: newNote })\n          .eq('id', existing.id)\n\n        if (updateError) throw updateError\n\n        await ensureReviewTasks(supabase, user.id, existing.id, existing.started_at, noteValue)\n      } else {\n        const minutes = parseInt(manualMinutes)\n        if (isNaN(minutes) || minutes < 1) {\n          alert('1分以上の学習時間を入力してください')\n          return\n        }\n\n      const selectedBook = referenceBooks.find((b) => b.id === selectedBookId)\n      const subject = selectedBook?.name?.trim() || 'その他'\n\n      if (!subject || subject.length === 0) {\n        throw new Error('科目名が設定されていません')\n      }\n\n      // 手動入力の日付を12:00:00として保存（03:00-03:00の区切りで正しい日付として判定されるように）\n      const inputDate = new Date(manualDate)\n      inputDate.setHours(12, 0, 0, 0)\n      const startedAt = inputDate.toISOString()\n\n        const noteValue = getManualNoteValue() || null\n        const { data, error } = await supabase\n        .from('study_logs')\n        .insert({\n          user_id: user.id,\n          subject: subject,\n          reference_book_id: selectedBookId || null,\n          study_minutes: minutes,\n          started_at: startedAt,\n          note: noteValue,\n        })\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Study log save error:', error)\n        throw new Error(`保存に失敗しました: ${error.message}`)\n      }\n\n      if (!data) {\n        throw new Error('保存に失敗しました: データが返されませんでした')\n      }\n\n      // データを再取得\n      const { data: logsData } = await supabase\n        .from('study_logs')\n        .select('*')\n        .eq('user_id', user.id)\n        .order('started_at', { ascending: false })\n\n      if (logsData) {\n        applyLogs(logsData)\n      }\n\n        if (noteValue) {\n          await ensureReviewTasks(supabase, user.id, data.id, startedAt, noteValue)\n        }\n      }\n\n      // フォームをリセット\n      setManualMinutes('')\n      setManualDate(getLocalDateString())\n      setManualNotes([''])\n      setAttachNoteToExisting(false)\n      setShowManualInput(false)\n      alert(attachNoteToExisting ? 'メモを追加しました！' : '学習記録を保存しました！')\n    } catch (err: any) {\n      console.error('Save study log error:', err)\n      alert(err.message || '保存に失敗しました。もう一度お試しください。')\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"w-full px-3 py-6\">\n        <div className=\"space-y-6\">\n          <Card>\n            <CardContent className=\"pt-6\">\n              <p className=\"text-center text-muted-foreground\">読み込み中...</p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-full px-3 py-6\">\n      <div className=\"space-y-6\">\n        {/* 学習時間 セクション */}\n        <Card className=\"shadow-lg border-0 bg-white\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"text-base font-semibold\">学習時間</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {/* サマリーカード */}\n            <div className=\"grid grid-cols-4 gap-2\">\n              <div className=\"bg-gray-200 rounded-lg p-3 text-center\">\n                <div className=\"text-lg font-bold text-foreground mb-1\">\n                  {formatTime(todayMinutes)}\n                </div>\n                <div className=\"text-xs text-muted-foreground\">今日</div>\n              </div>\n              <div className=\"bg-gray-200 rounded-lg p-3 text-center\">\n                <div className=\"text-lg font-bold text-foreground mb-1\">\n                  {formatTime(currentWeekMinutes)}\n                </div>\n                <div className=\"text-xs text-muted-foreground\">今週</div>\n              </div>\n              <div className=\"bg-gray-200 rounded-lg p-3 text-center\">\n                <div className=\"text-lg font-bold text-foreground mb-1\">\n                  {formatTime(thisMonthMinutes)}\n                </div>\n                <div className=\"text-xs text-muted-foreground\">今月</div>\n              </div>\n              <div className=\"bg-gray-200 rounded-lg p-3 text-center\">\n                <div className=\"text-lg font-bold text-foreground mb-1\">\n                  {formatTime(totalMinutes)}\n                </div>\n                <div className=\"text-xs text-muted-foreground\">総計</div>\n              </div>\n            </div>\n\n            {/* 過去の週・月の合計 */}\n            <div className=\"grid grid-cols-2 gap-2\">\n              <div className=\"bg-gray-100 rounded-lg p-3\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-xs text-muted-foreground\">{getWeekLabel(weekOffset)}</span>\n                  <select\n                    value={weekOffset}\n                    onChange={(e) => setWeekOffset(Number(e.target.value))}\n                    className=\"h-7 rounded-md border border-input bg-background px-2 text-xs\"\n                  >\n                    <option value={1}>先週</option>\n                    <option value={2}>2週間前</option>\n                    <option value={3}>3週間前</option>\n                    <option value={4}>4週間前</option>\n                    <option value={5}>5週間前</option>\n                  </select>\n                </div>\n                <div className=\"text-base font-bold text-foreground\">\n                  {formatTime(weekMinutes)}\n                </div>\n              </div>\n              <div className=\"bg-gray-100 rounded-lg p-3\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-xs text-muted-foreground\">{getMonthLabel(monthOffset)}</span>\n                  <select\n                    value={monthOffset}\n                    onChange={(e) => setMonthOffset(Number(e.target.value))}\n                    className=\"h-7 rounded-md border border-input bg-background px-2 text-xs\"\n                  >\n                    {Array.from({ length: 12 }, (_, i) => i + 1).map((value) => (\n                      <option key={value} value={value}>\n                        {value === 1 ? '先月' : `${value}ヶ月前`}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n                <div className=\"text-base font-bold text-foreground\">\n                  {formatTime(monthMinutes)}\n                </div>\n              </div>\n            </div>\n\n            {/* 共有 */}\n            <div className=\"flex items-center justify-between gap-2 rounded-lg border border-blue-100 bg-blue-50 px-3 py-2\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Share2 className=\"h-4 w-4 text-blue-500\" />\n                学習記録を共有\n              </div>\n              <div className=\"flex gap-2\">\n                <a href={shareLinks.x} target=\"_blank\" rel=\"noreferrer\">\n                  <Button variant=\"outline\" size=\"sm\">X</Button>\n                </a>\n              </div>\n            </div>\n\n            {/* 日別積み上げ棒グラフ */}\n            <div className=\"pt-2\">\n              <CategoryStackedChart studyLogs={studyLogs} referenceBooks={referenceBooks} />\n            </div>\n\n            {/* 教材別の学習時間 */}\n            <div className=\"pt-4\">\n              <div className=\"mb-2 flex items-center justify-between\">\n                <div className=\"text-sm font-semibold text-foreground\">教材別の学習時間</div>\n              </div>\n              {/* 凡例 */}\n              {(() => {\n                const allMaterials = new Set<string>()\n                studyLogs.forEach((log) => {\n                  if (log.reference_book_id) {\n                    const book = referenceBooks.find((b) => b.id === log.reference_book_id)\n                    if (book) {\n                      allMaterials.add(book.name)\n                    } else if (log.subject) {\n                      allMaterials.add(log.subject)\n                    }\n                  } else if (log.subject) {\n                    allMaterials.add(log.subject)\n                  }\n                })\n                const materialList = Array.from(allMaterials).sort()\n                if (materialList.length === 0) return null\n                return (\n                  <div className=\"mb-3 flex flex-wrap gap-2 text-xs\">\n                    {materialList.map((material) => (\n                      <div key={material} className=\"flex items-center gap-1.5\">\n                        <div\n                          className=\"w-3 h-3 rounded-full flex-shrink-0\"\n                          style={{ backgroundColor: getMaterialColor(material) }}\n                        />\n                        <span className=\"text-muted-foreground\">{material}</span>\n                      </div>\n                    ))}\n                  </div>\n                )\n              })()}\n              <div className=\"w-full rounded-lg border border-muted bg-white p-3\">\n                <div className=\"mb-2 flex flex-wrap items-center justify-between gap-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-xs text-muted-foreground\">表示期間</span>\n                    <select\n                      value={materialRangeType}\n                      onChange={(e) =>\n                        setMaterialRangeType(e.target.value as 'day' | 'week' | 'month' | 'total')\n                      }\n                      className=\"h-7 rounded-md border border-input bg-background px-2 text-xs\"\n                    >\n                      <option value=\"day\">一日</option>\n                      <option value=\"week\">1週間</option>\n                      <option value=\"month\">1ヶ月</option>\n                      <option value=\"total\">総累計</option>\n                    </select>\n                  </div>\n                  {materialRangeType !== 'total' && (\n                    <select\n                      value={\n                        materialRangeType === 'day'\n                          ? dailyIndex\n                          : materialRangeType === 'week'\n                            ? weeklyIndex\n                            : monthlyIndex\n                      }\n                      onChange={(e) => {\n                        const value = Number(e.target.value)\n                        if (materialRangeType === 'day') setDailyIndex(value)\n                        if (materialRangeType === 'week') setWeeklyIndex(value)\n                        if (materialRangeType === 'month') setMonthlyIndex(value)\n                      }}\n                      className=\"h-7 rounded-md border border-input bg-background px-2 text-xs\"\n                    >\n                      {materialRangeType === 'day' &&\n                        Array.from({ length: 8 }, (_, i) => i).map((value) => (\n                          <option key={value} value={value}>\n                            {getDayLabel(value)}\n                          </option>\n                        ))}\n                      {materialRangeType === 'week' &&\n                        Array.from({ length: 6 }, (_, i) => i).map((value) => (\n                          <option key={value} value={value}>\n                            {value === 0 ? '今週' : `${value}週間前`}\n                          </option>\n                        ))}\n                      {materialRangeType === 'month' &&\n                        Array.from({ length: 13 }, (_, i) => i).map((value) => (\n                          <option key={value} value={value}>\n                            {value === 0 ? '今月' : `${value}ヶ月前`}\n                          </option>\n                        ))}\n                    </select>\n                  )}\n                </div>\n                <ReferenceBookChart\n                  studyLogs={studyLogs}\n                  referenceBooks={referenceBooks}\n                  range={\n                    materialRangeType === 'day'\n                      ? getDayRange(dailyIndex)\n                      : materialRangeType === 'week'\n                        ? getWeekRangeFromIndex(weeklyIndex)\n                        : materialRangeType === 'month'\n                          ? getMonthRangeFromIndex(monthlyIndex)\n                          : undefined\n                  }\n                />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* 学習記録の入力 */}\n        <Card className=\"shadow-lg border-0 bg-white\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle className=\"text-base font-semibold\">学習記録の入力</CardTitle>\n                <CardDescription>今日や過去の学習内容をまとめて入力できます</CardDescription>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={handleToggleManualInput}\n              >\n                <Plus className=\"w-5 h-5\" />\n              </Button>\n            </div>\n          </CardHeader>\n          {showManualInput && (\n            <CardContent>\n              <form onSubmit={handleManualSubmit} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"manual_book\">教材</Label>\n                  <select\n                    id=\"manual_book\"\n                    value={selectedBookId || ''}\n                    onChange={(e) => setSelectedBookId(e.target.value || null)}\n                    className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm\"\n                    required={!attachNoteToExisting}\n                  >\n                    <option value=\"\">選択してください</option>\n                    {referenceBooks.map((book) => (\n                      <option key={book.id} value={book.id}>\n                        {book.name}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"manual_minutes\">学習時間（分）</Label>\n                  <Input\n                    id=\"manual_minutes\"\n                    type=\"number\"\n                    min=\"1\"\n                    value={manualMinutes}\n                    onChange={(e) => setManualMinutes(e.target.value)}\n                    placeholder=\"60\"\n                    required={!attachNoteToExisting}\n                    disabled={attachNoteToExisting}\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"manual_date\">学習日</Label>\n                  <Input\n                    id=\"manual_date\"\n                    type=\"date\"\n                    value={manualDate}\n                    onChange={(e) => setManualDate(e.target.value)}\n                    required\n                  />\n                </div>\n\n                <label className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                  <input\n                    type=\"checkbox\"\n                    checked={attachNoteToExisting}\n                    onChange={(e) => setAttachNoteToExisting(e.target.checked)}\n                    className=\"h-4 w-4\"\n                  />\n                  計測済みの記録にメモを追加（時間入力不要）\n                </label>\n                {attachNoteToExisting && (\n                  <p className=\"text-xs text-muted-foreground\">\n                    教材を選ばない場合は、その日の最新記録に追加します\n                  </p>\n                )}\n\n                <div className=\"space-y-2\">\n                  <Label>勉強内容</Label>\n                  <p className=\"text-xs text-muted-foreground\">\n                    1つの内容ごとに分けると、復習カードが作りやすくなります\n                  </p>\n                  <div className=\"space-y-2\">\n                    {manualNotes.map((note, index) => (\n                      <div key={`manual-note-${index}`} className=\"flex items-start gap-2\">\n                        <textarea\n                          value={note}\n                          onChange={(e) => {\n                            const next = [...manualNotes]\n                            next[index] = e.target.value\n                            setManualNotes(next)\n                          }}\n                          placeholder=\"例: 二次関数の最大最小\"\n                          className=\"w-full min-h-[70px] resize-none rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\"\n                          rows={2}\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            const next = manualNotes.filter((_, i) => i !== index)\n                            setManualNotes(next.length > 0 ? next : [''])\n                          }}\n                        >\n                          削除\n                        </Button>\n                      </div>\n                    ))}\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setManualNotes([...manualNotes, ''])}\n                    >\n                      内容を追加\n                    </Button>\n                  </div>\n                </div>\n\n                <Button type=\"submit\" className=\"w-full\" disabled={isSaving}>\n                  {isSaving ? '送信中...' : '送信'}\n                </Button>\n              </form>\n            </CardContent>\n          )}\n        </Card>\n\n        {/* 学習内容メモ */}\n        <Card className=\"shadow-lg border-0 bg-white\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle className=\"text-base font-semibold\">学習内容メモ</CardTitle>\n                <CardDescription>入力した内容をあとから見返せます</CardDescription>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={() => setShowMemoLogs(!showMemoLogs)}\n              >\n                <Plus className={cn('w-5 h-5 transition-transform', showMemoLogs && 'rotate-45')} />\n              </Button>\n            </div>\n          </CardHeader>\n          {showMemoLogs && (\n            <CardContent className=\"space-y-3\">\n              {logsWithNotes.length === 0 && (\n                <p className=\"text-sm text-muted-foreground\">まだメモがありません</p>\n              )}\n              {logsWithNotes.length > 0 && (\n                <div className=\"max-h-[360px] overflow-y-auto space-y-3 pr-1\">\n                  {logsWithNotes.map((log) => (\n                    <div key={`note-${log.id}`} className=\"rounded-lg border border-muted p-3 space-y-2\">\n                      <div className=\"flex flex-wrap items-center justify-between gap-2\">\n                        <div className=\"text-sm text-muted-foreground\">\n                          {new Date(log.started_at).toLocaleDateString('ja-JP')}\n                        </div>\n                        <div className=\"text-sm font-medium\">\n                          {log.subject} / {formatTime(log.study_minutes)}\n                        </div>\n                      </div>\n                      <div className=\"text-sm text-foreground whitespace-pre-wrap\">\n                        {log.note}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          )}\n        </Card>\n\n        {/* 学習記録一覧（編集） */}\n        <Card className=\"shadow-lg border-0 bg-white\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle className=\"text-base font-semibold\">学習記録の修正</CardTitle>\n                <CardDescription>直近の記録を編集・削除できます</CardDescription>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={handleToggleEditLogs}\n              >\n                <Plus className={cn('w-5 h-5 transition-transform', showEditLogs && 'rotate-45')} />\n              </Button>\n            </div>\n          </CardHeader>\n          {showEditLogs && (\n            <CardContent className=\"space-y-3\">\n              {groupedEditLogs.length === 0 && (\n                <p className=\"text-sm text-muted-foreground\">学習記録がありません</p>\n              )}\n              {groupedEditLogs.slice(0, 20).map((group) => (\n                <div key={`group-${group.studyDay}-${group.subject}-${group.reference_book_id || 'none'}`} className=\"rounded-lg border border-muted p-3\">\n                  {editingLogId && group.ids.includes(editingLogId) ? (\n                    <div className=\"space-y-3\">\n                      <div className=\"grid grid-cols-1 gap-3 md:grid-cols-3\">\n                        <div className=\"space-y-1\">\n                          <Label>教材</Label>\n                          <select\n                            value={editBookId || ''}\n                            onChange={(e) => setEditBookId(e.target.value || null)}\n                            className=\"flex h-9 w-full rounded-md border border-input bg-background px-2 text-sm\"\n                          >\n                            <option value=\"\">その他</option>\n                            {referenceBooks.map((book) => (\n                              <option key={book.id} value={book.id}>\n                                {book.name}\n                              </option>\n                            ))}\n                          </select>\n                        </div>\n                        <div className=\"space-y-1\">\n                          <Label>科目名（自由入力）</Label>\n                          <Input\n                            value={editSubject}\n                            onChange={(e) => setEditSubject(e.target.value)}\n                            placeholder=\"その他\"\n                          />\n                        </div>\n                        <div className=\"space-y-1\">\n                          <Label>学習時間（分）</Label>\n                          <Input\n                            type=\"number\"\n                            min=\"1\"\n                            value={editMinutes}\n                            onChange={(e) => setEditMinutes(e.target.value)}\n                          />\n                        </div>\n                      </div>\n                      <div className=\"grid grid-cols-1 gap-3 md:grid-cols-3\">\n                        <div className=\"space-y-1\">\n                          <Label>学習日</Label>\n                          <Input\n                            type=\"date\"\n                            value={editDate}\n                            onChange={(e) => setEditDate(e.target.value)}\n                          />\n                        </div>\n                        <div className=\"flex items-end gap-2\">\n                          <Button onClick={saveEditLog} disabled={isSaving}>\n                            保存\n                          </Button>\n                          <Button variant=\"outline\" onClick={cancelEditLog}>\n                            キャンセル\n                          </Button>\n                          <Button variant=\"destructive\" onClick={() => deleteLogGroup(group.ids)}>\n                            削除\n                          </Button>\n                        </div>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>勉強内容</Label>\n                        <p className=\"text-xs text-muted-foreground\">\n                          復習カードで使うので、できるだけ具体的に書いてください\n                        </p>\n                        <textarea\n                          value={editNote}\n                          onChange={(e) => setEditNote(e.target.value)}\n                          placeholder=\"例: 二次関数の最大最小、合成関数の範囲／英語長文の段落要約\"\n                          className=\"w-full min-h-[90px] resize-none rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\"\n                          rows={3}\n                        />\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"flex flex-wrap items-center justify-between gap-2\">\n                      <div className=\"space-y-1\">\n                        <div className=\"text-sm text-muted-foreground\">\n                          {getStudyDayDate(group.studyDay).toLocaleDateString('ja-JP')}\n                        </div>\n                        <div className=\"font-medium\">\n                          {group.subject} / {formatTime(group.study_minutes)}\n                        </div>\n                        {group.note && (\n                          <div className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\n                            {group.note}\n                          </div>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Button variant=\"outline\" size=\"sm\" onClick={() => startEditGroup(group)}>\n                          編集\n                        </Button>\n                        <Button variant=\"destructive\" size=\"sm\" onClick={() => deleteLogGroup(group.ids)}>\n                          削除\n                        </Button>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              ))}\n            </CardContent>\n          )}\n        </Card>\n\n        {/* 過去の目標達成状況 */}\n        <Card className=\"shadow-lg border-0 bg-white\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle className=\"text-base font-semibold\">過去の目標達成状況</CardTitle>\n                <CardDescription>過去の日・週・月の目標達成状況を確認</CardDescription>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={() => setShowPastGoals(!showPastGoals)}\n              >\n                <Plus className={cn('w-5 h-5 transition-transform', showPastGoals && 'rotate-45')} />\n              </Button>\n            </div>\n          </CardHeader>\n          {showPastGoals && profile && (\n            <CardContent className=\"space-y-6\">\n              {(() => {\n                const pastGoals = getPastGoalsData()\n                return (\n                  <>\n                    {/* 過去30日間の目標達成状況 */}\n                    <div className=\"space-y-3\">\n                      <h3 className=\"text-sm font-semibold\">過去30日間（1日ごと）</h3>\n                      <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                        {pastGoals.days.map((day, idx) => (\n                          <div key={idx} className=\"rounded-lg border border-muted p-3\">\n                            <div className=\"flex items-center justify-between mb-2\">\n                              <span className=\"text-sm text-muted-foreground\">\n                                {day.date.toLocaleDateString('ja-JP', {\n                                  month: 'short',\n                                  day: 'numeric',\n                                })}\n                              </span>\n                              <span className=\"text-sm font-medium\">\n                                {formatTime(day.actual)} / {formatTime(day.target)}\n                              </span>\n                            </div>\n                            <div className=\"w-full bg-gray-200 rounded-full h-2 overflow-hidden\">\n                              <div\n                                className={cn(\n                                  'h-full transition-all',\n                                  day.progress >= 100\n                                    ? 'bg-green-500'\n                                    : day.progress >= 50\n                                    ? 'bg-blue-500'\n                                    : 'bg-orange-500'\n                                )}\n                                style={{ width: `${Math.min(100, day.progress)}%` }}\n                              />\n                            </div>\n                            <div className=\"text-xs text-muted-foreground mt-1\">\n                              達成率 {day.progress}%\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n\n                    {/* 過去12週間の目標達成状況 */}\n                    <div className=\"space-y-3\">\n                      <h3 className=\"text-sm font-semibold\">過去12週間（1週間ごと）</h3>\n                      <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                        {pastGoals.weeks.map((week, idx) => (\n                          <div key={idx} className=\"rounded-lg border border-muted p-3\">\n                            <div className=\"flex items-center justify-between mb-2\">\n                              <span className=\"text-sm text-muted-foreground\">\n                                {week.weekStart.toLocaleDateString('ja-JP', {\n                                  month: 'short',\n                                  day: 'numeric',\n                                })}\n                                {' 〜 '}\n                                {new Date(week.weekStart.getTime() + 6 * 24 * 60 * 60 * 1000).toLocaleDateString('ja-JP', {\n                                  month: 'short',\n                                  day: 'numeric',\n                                })}\n                              </span>\n                              <span className=\"text-sm font-medium\">\n                                {formatTime(week.actual)} / {formatTime(week.target)}\n                              </span>\n                            </div>\n                            <div className=\"w-full bg-gray-200 rounded-full h-2 overflow-hidden\">\n                              <div\n                                className={cn(\n                                  'h-full transition-all',\n                                  week.progress >= 100\n                                    ? 'bg-green-500'\n                                    : week.progress >= 50\n                                    ? 'bg-blue-500'\n                                    : 'bg-orange-500'\n                                )}\n                                style={{ width: `${Math.min(100, week.progress)}%` }}\n                              />\n                            </div>\n                            <div className=\"text-xs text-muted-foreground mt-1\">\n                              達成率 {week.progress}%\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n\n                    {/* 過去12ヶ月の目標達成状況 */}\n                    <div className=\"space-y-3\">\n                      <h3 className=\"text-sm font-semibold\">過去12ヶ月（1ヶ月ごと）</h3>\n                      <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                        {pastGoals.months.map((month, idx) => (\n                          <div key={idx} className=\"rounded-lg border border-muted p-3\">\n                            <div className=\"flex items-center justify-between mb-2\">\n                              <span className=\"text-sm text-muted-foreground\">\n                                {month.monthStart.toLocaleDateString('ja-JP', {\n                                  year: 'numeric',\n                                  month: 'long',\n                                })}\n                              </span>\n                              <span className=\"text-sm font-medium\">\n                                {formatTime(month.actual)} / {formatTime(month.target)}\n                              </span>\n                            </div>\n                            <div className=\"w-full bg-gray-200 rounded-full h-2 overflow-hidden\">\n                              <div\n                                className={cn(\n                                  'h-full transition-all',\n                                  month.progress >= 100\n                                    ? 'bg-green-500'\n                                    : month.progress >= 50\n                                    ? 'bg-blue-500'\n                                    : 'bg-orange-500'\n                                )}\n                                style={{ width: `${Math.min(100, month.progress)}%` }}\n                              />\n                            </div>\n                            <div className=\"text-xs text-muted-foreground mt-1\">\n                              達成率 {month.progress}%\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </>\n                )\n              })()}\n            </CardContent>\n          )}\n        </Card>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\app\\log\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\app\\qa\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":64,"column":13,"nodeType":"JSXOpeningElement","endLine":68,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'node' is defined but never used.","line":77,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'node' is defined but never used.","line":80,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":80,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'node' is defined but never used.","line":83,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":83,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'node' is defined but never used.","line":86,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'node' is defined but never used.","line":89,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":89,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2814,2817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2814,2817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'node' is defined but never used.","line":95,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3166,3169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3166,3169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":399,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":399,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12447,12450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12447,12450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":536,"column":19,"nodeType":"JSXOpeningElement","endLine":540,"endColumn":21}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useRef, useEffect, memo } from 'react'\nimport Image from 'next/image'\nimport { Send, ImageIcon, Camera, X, User, Plus, Trash2 } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport ReactMarkdown from 'react-markdown'\nimport remarkMath from 'remark-math'\nimport rehypeKatex from 'rehype-katex'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface Message {\n  id: string\n  role: 'user' | 'assistant'\n  content: string\n  imageUrl?: string\n}\n\nconst SESSIONS_KEY = 'qa_chat_sessions'\nconst ACTIVE_KEY = 'qa_active_chat_id'\nconst LEGACY_KEY = 'qa_chat_history'\nconst STORAGE_MAX_MESSAGES = 50\n\ninterface ChatSession {\n  id: string\n  title: string\n  messages: Message[]\n  updatedAt: number\n}\n\nconst MessageBubble = memo(function MessageBubble({\n  message,\n  userAvatarUrl,\n}: {\n  message: Message\n  userAvatarUrl: string | null\n}) {\n  return (\n    <div\n      className={`flex gap-3 ${\n        message.role === 'user' ? 'justify-end' : 'justify-start'\n      }`}\n    >\n      {message.role === 'assistant' && (\n        <div className=\"relative w-8 h-8 flex-shrink-0\">\n          <Image\n            src=\"/images/mascot.png\"\n            alt=\"AI\"\n            fill\n            className=\"object-contain rounded-full\"\n          />\n        </div>\n      )}\n      <div\n        className={`max-w-[82%] rounded-2xl p-3 shadow-sm ${\n          message.role === 'user'\n            ? 'bg-gradient-to-br from-blue-600 to-blue-500 text-primary-foreground'\n            : 'bg-white border border-slate-200'\n        }`}\n      >\n        {message.imageUrl && (\n          <div className=\"mb-2\">\n            <img\n              src={message.imageUrl}\n              alt=\"アップロード画像\"\n              className=\"max-w-full rounded\"\n            />\n          </div>\n        )}\n        {message.role === 'assistant' ? (\n          <div className=\"markdown-content\">\n            <ReactMarkdown\n              remarkPlugins={[remarkMath]}\n              rehypePlugins={[rehypeKatex]}\n              components={{\n                h2: ({ node, ...props }) => (\n                  <h2 className=\"text-lg font-semibold mt-4 mb-2 first:mt-0 text-foreground\" {...props} />\n                ),\n                ul: ({ node, ...props }) => (\n                  <ul className=\"list-disc list-inside space-y-1 my-2 text-foreground\" {...props} />\n                ),\n                ol: ({ node, ...props }) => (\n                  <ol className=\"list-decimal list-inside space-y-1 my-2 text-foreground\" {...props} />\n                ),\n                p: ({ node, ...props }) => (\n                  <p className=\"my-2 text-foreground leading-relaxed\" {...props} />\n                ),\n                code: ({ node, inline, ...props }: any) => {\n                  if (inline) {\n                    return <code className=\"bg-muted px-1 py-0.5 rounded text-sm font-mono\" {...props} />\n                  }\n                  return <code className=\"block bg-muted p-2 rounded my-2 overflow-x-auto text-sm font-mono\" {...props} />\n                },\n                div: ({ node, ...props }: any) => {\n                  if (props.className?.includes('math-display')) {\n                    return <div className=\"my-4 overflow-x-auto\" {...props} />\n                  }\n                  return <div {...props} />\n                },\n              }}\n            >\n              {message.content}\n            </ReactMarkdown>\n          </div>\n        ) : (\n          <p className=\"whitespace-pre-wrap\">{message.content}</p>\n        )}\n      </div>\n      {message.role === 'user' && (\n        <div className=\"relative w-8 h-8 flex-shrink-0\">\n          {userAvatarUrl ? (\n            <Image\n              src={userAvatarUrl}\n              alt=\"あなた\"\n              fill\n              className=\"object-cover rounded-full\"\n            />\n          ) : (\n            <div className=\"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center\">\n              <User className=\"w-4 h-4 text-slate-500\" />\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n})\n\nconst MessageList = memo(function MessageList({\n  messages,\n  isLoading,\n  messagesEndRef,\n  userAvatarUrl,\n}: {\n  messages: Message[]\n  isLoading: boolean\n  messagesEndRef: React.RefObject<HTMLDivElement | null>\n  userAvatarUrl: string | null\n}) {\n  return (\n    <div className=\"flex-1 overflow-y-auto space-y-4 mb-4 pr-2\" style={{ scrollbarWidth: 'thin' }}>\n      {messages.length === 0 && (\n        <div className=\"text-center text-muted-foreground py-8\">\n          <div className=\"relative w-24 h-24 mx-auto mb-4\">\n            <Image\n              src=\"/images/mascot.png\"\n              alt=\"マスコット\"\n              fill\n              className=\"object-contain\"\n            />\n          </div>\n          <p>質問を入力してください</p>\n          <p className=\"text-sm mt-2\">テキストと画像の両方に対応しています</p>\n        </div>\n      )}\n\n      {messages.map((message) => (\n        <MessageBubble key={message.id} message={message} userAvatarUrl={userAvatarUrl} />\n      ))}\n\n      {isLoading && (\n        <div className=\"flex gap-3 justify-start\">\n          <div className=\"relative w-8 h-8 flex-shrink-0\">\n            <Image\n              src=\"/images/mascot.png\"\n              alt=\"AI\"\n              fill\n              className=\"object-contain rounded-full animate-pulse\"\n            />\n          </div>\n          <div className=\"bg-muted rounded-lg p-3\">\n            <div className=\"flex gap-1\">\n              <div className=\"w-2 h-2 bg-foreground rounded-full animate-bounce\" />\n              <div className=\"w-2 h-2 bg-foreground rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }} />\n              <div className=\"w-2 h-2 bg-foreground rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }} />\n            </div>\n          </div>\n        </div>\n      )}\n      <div ref={messagesEndRef} />\n    </div>\n  )\n})\n\nexport default function QAPage() {\n  const [sessions, setSessions] = useState<ChatSession[]>([])\n  const [activeChatId, setActiveChatId] = useState<string | null>(null)\n  const [messages, setMessages] = useState<Message[]>([])\n  const [input, setInput] = useState('')\n  const [isLoading, setIsLoading] = useState(false)\n  const [selectedImage, setSelectedImage] = useState<string | null>(null)\n  const [userAvatarUrl, setUserAvatarUrl] = useState<string | null>(null)\n  const [isCoarsePointer, setIsCoarsePointer] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const cameraInputRef = useRef<HTMLInputElement>(null)\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const resizeTextarea = () => {\n    if (!textareaRef.current) return\n    textareaRef.current.style.height = 'auto'\n    textareaRef.current.style.height = `${textareaRef.current.scrollHeight}px`\n  }\n\n  useEffect(() => {\n    resizeTextarea()\n  }, [input])\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return\n    const mediaQuery = window.matchMedia('(pointer: coarse)')\n    const handleChange = () => setIsCoarsePointer(mediaQuery.matches)\n    handleChange()\n    mediaQuery.addEventListener('change', handleChange)\n    return () => mediaQuery.removeEventListener('change', handleChange)\n  }, [])\n\n  // ローカルストレージから履歴を読み込む\n  useEffect(() => {\n    if (typeof window === 'undefined') return\n    const savedSessions =\n      localStorage.getItem(SESSIONS_KEY) || sessionStorage.getItem(SESSIONS_KEY)\n    const savedActive =\n      localStorage.getItem(ACTIVE_KEY) || sessionStorage.getItem(ACTIVE_KEY)\n    if (savedSessions) {\n      try {\n        const parsed = JSON.parse(savedSessions)\n        if (Array.isArray(parsed) && parsed.length > 0) {\n          setSessions(parsed)\n          const activeId = savedActive || parsed[0].id\n          setActiveChatId(activeId)\n          const active = parsed.find((s: ChatSession) => s.id === activeId) || parsed[0]\n          setMessages(active.messages || [])\n          return\n        }\n      } catch (e) {\n        console.error('Failed to load chat sessions:', e)\n      }\n    }\n\n    const legacy = localStorage.getItem(LEGACY_KEY) || sessionStorage.getItem(LEGACY_KEY)\n    if (legacy) {\n      try {\n        const parsed = JSON.parse(legacy)\n        if (Array.isArray(parsed)) {\n          const legacySession: ChatSession = {\n            id: Date.now().toString(),\n            title: 'チャット 1',\n            messages: parsed,\n            updatedAt: Date.now(),\n          }\n          setSessions([legacySession])\n          setActiveChatId(legacySession.id)\n          setMessages(legacySession.messages)\n          return\n        }\n      } catch (e) {\n        console.error('Failed to migrate legacy chat history:', e)\n      }\n    }\n\n    const initialSession: ChatSession = {\n      id: Date.now().toString(),\n      title: 'チャット 1',\n      messages: [],\n      updatedAt: Date.now(),\n    }\n    setSessions([initialSession])\n    setActiveChatId(initialSession.id)\n    setMessages([])\n  }, [])\n\n  useEffect(() => {\n    const loadProfile = async () => {\n      try {\n        const supabase = createClient()\n        const {\n          data: { user },\n        } = await supabase.auth.getUser()\n        if (!user) return\n        const { data: profile } = await supabase\n          .from('profiles')\n          .select('avatar_url')\n          .eq('user_id', user.id)\n          .single()\n        if (profile?.avatar_url) {\n          setUserAvatarUrl(profile.avatar_url)\n        }\n      } catch (error) {\n        console.warn('Failed to load profile avatar:', error)\n      }\n    }\n    loadProfile()\n  }, [])\n\n  // メッセージが変更されたらセッションに反映\n  useEffect(() => {\n    if (typeof window === 'undefined' || !activeChatId) return\n\n    const lightweight = messages\n      .slice(-STORAGE_MAX_MESSAGES)\n      .map(({ id, role, content }) => ({ id, role, content }))\n\n    setSessions((prev) =>\n      prev.map((session) =>\n        session.id === activeChatId\n          ? { ...session, messages: lightweight, updatedAt: Date.now() }\n          : session\n      )\n    )\n  }, [messages, activeChatId])\n\n  // セッション全体を保存\n  useEffect(() => {\n    if (typeof window === 'undefined' || sessions.length === 0) return\n    try {\n      localStorage.setItem(SESSIONS_KEY, JSON.stringify(sessions))\n      sessionStorage.setItem(SESSIONS_KEY, JSON.stringify(sessions))\n      if (activeChatId) {\n        localStorage.setItem(ACTIVE_KEY, activeChatId)\n        sessionStorage.setItem(ACTIVE_KEY, activeChatId)\n      }\n    } catch (e) {\n      console.warn('Failed to save chat sessions:', e)\n    }\n  }, [sessions, activeChatId])\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }\n\n  useEffect(() => {\n    scrollToBottom()\n  }, [messages])\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (file) {\n      const reader = new FileReader()\n      reader.onloadend = () => {\n        setSelectedImage(reader.result as string)\n      }\n      reader.readAsDataURL(file)\n    }\n  }\n\n  const handleSend = async () => {\n    if (isLoading) return\n    if (!input.trim() && !selectedImage) return\n    const effectiveImage = selectedImage\n\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: input,\n      imageUrl: selectedImage || undefined,\n    }\n\n    setMessages((prev) => [...prev, userMessage])\n    setInput('')\n    setSelectedImage(null)\n    if (fileInputRef.current) {\n      fileInputRef.current.value = ''\n    }\n    if (cameraInputRef.current) {\n      cameraInputRef.current.value = ''\n    }\n    setIsLoading(true)\n\n    try {\n      const response = await fetch('/api/qa', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          message: input,\n          image: effectiveImage,\n          history: messages.map((m) => ({\n            role: m.role,\n            content: m.content,\n            imageUrl: m.imageUrl,\n          })),\n        }),\n      })\n\n      if (!response.ok) {\n        throw new Error('AIからの応答を取得できませんでした')\n      }\n\n      const data = await response.json()\n      const assistantMessage: Message = {\n        id: (Date.now() + 1).toString(),\n        role: 'assistant',\n        content: data.response,\n      }\n\n      setMessages((prev) => [...prev, assistantMessage])\n    } catch (error: any) {\n      const errorMessage: Message = {\n        id: (Date.now() + 1).toString(),\n        role: 'assistant',\n        content: `エラーが発生しました: ${error.message}`,\n      }\n      setMessages((prev) => [...prev, errorMessage])\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleSelectChat = (id: string) => {\n    setActiveChatId(id)\n    const session = sessions.find((s) => s.id === id)\n    setMessages(session?.messages || [])\n    setInput('')\n    setSelectedImage(null)\n  }\n\n  const handleCreateChat = () => {\n    const nextIndex = sessions.length + 1\n    const newSession: ChatSession = {\n      id: Date.now().toString(),\n      title: `チャット ${nextIndex}`,\n      messages: [],\n      updatedAt: Date.now(),\n    }\n    setSessions((prev) => [newSession, ...prev])\n    setActiveChatId(newSession.id)\n    setMessages([])\n    setInput('')\n    setSelectedImage(null)\n  }\n\n  const handleDeleteChat = () => {\n    if (!activeChatId) return\n    if (!confirm('このチャットを削除しますか？')) return\n    setSessions((prev) => {\n      const remaining = prev.filter((s) => s.id !== activeChatId)\n      const nextSession = remaining[0]\n      if (nextSession) {\n        setActiveChatId(nextSession.id)\n        setMessages(nextSession.messages || [])\n      } else {\n        const fallback: ChatSession = {\n          id: Date.now().toString(),\n          title: 'チャット 1',\n          messages: [],\n          updatedAt: Date.now(),\n        }\n        setActiveChatId(fallback.id)\n        setMessages([])\n        return [fallback]\n      }\n      return remaining\n    })\n  }\n\n  return (\n    <div className=\"w-full px-3 pt-4 pb-3 min-h-screen flex flex-col bg-gradient-to-b from-slate-50 via-white to-slate-100\">\n      <Card className=\"shadow-xl flex-1 flex flex-col min-h-0 border-0 bg-white/90 backdrop-blur\">\n        <CardHeader className=\"flex-shrink-0 pb-3\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <span className=\"inline-flex h-6 w-6 items-center justify-center rounded-full bg-blue-100 text-blue-600 text-xs\">AI</span>\n            Q&A\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"flex-1 flex flex-col min-h-0 overflow-hidden\">\n          {/* メッセージ表示エリア */}\n          <MessageList\n            messages={messages}\n            isLoading={isLoading}\n            messagesEndRef={messagesEndRef}\n            userAvatarUrl={userAvatarUrl}\n          />\n\n          {/* 入力エリア */}\n          <div className=\"flex flex-col gap-2 flex-shrink-0 pt-3 border-t\">\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleImageSelect}\n              className=\"hidden\"\n              id=\"image-upload\"\n            />\n            <input\n              ref={cameraInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              capture=\"environment\"\n              onChange={handleImageSelect}\n              className=\"hidden\"\n              id=\"camera-upload\"\n            />\n            <div className=\"flex flex-wrap items-center gap-2\">\n              <label htmlFor=\"image-upload\" className=\"cursor-pointer\">\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  type=\"button\"\n                  onClick={() => fileInputRef.current?.click()}\n                >\n                  <ImageIcon className=\"w-5 h-5\" />\n                </Button>\n              </label>\n              <label htmlFor=\"camera-upload\" className=\"cursor-pointer\">\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  type=\"button\"\n                  onClick={() => cameraInputRef.current?.click()}\n                  title=\"カメラで撮影\"\n                >\n                  <Camera className=\"w-5 h-5\" />\n                </Button>\n              </label>\n              <select\n                value={activeChatId || ''}\n                onChange={(e) => handleSelectChat(e.target.value)}\n                className=\"h-9 rounded-md border border-input bg-background px-2 text-xs\"\n              >\n                {sessions.map((session) => (\n                  <option key={session.id} value={session.id}>\n                    {session.title}\n                  </option>\n                ))}\n              </select>\n              <Button variant=\"outline\" size=\"icon\" onClick={handleCreateChat} title=\"新規チャット\">\n                <Plus className=\"w-4 h-4\" />\n              </Button>\n              <Button variant=\"outline\" size=\"icon\" onClick={handleDeleteChat} title=\"チャット削除\">\n                <Trash2 className=\"w-4 h-4\" />\n              </Button>\n              {selectedImage && (\n                <div className=\"relative w-12 h-12 flex-shrink-0\">\n                  <img\n                    src={selectedImage}\n                    alt=\"プレビュー\"\n                    className=\"w-12 h-12 rounded object-cover\"\n                  />\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"absolute -top-1 -right-1 h-5 w-5 p-0\"\n                    onClick={() => {\n                      setSelectedImage(null)\n                      if (fileInputRef.current) {\n                        fileInputRef.current.value = ''\n                      }\n                      if (cameraInputRef.current) {\n                        cameraInputRef.current.value = ''\n                      }\n                    }}\n                  >\n                    <X className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              )}\n              <div className=\"ml-auto\">\n                <Button onClick={handleSend} disabled={!input.trim() && !selectedImage} className=\"h-10 w-10 p-0 rounded-xl\">\n                  <Send className=\"w-5 h-5\" />\n                </Button>\n              </div>\n            </div>\n            <textarea\n              ref={textareaRef}\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              onKeyDown={(e) => {\n                if (e.key === 'Enter' && !e.shiftKey && !isCoarsePointer && !e.nativeEvent.isComposing) {\n                  e.preventDefault()\n                  handleSend()\n                }\n              }}\n              placeholder=\"質問を入力...\"\n              className=\"w-full min-h-[140px] max-h-[260px] resize-none overflow-y-auto rounded-xl border border-input bg-background px-3 py-3 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400\"\n              rows={5}\n            />\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\app\\settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2332,2335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2332,2335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3210,3213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3210,3213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4580,4583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4580,4583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4973,4976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4973,4976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport * as z from 'zod'\nimport Image from 'next/image'\nimport { User } from 'lucide-react'\nimport { createClient } from '@/lib/supabase/client'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\n\nconst settingsSchema = z.object({\n  weekday_target_minutes: z\n    .number()\n    .min(1, '平日の目標は1分以上で入力してください')\n    .max(1440, '平日の目標は1440分以内で入力してください'),\n  weekend_target_minutes: z\n    .number()\n    .min(1, '土日祝の目標は1分以上で入力してください')\n    .max(1440, '土日祝の目標は1440分以内で入力してください'),\n})\n\ntype SettingsForm = z.infer<typeof settingsSchema>\n\nexport default function SettingsPage() {\n  const router = useRouter()\n  const [isLoading, setIsLoading] = useState(false)\n  const [isLoadingProfile, setIsLoadingProfile] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [avatarUrl, setAvatarUrl] = useState<string | null>(null)\n  const [isUploadingAvatar, setIsUploadingAvatar] = useState(false)\n  const avatarInputRef = useRef<HTMLInputElement>(null)\n\n  const {\n    register,\n    handleSubmit,\n    reset,\n    formState: { errors },\n  } = useForm<SettingsForm>({\n    resolver: zodResolver(settingsSchema),\n  })\n\n  useEffect(() => {\n    const loadProfile = async () => {\n      try {\n        const supabase = createClient()\n        const {\n          data: { user },\n        } = await supabase.auth.getUser()\n\n        if (!user) {\n          router.push('/login')\n          return\n        }\n\n        const { data: profile, error } = await supabase\n          .from('profiles')\n          .select('*')\n          .eq('user_id', user.id)\n          .single()\n\n        if (error) {\n          throw error\n        }\n\n        if (profile) {\n          reset({\n            weekday_target_minutes: profile.weekday_target_minutes ?? 60,\n            weekend_target_minutes: profile.weekend_target_minutes ?? 120,\n          })\n          if (profile.avatar_url) {\n            setAvatarUrl(profile.avatar_url)\n          }\n        }\n      } catch (err: any) {\n        setError(err.message || 'プロフィールの読み込みに失敗しました')\n      } finally {\n        setIsLoadingProfile(false)\n      }\n    }\n\n    loadProfile()\n  }, [router, reset])\n\n  const onSubmit = async (data: SettingsForm) => {\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n\n      if (!user) {\n        throw new Error('ログインが必要です')\n      }\n\n      const { error: updateError } = await supabase\n        .from('profiles')\n        .update({\n          weekday_target_minutes: data.weekday_target_minutes,\n          weekend_target_minutes: data.weekend_target_minutes,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('user_id', user.id)\n\n      if (updateError) throw updateError\n\n      router.refresh()\n      alert('設定を更新しました')\n    } catch (err: any) {\n      setError(err.message || 'エラーが発生しました')\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleAvatarSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n    if (!file.type.startsWith('image/')) {\n      alert('画像ファイルを選択してください')\n      return\n    }\n    setIsUploadingAvatar(true)\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n      if (!user) {\n        alert('ログインが必要です')\n        return\n      }\n\n      const fileExt = file.name.split('.').pop() || 'jpg'\n      const filePath = `${user.id}/${Date.now()}.${fileExt}`\n      const { error: uploadError } = await supabase.storage\n        .from('avatars')\n        .upload(filePath, file, { cacheControl: '3600', upsert: true })\n\n      if (uploadError) {\n        throw uploadError\n      }\n\n      const { data: urlData } = supabase.storage.from('avatars').getPublicUrl(filePath)\n      const publicUrl = urlData.publicUrl\n\n      const { error: updateError } = await supabase\n        .from('profiles')\n        .update({\n          avatar_url: publicUrl,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('user_id', user.id)\n\n      if (updateError) throw updateError\n\n      setAvatarUrl(publicUrl)\n      alert('アイコンを更新しました')\n    } catch (err: any) {\n      alert(err.message || 'アイコンのアップロードに失敗しました')\n    } finally {\n      setIsUploadingAvatar(false)\n      if (avatarInputRef.current) {\n        avatarInputRef.current.value = ''\n      }\n    }\n  }\n\n  const handleLogout = async () => {\n    try {\n      const supabase = createClient()\n      await supabase.auth.signOut()\n      router.push('/login')\n      router.refresh()\n    } catch (err: any) {\n      setError(err.message || 'ログアウトに失敗しました')\n    }\n  }\n\n  if (isLoadingProfile) {\n    return (\n      <div className=\"w-full px-4 py-8\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">読み込み中...</p>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-full px-3 py-6\">\n      <Card className=\"shadow-lg\">\n        <CardHeader>\n          <CardTitle>設定</CardTitle>\n          <CardDescription>学習目標を更新できます</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\n            {error && (\n              <div className=\"p-3 text-sm text-red-600 bg-red-50 rounded-md\">\n                {error}\n              </div>\n            )}\n\n            <div className=\"flex items-center gap-4\">\n              <div className=\"relative w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center\">\n                {avatarUrl ? (\n                  <Image src={avatarUrl} alt=\"アイコン\" fill className=\"object-cover\" />\n                ) : (\n                  <User className=\"w-7 h-7 text-slate-400\" />\n                )}\n              </div>\n              <div className=\"space-y-2\">\n                <input\n                  ref={avatarInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleAvatarSelect}\n                  className=\"hidden\"\n                />\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => avatarInputRef.current?.click()}\n                  disabled={isUploadingAvatar}\n                >\n                  {isUploadingAvatar ? 'アップロード中...' : 'アイコンを変更'}\n                </Button>\n                <p className=\"text-xs text-muted-foreground\">正方形の画像がきれいに表示されます</p>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"weekday_target_minutes\">平日の目標学習時間（分）</Label>\n              <Input\n                id=\"weekday_target_minutes\"\n                type=\"number\"\n                min=\"1\"\n                max=\"1440\"\n                placeholder=\"60\"\n                {...register('weekday_target_minutes', {\n                  valueAsNumber: true,\n                })}\n              />\n              {errors.weekday_target_minutes && (\n                <p className=\"text-sm text-red-600\">\n                  {errors.weekday_target_minutes.message}\n                </p>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"weekend_target_minutes\">土日祝の目標学習時間（分）</Label>\n              <Input\n                id=\"weekend_target_minutes\"\n                type=\"number\"\n                min=\"1\"\n                max=\"1440\"\n                placeholder=\"120\"\n                {...register('weekend_target_minutes', {\n                  valueAsNumber: true,\n                })}\n              />\n              {errors.weekend_target_minutes && (\n                <p className=\"text-sm text-red-600\">\n                  {errors.weekend_target_minutes.message}\n                </p>\n              )}\n            </div>\n\n            <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n              {isLoading ? '更新中...' : '設定を更新'}\n            </Button>\n          </form>\n\n          <div className=\"mt-6 pt-6 border-t space-y-3\">\n            <Button\n              type=\"button\"\n              variant=\"destructive\"\n              className=\"w-full\"\n              onClick={handleLogout}\n            >\n              ログアウト\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\app\\study\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TimerState' is defined but never used.","line":11,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":74,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TimerState"},"fix":{"range":[550,567],"text":""},"desc":"Remove unused variable \"TimerState\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3210,3213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3210,3213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3459,3462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3459,3462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":346,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":346,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10267,10270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10267,10270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":371,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11049,11052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11049,11052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { Play, Pause, Square } from 'lucide-react'\nimport { createClient } from '@/lib/supabase/client'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { MascotMessage } from '@/components/mascot-message'\nimport { ReferenceBookManager } from '@/components/reference-book-manager'\nimport { saveTimerState, loadTimerState, clearTimerState, type TimerState } from '@/lib/storage/study-timer'\nimport { getStudyDay, getStudyDayDate } from '@/lib/date-utils'\nimport type { ReferenceBook } from '@/types/database'\n\ntype ReviewTask = {\n  id: string\n  due_at: string\n  status: string\n  study_log_id: string\n  study_logs?: {\n    note: string | null\n    subject: string | null\n    started_at: string | null\n  } | null\n}\n\ntype QuizQuestion = {\n  question: string\n  choices: string[]\n  correct_index: number\n  explanation?: string\n  theme?: string\n}\n\ntype ThemeQuizState = {\n  loading: boolean\n  questions: QuizQuestion[]\n  answers: Record<number, number>\n}\n\ntype QuizState = {\n  themes: Record<string, ThemeQuizState>\n}\n\nexport default function StudyPage() {\n  const router = useRouter()\n  const [referenceBooks, setReferenceBooks] = useState<ReferenceBook[]>([])\n  const [selectedBookId, setSelectedBookId] = useState<string | null>(null)\n  const [isRunning, setIsRunning] = useState(false)\n  const [seconds, setSeconds] = useState(0)\n  const [isSaving, setIsSaving] = useState(false)\n  const [successMessage, setSuccessMessage] = useState<string | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const [showBookPicker, setShowBookPicker] = useState(false)\n  const [reviewTasks, setReviewTasks] = useState<ReviewTask[]>([])\n  const [quizByTask, setQuizByTask] = useState<Record<string, QuizState>>({})\n  const [skippedThemes, setSkippedThemes] = useState<Record<string, string[]>>({})\n  const intervalRef = useRef<NodeJS.Timeout | null>(null)\n  const startTimeRef = useRef<number | null>(null)\n\n  // 教材一覧を読み込む\n  useEffect(() => {\n    const loadReferenceBooks = async () => {\n      try {\n        const supabase = createClient()\n        const {\n          data: { user },\n        } = await supabase.auth.getUser()\n\n        if (!user) {\n          router.push('/login')\n          return\n        }\n\n        const [{ data, error }, { data: tasksData, error: tasksError }] = await Promise.all([\n          supabase\n            .from('reference_books')\n            .select('*')\n            .eq('user_id', user.id)\n            .is('deleted_at', null)\n            .order('created_at', { ascending: false }),\n          supabase\n            .from('review_tasks')\n            .select('id, due_at, status, study_log_id, study_logs(note, subject, started_at)')\n            .eq('user_id', user.id)\n            .eq('status', 'pending')\n            .lte('due_at', new Date().toISOString())\n            .order('due_at', { ascending: true }),\n        ])\n\n        if (error) throw error\n        if (tasksError) throw tasksError\n        setReferenceBooks(data || [])\n        const normalizedTasks = ((tasksData as any[]) || []).map((task) => ({\n          ...task,\n          study_logs: Array.isArray(task.study_logs) ? task.study_logs[0] ?? null : task.study_logs ?? null,\n        })) as ReviewTask[]\n        setReviewTasks(normalizedTasks)\n      } catch (error: any) {\n        console.error('Failed to load reference books:', error)\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    loadReferenceBooks()\n  }, [router])\n\n  // タイマー状態を復元\n  useEffect(() => {\n    const saved = loadTimerState()\n    if (saved) {\n      setSelectedBookId(saved.referenceBookId)\n      if (saved.isRunning && saved.startTime) {\n        // 経過時間を再計算\n        const elapsed = Math.floor((Date.now() - saved.startTime) / 1000)\n        setSeconds(saved.seconds + elapsed)\n        setIsRunning(true)\n        startTimeRef.current = saved.startTime\n      } else {\n        setSeconds(saved.seconds)\n        setIsRunning(false)\n      }\n    }\n  }, [])\n\n  // タイマーの実行\n  useEffect(() => {\n    if (isRunning) {\n      intervalRef.current = setInterval(() => {\n        setSeconds((prev) => {\n          const newSeconds = prev + 1\n          // 状態を保存\n          saveTimerState({\n            isRunning: true,\n            seconds: newSeconds,\n            referenceBookId: selectedBookId,\n            startTime: startTimeRef.current || Date.now(),\n          })\n          return newSeconds\n        })\n      }, 1000)\n    } else {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current)\n      }\n      // 停止時も状態を保存\n      if (selectedBookId !== null) {\n        saveTimerState({\n          isRunning: false,\n          seconds,\n          referenceBookId: selectedBookId,\n          startTime: null,\n        })\n      }\n    }\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current)\n      }\n    }\n  }, [isRunning, selectedBookId, seconds])\n\n  // ページが非表示になった時も計測を続ける（バックグラウンド計測）\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.hidden && isRunning && startTimeRef.current) {\n        // ページが非表示になった時、現在の経過時間を保存\n        const elapsed = Math.floor((Date.now() - startTimeRef.current) / 1000)\n        saveTimerState({\n          isRunning: true,\n          seconds: seconds + elapsed,\n          referenceBookId: selectedBookId,\n          startTime: startTimeRef.current,\n        })\n      } else if (!document.hidden && isRunning && startTimeRef.current) {\n        // ページが表示された時、経過時間を再計算\n        const elapsed = Math.floor((Date.now() - startTimeRef.current) / 1000)\n        setSeconds((prev) => prev + elapsed)\n      }\n    }\n\n    document.addEventListener('visibilitychange', handleVisibilityChange)\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange)\n    }\n  }, [isRunning, selectedBookId, seconds])\n\n  const formatTime = (totalSeconds: number) => {\n    const hours = Math.floor(totalSeconds / 3600)\n    const minutes = Math.floor((totalSeconds % 3600) / 60)\n    const secs = totalSeconds % 60\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`\n  }\n\n  const handleStart = () => {\n    if (!selectedBookId) {\n      alert('教材を選択してください')\n      return\n    }\n    setIsRunning(true)\n    startTimeRef.current = Date.now()\n    saveTimerState({\n      isRunning: true,\n      seconds: 0,\n      referenceBookId: selectedBookId,\n      startTime: Date.now(),\n    })\n  }\n\n  const handlePause = () => {\n    setIsRunning(false)\n    startTimeRef.current = null\n  }\n\n  const handleStop = async () => {\n    setIsRunning(false)\n    \n    if (seconds === 0) {\n      setSeconds(0)\n      startTimeRef.current = null\n      clearTimerState()\n      return\n    }\n\n    const minutes = Math.floor(seconds / 60)\n    // 1分未満の場合は保存しない（59秒以下は記録されない）\n    if (minutes < 1) {\n      setSeconds(0)\n      startTimeRef.current = null\n      clearTimerState()\n      alert('1分以上の学習時間を記録してください（現在: ' + Math.floor(seconds) + '秒）')\n      return\n    }\n    \n    // デバッグ: 保存する分数を確認\n    console.log('Saving study log:', { seconds, minutes, selectedBookId })\n\n    // 教材が選択されていない場合は保存できない\n    if (!selectedBookId) {\n      alert('教材を選択してください')\n      setIsRunning(false)\n      setSeconds(0)\n      startTimeRef.current = null\n      clearTimerState()\n      return\n    }\n\n    await saveStudyLog(selectedBookId, minutes, new Date().toISOString(), '')\n\n    setSeconds(0)\n    startTimeRef.current = null\n    clearTimerState()\n  }\n\n  const saveStudyLog = async (\n    referenceBookId: string,\n    minutes: number,\n    startedAt: string,\n    note: string\n  ) => {\n    setIsSaving(true)\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n\n      if (!user) {\n        alert('ログインが必要です')\n        router.push('/login')\n        return\n      }\n\n      // 教材が有効か確認（削除されていないか）\n      const { data: bookData } = await supabase\n        .from('reference_books')\n        .select('id, name')\n        .eq('id', referenceBookId)\n        .is('deleted_at', null)\n        .single()\n\n      if (!bookData) {\n        throw new Error('選択された教材が見つかりません。教材を再選択してください。')\n      }\n\n      const subject = bookData.name?.trim() || 'その他'\n\n      if (!subject || subject.length === 0) {\n        throw new Error('科目名が設定されていません')\n      }\n\n      console.log('Saving study log:', { minutes, subject, startedAt, referenceBookId })\n      \n      const { data, error } = await supabase\n        .from('study_logs')\n        .insert({\n          user_id: user.id,\n          subject: subject,\n          reference_book_id: referenceBookId || null,\n          study_minutes: minutes,\n          started_at: startedAt,\n          note: note.trim() || null,\n        })\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Study log save error:', error)\n        throw new Error(`保存に失敗しました: ${error.message}`)\n      }\n\n      if (!data) {\n        throw new Error('保存に失敗しました: データが返されませんでした')\n      }\n      \n      console.log('Study log saved successfully:', data)\n\n      if (note.trim()) {\n        const baseDate = new Date(startedAt)\n        baseDate.setHours(12, 0, 0, 0)\n        const reviewDays = [1, 3, 7, 14, 30]\n        const tasks = reviewDays.map((days) => {\n          const due = new Date(baseDate)\n          due.setDate(due.getDate() + days)\n          return {\n            user_id: user.id,\n            study_log_id: data.id,\n            due_at: due.toISOString(),\n            status: 'pending',\n          }\n        })\n\n        const { error: taskError } = await supabase.from('review_tasks').insert(tasks)\n        if (taskError) {\n          console.warn('Failed to create review tasks:', taskError)\n        } else {\n          const { data: tasksData } = await supabase\n            .from('review_tasks')\n            .select('id, due_at, status, study_log_id, study_logs(note, subject, started_at)')\n            .eq('user_id', user.id)\n            .eq('status', 'pending')\n            .lte('due_at', new Date().toISOString())\n            .order('due_at', { ascending: true })\n          const normalizedTasks = ((tasksData as any[]) || []).map((task) => ({\n            ...task,\n            study_logs: Array.isArray(task.study_logs) ? task.study_logs[0] ?? null : task.study_logs ?? null,\n          })) as ReviewTask[]\n          setReviewTasks(normalizedTasks)\n        }\n      }\n\n      const messages = [\n        `🎉 ${subject}を${minutes}分学習したね！素晴らしい！`,\n        `✨ ${minutes}分の学習、お疲れ様！合格に一歩近づいたよ！`,\n        `💪 ${subject}を${minutes}分頑張ったね！この調子で続けよう！`,\n        `🔥 ${minutes}分の学習を記録したよ！連続記録を更新しよう！`,\n      ]\n      setSuccessMessage(messages[Math.floor(Math.random() * messages.length)])\n\n      // カスタムイベントで記録画面に通知\n      window.dispatchEvent(new Event('studyLogSaved'))\n\n      // 保存成功後、すぐにリフレッシュ\n      router.refresh()\n\n      setTimeout(() => {\n        setSuccessMessage(null)\n      }, 3000)\n    } catch (err: any) {\n      console.error('Save study log error:', err)\n      alert(err.message || '保存に失敗しました。もう一度お試しください。')\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  const splitThemes = (note: string): string[] => {\n    const lines = note\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter(Boolean)\n      .map((line) => line.replace(/^[-*•・]\\s*/, '').trim())\n      .filter(Boolean)\n\n    if (lines.length === 0) return []\n    if (lines.length === 1) return [lines[0]]\n    return lines\n  }\n\n  const formatDueLabel = (studyStartedAt?: string | null): string => {\n    if (!studyStartedAt) return ''\n    const dueStudyDay = getStudyDay(new Date(studyStartedAt))\n    const todayStudyDay = getStudyDay(new Date())\n    const dueDate = getStudyDayDate(dueStudyDay)\n    const todayDate = getStudyDayDate(todayStudyDay)\n    const diffDays = Math.round((todayDate.getTime() - dueDate.getTime()) / (24 * 60 * 60 * 1000))\n    const labelDate = dueDate.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' })\n    if (diffDays === 0) return `${labelDate}(今日)`\n    if (diffDays === 1) return `${labelDate}(1日前)`\n    if (diffDays > 1) return `${labelDate}(${diffDays}日前)`\n    return `${labelDate}(${Math.abs(diffDays)}日後)`\n  }\n\n  const handleGenerateQuiz = async (task: ReviewTask, theme?: string) => {\n    const note = task.study_logs?.note?.trim()\n    if (!note) return\n    const themeValue = theme || note\n    setQuizByTask((prev) => {\n      const current = prev[task.id]?.themes || {}\n      const existing = current[themeValue]\n      return {\n        ...prev,\n        [task.id]: {\n          themes: {\n            ...current,\n            [themeValue]: {\n              loading: true,\n              questions: existing?.questions || [],\n              answers: existing?.answers || {},\n            },\n          },\n        },\n      }\n    })\n    try {\n      const targetThemes = [themeValue]\n      const results = await Promise.all(\n        targetThemes.map(async (themeItem) => {\n          const response = await fetch('/api/quiz', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ note: themeItem, count: 3 }),\n          })\n          if (!response.ok) {\n            throw new Error('クイズの生成に失敗しました')\n          }\n          const data = await response.json()\n          const questions = (data.questions || []).map((q: QuizQuestion) => ({\n            ...q,\n            theme: themeItem,\n          }))\n          return questions\n        })\n      )\n      const questions = results.flat()\n      setQuizByTask((prev) => {\n        const current = prev[task.id]?.themes || {}\n        const existing = current[themeValue]\n        return {\n          ...prev,\n          [task.id]: {\n            themes: {\n              ...current,\n              [themeValue]: {\n                loading: false,\n                questions,\n                answers: existing?.answers || {},\n              },\n            },\n          },\n        }\n      })\n    } catch (error) {\n      console.error('Failed to generate quiz:', error)\n      setQuizByTask((prev) => {\n        const next = { ...prev }\n        delete next[task.id]\n        return next\n      })\n      alert('クイズの生成に失敗しました。もう一度お試しください。')\n    }\n  }\n\n  const handleAnswer = async (taskId: string, theme: string, qIndex: number, choiceIndex: number) => {\n    const quiz = quizByTask[taskId]\n    const themeQuiz = quiz?.themes[theme]\n    if (!themeQuiz || themeQuiz.loading) return\n    if (themeQuiz.answers[qIndex] !== undefined) return\n\n    const question = themeQuiz.questions[qIndex]\n    if (!question) return\n\n    const isCorrect = choiceIndex === question.correct_index\n    const supabase = createClient()\n    try {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n      if (!user) return\n      await supabase.from('quiz_attempts').insert({\n        user_id: user.id,\n        review_task_id: taskId,\n        question: question.question,\n        choices: question.choices,\n        correct_index: question.correct_index,\n        selected_index: choiceIndex,\n        is_correct: isCorrect,\n      })\n    } catch (error) {\n      console.warn('Failed to save quiz attempt:', error)\n    }\n\n    const nextAnswers = { ...themeQuiz.answers, [qIndex]: choiceIndex }\n    const nextThemes = {\n      ...(quiz?.themes || {}),\n      [theme]: { ...themeQuiz, answers: nextAnswers },\n    }\n    const nextQuizState = { themes: nextThemes }\n    setQuizByTask((prev) => ({\n      ...prev,\n      [taskId]: nextQuizState,\n    }))\n\n    const task = reviewTasks.find((t) => t.id === taskId)\n    const allThemes = (() => {\n      const list = splitThemes(task?.study_logs?.note || '')\n      return list.length > 0 ? list : [task?.study_logs?.note || '']\n    })()\n    const hidden = skippedThemes[taskId] || []\n    const isComplete = allThemes.every((themeItem) => {\n      if (hidden.includes(themeItem)) return true\n      const state = nextThemes[themeItem]\n      if (!state || state.questions.length === 0) return false\n      return Object.keys(state.answers).length >= state.questions.length\n    })\n\n    if (isComplete) {\n      try {\n        await supabase.from('review_tasks').update({ status: 'completed' }).eq('id', taskId)\n      } catch (error) {\n        console.warn('Failed to complete review task:', error)\n      } finally {\n        setReviewTasks((prev) => prev.filter((t) => t.id !== taskId))\n        setQuizByTask((prev) => {\n          const next = { ...prev }\n          delete next[taskId]\n          return next\n        })\n        setSkippedThemes((prev) => {\n          const next = { ...prev }\n          delete next[taskId]\n          return next\n        })\n      }\n    }\n  }\n\n  const handleSkipTask = async (taskId: string) => {\n    const supabase = createClient()\n    try {\n      await supabase.from('review_tasks').update({ status: 'skipped' }).eq('id', taskId)\n    } catch (error) {\n      console.warn('Failed to skip review task:', error)\n    } finally {\n      setReviewTasks((prev) => prev.filter((t) => t.id !== taskId))\n      setQuizByTask((prev) => {\n        const next = { ...prev }\n        delete next[taskId]\n        return next\n      })\n    }\n  }\n\n  const handleSkipTheme = (taskId: string, theme: string, remainingThemes: string[]) => {\n    setSkippedThemes((prev) => {\n      const current = prev[taskId] || []\n      if (current.includes(theme)) return prev\n      return { ...prev, [taskId]: [...current, theme] }\n    })\n    setQuizByTask((prev) => {\n      const current = prev[taskId]\n      if (!current) return prev\n      const nextThemes = { ...current.themes }\n      delete nextThemes[theme]\n      return { ...prev, [taskId]: { themes: nextThemes } }\n    })\n\n    const nextRemaining = remainingThemes.filter((t) => t !== theme)\n    if (nextRemaining.length === 0) {\n      handleSkipTask(taskId)\n    }\n  }\n\n  const getEncouragementMessage = (): string => {\n    const minutes = Math.floor(seconds / 60)\n    if (minutes === 0) {\n      return '🚀 学習を始めよう！一緒に頑張るよ！'\n    } else if (minutes < 30) {\n      return `💪 ${minutes}分経過！この調子で続けよう！`\n    } else if (minutes < 60) {\n      return `✨ ${minutes}分頑張ってるね！素晴らしい集中力だよ！`\n    } else {\n      return `🔥 ${Math.floor(minutes / 60)}時間以上！本当に頑張ってるね！`\n    }\n  }\n\n  const selectedBook = referenceBooks.find((b) => b.id === selectedBookId)\n  const tasksWithNote = reviewTasks.filter((task) => task.study_logs?.note?.trim())\n\n  if (isLoading) {\n    return (\n      <div className=\"w-full px-4 py-8\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">読み込み中...</p>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-full px-3 py-6\">\n      <div className=\"space-y-6\">\n        {/* 成功メッセージ */}\n        {successMessage && (\n          <Card className=\"shadow-lg bg-gradient-to-r from-green-50 to-emerald-50 border-green-200\">\n            <CardContent className=\"pt-6\">\n              <MascotMessage message={successMessage} emotion=\"excited\" />\n            </CardContent>\n          </Card>\n        )}\n\n        {/* 学習中の励ましメッセージ */}\n        {isRunning && seconds > 0 && (\n          <Card className=\"shadow-lg bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200\">\n            <CardContent className=\"pt-6\">\n              <MascotMessage message={getEncouragementMessage()} emotion=\"encouraging\" />\n            </CardContent>\n          </Card>\n        )}\n\n        {/* 教材選択 */}\n        <Card className=\"shadow-lg\">\n          <CardHeader>\n            <CardTitle>教材選択</CardTitle>\n            <CardDescription>学習する教材を選択してください</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"text-sm text-muted-foreground\">\n                {selectedBook ? selectedBook.name : '教材が未選択です'}\n              </div>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setShowBookPicker((prev) => !prev)}\n              >\n                {showBookPicker ? '閉じる' : '教材を選ぶ'}\n              </Button>\n            </div>\n\n            {showBookPicker && (\n              <div className=\"mt-4\">\n                <ReferenceBookManager\n                  referenceBooks={referenceBooks}\n                  selectedBookId={selectedBookId}\n                  onSelect={(bookId) => {\n                    if (isRunning) {\n                      alert('計測中は参考書を変更できません')\n                      return\n                    }\n                    setSelectedBookId(bookId)\n                    setShowBookPicker(false)\n                  }}\n                  onRefresh={async () => {\n                    const supabase = createClient()\n                    const {\n                      data: { user },\n                    } = await supabase.auth.getUser()\n                    if (user) {\n                      const { data } = await supabase\n                        .from('reference_books')\n                        .select('*')\n                        .eq('user_id', user.id)\n                        .is('deleted_at', null)\n                        .order('created_at', { ascending: false })\n                      setReferenceBooks(data || [])\n                    }\n                  }}\n                />\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* ストップウォッチ */}\n        <Card className=\"shadow-lg\">\n          <CardHeader>\n            <CardTitle>リアルタイム計測</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"text-center\">\n              <div className=\"text-6xl font-mono font-bold text-primary mb-4\">\n                {formatTime(seconds)}\n              </div>\n              <div className=\"text-sm text-muted-foreground\">\n                {selectedBook ? selectedBook.name : '教材を選択してください'}\n              </div>\n            </div>\n\n            <div className=\"flex justify-center gap-2\">\n              {!isRunning ? (\n                <Button\n                  onClick={handleStart}\n                  disabled={!selectedBookId || isSaving}\n                  size=\"lg\"\n                  className=\"flex-1\"\n                  title={!selectedBookId ? '教材を選択してください' : ''}\n                >\n                  <Play className=\"w-5 h-5 mr-2\" />\n                  {!selectedBookId ? '教材を選択してください' : '開始'}\n                </Button>\n              ) : (\n                <>\n                  <Button\n                    onClick={handlePause}\n                    variant=\"outline\"\n                    size=\"lg\"\n                    className=\"flex-1\"\n                  >\n                    <Pause className=\"w-5 h-5 mr-2\" />\n                    一時停止\n                  </Button>\n                  <Button\n                    onClick={handleStop}\n                    variant=\"destructive\"\n                    size=\"lg\"\n                    className=\"flex-1\"\n                    disabled={isSaving}\n                  >\n                    <Square className=\"w-5 h-5 mr-2\" />\n                    停止・保存\n                  </Button>\n                </>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* 復習カード */}\n        <Card className=\"shadow-lg\">\n          <CardHeader>\n            <CardTitle>復習カード</CardTitle>\n            <CardDescription>忘却曲線に合わせて今日の復習を出題します</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {tasksWithNote.length === 0 && (\n              <div className=\"text-sm text-muted-foreground\">今日は復習タスクがありません</div>\n            )}\n            {tasksWithNote.map((task) => {\n              const quiz = quizByTask[task.id]\n              const themes = splitThemes(task.study_logs?.note || '')\n              const cardThemes = themes.length > 0 ? themes : [task.study_logs?.note || '']\n              const hiddenThemes = skippedThemes[task.id] || []\n              const visibleThemes = cardThemes.filter((theme) => !hiddenThemes.includes(theme))\n              return (\n                <div key={task.id} className=\"space-y-3\">\n                  {visibleThemes.map((theme, index) => (\n                    <div key={`${task.id}-theme-${index}`} className=\"rounded-lg border border-muted p-3 space-y-3\">\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div className=\"text-sm font-semibold text-foreground\">\n                          {task.study_logs?.subject || '学習内容'}\n                        </div>\n                        <div className=\"text-xs text-muted-foreground\">\n                      {formatDueLabel(task.study_logs?.started_at)}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\n                          {theme}\n                        </div>\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleSkipTheme(task.id, theme, visibleThemes)}\n                        >\n                          このテーマを消す\n                        </Button>\n                      </div>\n                      {(() => {\n                        const themeQuiz = quiz?.themes?.[theme]\n                        if (!themeQuiz) return true\n                        return !themeQuiz.loading && themeQuiz.questions.length === 0\n                      })() && (\n                        <div className=\"flex flex-wrap items-center gap-2\">\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            onClick={() => handleGenerateQuiz(task, theme)}\n                          >\n                            4択を作成（3問）\n                          </Button>\n                        </div>\n                      )}\n                      {quiz?.themes?.[theme]?.loading && (\n                        <div className=\"text-sm text-muted-foreground\">クイズ作成中...</div>\n                      )}\n                      {quiz?.themes?.[theme] && !quiz.themes[theme].loading && quiz.themes[theme].questions.length > 0 && (\n                        <div className=\"space-y-4\">\n                          {quiz.themes[theme].questions.map((q, qIndex) => {\n                              const answered = quiz.themes[theme].answers[qIndex] !== undefined\n                              const correctText = q.choices?.[q.correct_index] ?? ''\n                              return (\n                                <div key={`${task.id}-${theme}-${qIndex}`} className=\"space-y-2\">\n                                  <div className=\"text-sm font-medium\">{qIndex + 1}. {q.question}</div>\n                                  <div className=\"grid gap-2\">\n                                    {q.choices.map((choice, cIndex) => {\n                                      const selected = quiz.themes[theme].answers[qIndex] === cIndex\n                                      const isCorrect = q.correct_index === cIndex\n                                      return (\n                                        <button\n                                          key={`${task.id}-${theme}-${qIndex}-${cIndex}`}\n                                          type=\"button\"\n                                          onClick={() => handleAnswer(task.id, theme, qIndex, cIndex)}\n                                          className={`text-left rounded-md border px-3 py-2 text-sm transition ${\n                                            selected\n                                              ? isCorrect\n                                                ? 'border-green-500 bg-green-50 text-green-700'\n                                                : 'border-red-500 bg-red-50 text-red-700'\n                                              : 'border-input hover:bg-muted'\n                                          } ${answered ? 'cursor-default' : 'cursor-pointer'}`}\n                                          disabled={answered}\n                                        >\n                                          {choice}\n                                        </button>\n                                      )\n                                    })}\n                                  </div>\n                                  {answered && (\n                                    <>\n                                      <div\n                                        className={`text-sm font-semibold ${\n                                          quiz.themes[theme].answers[qIndex] === q.correct_index\n                                            ? 'text-green-600'\n                                            : 'text-red-600'\n                                        }`}\n                                      >\n                                        {quiz.themes[theme].answers[qIndex] === q.correct_index ? '○ 正解' : '× 不正解'}\n                                        <span className=\"ml-2 text-muted-foreground\">\n                                          正解: {q.correct_index + 1}番（{correctText}）\n                                        </span>\n                                      </div>\n                                      {q.explanation && (\n                                        <div className=\"rounded-md border border-muted bg-muted/40 px-3 py-2 text-sm whitespace-pre-wrap\">\n                                          解説: {q.explanation}\n                                        </div>\n                                      )}\n                                    </>\n                                  )}\n                                </div>\n                              )\n                            })}\n                          {(() => {\n                            const themeQuiz = quiz.themes[theme]\n                            const isThemeComplete =\n                              themeQuiz.questions.length > 0 &&\n                              Object.keys(themeQuiz.answers).length >= themeQuiz.questions.length\n                            if (!isThemeComplete) return null\n                            return (\n                              <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => handleSkipTheme(task.id, theme, visibleThemes)}\n                              >\n                                完了して戻る\n                              </Button>\n                            )\n                          })()}\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                  {visibleThemes.length === 0 && (\n                    <div className=\"text-sm text-muted-foreground\">\n                      この日の復習テーマはすべて非表示にしました\n                    </div>\n                  )}\n                </div>\n              )\n            })}\n          </CardContent>\n        </Card>\n\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2210,2213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2210,2213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Image from 'next/image'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport * as z from 'zod'\nimport { createClient } from '@/lib/supabase/client'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\n\nconst loginSchema = z.object({\n  email: z.string().email('有効なメールアドレスを入力してください'),\n  password: z.string().min(6, 'パスワードは6文字以上で入力してください'),\n})\n\ntype LoginForm = z.infer<typeof loginSchema>\n\nexport default function LoginPage() {\n  const router = useRouter()\n  const [isSignUp, setIsSignUp] = useState(false)\n  const [isLoading, setIsLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n  } = useForm<LoginForm>({\n    resolver: zodResolver(loginSchema),\n  })\n\n  const onSubmit = async (data: LoginForm) => {\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const supabase = createClient()\n\n      if (isSignUp) {\n        const { data: signUpData, error } = await supabase.auth.signUp({\n          email: data.email,\n          password: data.password,\n        })\n\n        if (error) throw error\n\n        // サインアップ成功後、セッションが確立されるまで少し待つ\n        if (signUpData.user) {\n          // セッションが確立されるまで最大2秒待機\n          let retries = 0\n          while (retries < 10) {\n            const {\n              data: { session },\n            } = await supabase.auth.getSession()\n            if (session) break\n            await new Promise((resolve) => setTimeout(resolve, 200))\n            retries++\n          }\n        }\n\n        // オンボーディングへ\n        router.push('/onboarding')\n        router.refresh()\n      } else {\n        const { error } = await supabase.auth.signInWithPassword({\n          email: data.email,\n          password: data.password,\n        })\n\n        if (error) throw error\n\n        // サインイン成功後、リフレッシュしてmiddlewareでリダイレクト\n        router.refresh()\n      }\n    } catch (err: any) {\n      setError(err.message || 'エラーが発生しました')\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-b from-blue-50 to-white\">\n      <div className=\"w-full max-w-md space-y-8\">\n        {/* マスコット画像 */}\n        <div className=\"flex justify-center\">\n          <div className=\"relative w-32 h-32\">\n            <Image\n              src=\"/images/mascot.png\"\n              alt=\"マスコット\"\n              fill\n              className=\"object-contain\"\n              priority\n            />\n          </div>\n        </div>\n\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"space-y-1\">\n            <CardTitle className=\"text-2xl font-bold text-center\">\n              {isSignUp ? '新規登録' : 'ログイン'}\n            </CardTitle>\n            <CardDescription className=\"text-center\">\n              {isSignUp\n                ? 'アカウントを作成して学習を始めましょう'\n                : 'まなびAIへようこそ'}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\n              {error && (\n                <div className=\"p-3 text-sm text-red-600 bg-red-50 rounded-md\">\n                  {error}\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">メールアドレス</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"example@email.com\"\n                  {...register('email')}\n                />\n                {errors.email && (\n                  <p className=\"text-sm text-red-600\">{errors.email.message}</p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">パスワード</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"••••••••\"\n                  {...register('password')}\n                />\n                {errors.password && (\n                  <p className=\"text-sm text-red-600\">{errors.password.message}</p>\n                )}\n              </div>\n\n              <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n                {isLoading ? '処理中...' : isSignUp ? '新規登録' : 'ログイン'}\n              </Button>\n\n              <div className=\"text-center\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setIsSignUp(!isSignUp)\n                    setError(null)\n                  }}\n                  className=\"text-sm text-primary hover:underline\"\n                >\n                  {isSignUp\n                    ? '既にアカウントをお持ちの方はこちら'\n                    : '新規登録はこちら'}\n                </button>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\onboarding\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentDeviation' is assigned a value but never used.","line":49,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3880,3883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3880,3883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Image from 'next/image'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport * as z from 'zod'\nimport { createClient } from '@/lib/supabase/client'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\n\nconst onboardingSchema = z.object({\n  school_name: z.string().min(1, '志望校名を入力してください'),\n  current_deviation: z\n    .number()\n    .min(0, '偏差値は0以上で入力してください')\n    .max(100, '偏差値は100以下で入力してください'),\n  target_deviation: z\n    .number()\n    .min(0, '目標偏差値は0以上で入力してください')\n    .max(100, '目標偏差値は100以下で入力してください'),\n  exam_date: z.string().optional(), // 第1段階ではオプショナル\n})\n\ntype OnboardingForm = z.infer<typeof onboardingSchema>\n\nexport default function OnboardingPage() {\n  const router = useRouter()\n  const [isLoading, setIsLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const {\n    register,\n    handleSubmit,\n    watch,\n    formState: { errors },\n  } = useForm<OnboardingForm>({\n    resolver: zodResolver(onboardingSchema),\n    defaultValues: {\n      current_deviation: 50,\n      target_deviation: 50,\n      exam_date: undefined, // 第1段階ではオプショナル\n    },\n  })\n\n  const currentDeviation = watch('current_deviation')\n\n  // 目標偏差値が変更されたら、現在偏差値と同じ値に更新\n  const handleCurrentDeviationChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = parseFloat(e.target.value) || 0\n    // 目標偏差値も同じ値に設定\n    const targetInput = document.getElementById('target_deviation') as HTMLInputElement\n    if (targetInput) {\n      targetInput.value = value.toString()\n    }\n  }\n\n  const onSubmit = async (data: OnboardingForm) => {\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const supabase = createClient()\n      \n      // セッションを確認し、必要に応じて再取得\n      let {\n        data: { user },\n      } = await supabase.auth.getUser()\n\n      // ユーザーが取得できない場合、セッションを再取得\n      if (!user) {\n        const {\n          data: { session },\n        } = await supabase.auth.getSession()\n        \n        if (!session) {\n          // セッションがない場合、少し待ってから再試行\n          await new Promise((resolve) => setTimeout(resolve, 500))\n          const retryResult = await supabase.auth.getUser()\n          user = retryResult.data.user\n        } else {\n          // セッションがある場合は、ユーザー情報を再取得\n          const retryResult = await supabase.auth.getUser()\n          user = retryResult.data.user\n        }\n      }\n\n      if (!user) {\n        throw new Error('ログインが必要です。ページをリロードして再度お試しください。')\n      }\n\n      // プロフィールを作成\n      const { error: profileError } = await supabase.from('profiles').insert({\n        user_id: user.id,\n        school_name: data.school_name,\n        current_deviation: data.current_deviation,\n        target_deviation: data.target_deviation,\n        exam_date: data.exam_date || null, // オプショナルなのでnullを許可\n        onboarding_completed: true,\n      })\n\n      if (profileError) {\n        // 既にプロフィールが存在する場合は更新\n        if (profileError.code === '23505') {\n          const { error: updateError } = await supabase\n            .from('profiles')\n            .update({\n              school_name: data.school_name,\n              current_deviation: data.current_deviation,\n              target_deviation: data.target_deviation,\n              exam_date: data.exam_date || null, // オプショナルなのでnullを許可\n              onboarding_completed: true,\n              updated_at: new Date().toISOString(),\n            })\n            .eq('user_id', user.id)\n\n          if (updateError) throw updateError\n        } else {\n          throw profileError\n        }\n      }\n\n      // オンボーディング完了後、ホームへ\n      router.push('/app/home')\n      router.refresh()\n    } catch (err: any) {\n      setError(err.message || 'エラーが発生しました')\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-b from-blue-50 to-white\">\n      <div className=\"w-full max-w-md space-y-8\">\n        {/* マスコット画像 */}\n        <div className=\"flex justify-center\">\n          <div className=\"relative w-32 h-32\">\n            <Image\n              src=\"/images/mascot.png\"\n              alt=\"マスコット\"\n              fill\n              className=\"object-contain\"\n              priority\n            />\n          </div>\n        </div>\n\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"space-y-1\">\n            <CardTitle className=\"text-2xl font-bold text-center\">\n              初回設定\n            </CardTitle>\n            <CardDescription className=\"text-center\">\n              志望校、現在の偏差値、試験年度を入力してください\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\n              {error && (\n                <div className=\"p-3 text-sm text-red-600 bg-red-50 rounded-md\">\n                  {error}\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"school_name\">志望校名</Label>\n                <Input\n                  id=\"school_name\"\n                  type=\"text\"\n                  placeholder=\"例: 東京大学\"\n                  {...register('school_name')}\n                />\n                {errors.school_name && (\n                  <p className=\"text-sm text-red-600\">{errors.school_name.message}</p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"current_deviation\">現在の偏差値</Label>\n                <Input\n                  id=\"current_deviation\"\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"100\"\n                  step=\"0.1\"\n                  placeholder=\"50\"\n                  {...register('current_deviation', {\n                    valueAsNumber: true,\n                    onChange: handleCurrentDeviationChange,\n                  })}\n                />\n                {errors.current_deviation && (\n                  <p className=\"text-sm text-red-600\">\n                    {errors.current_deviation.message}\n                  </p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"target_deviation\">目標偏差値</Label>\n                <Input\n                  id=\"target_deviation\"\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"100\"\n                  step=\"0.1\"\n                  placeholder=\"50\"\n                  {...register('target_deviation', {\n                    valueAsNumber: true,\n                  })}\n                />\n                {errors.target_deviation && (\n                  <p className=\"text-sm text-red-600\">\n                    {errors.target_deviation.message}\n                  </p>\n                )}\n                <p className=\"text-xs text-muted-foreground\">\n                  初期値は現在の偏差値と同じ値に設定されます\n                </p>\n              </div>\n\n              {/* 第1段階では試験日はオプショナル（後で設定で変更可能） */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"exam_date\">試験日（任意）</Label>\n                <Input\n                  id=\"exam_date\"\n                  type=\"date\"\n                  {...register('exam_date')}\n                />\n                {errors.exam_date && (\n                  <p className=\"text-sm text-red-600\">\n                    {errors.exam_date.message}\n                  </p>\n                )}\n                <p className=\"text-xs text-muted-foreground\">\n                  試験日が近づくにつれて、合格率の精度が上がります。後で設定から変更できます。\n                </p>\n              </div>\n\n              <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n                {isLoading ? '処理中...' : '設定を完了する'}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\bottom-nav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\category-stacked-chart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'maxValue' is assigned a value but never used.","line":28,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":42},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. This value was memoized in source but not in compilation output.\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\category-stacked-chart.tsx:28:59\n   26 |   const todayLabel = format(getTodayDate(), 'M/d')\n   27 |\n>  28 |   const { chartData, categories, maxValue, weekdayMap } = useMemo(() => {\n      |                                                           ^^^^^^^^^^^^^^^\n>  29 |     // 教材名の一覧を取得（reference_book_idがある場合はそのname、ない場合はsubject）\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  30 |     const materialSet = new Set<string>()\n      …\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 137 |     return { chartData: result, categories: categoryList, maxValue, weekdayMap }\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 138 |   }, [studyLogs, selectedPeriodType, dateOffset])\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Could not preserve existing memoization\n  139 |\n  140 |   const WeekTick = ({ x, y, payload }: { x?: number; y?: number; payload?: { value?: string } }) => {\n  141 |     const label = payload?.value || ''","line":28,"column":59,"nodeType":null,"endLine":138,"endColumn":50},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. This value was memoized in source but not in compilation output.\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\category-stacked-chart.tsx:28:59\n   26 |   const todayLabel = format(getTodayDate(), 'M/d')\n   27 |\n>  28 |   const { chartData, categories, maxValue, weekdayMap } = useMemo(() => {\n      |                                                           ^^^^^^^^^^^^^^^\n>  29 |     // 教材名の一覧を取得（reference_book_idがある場合はそのname、ない場合はsubject）\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  30 |     const materialSet = new Set<string>()\n      …\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 137 |     return { chartData: result, categories: categoryList, maxValue, weekdayMap }\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 138 |   }, [studyLogs, selectedPeriodType, dateOffset])\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Could not preserve existing memoization\n  139 |\n  140 |   const WeekTick = ({ x, y, payload }: { x?: number; y?: number; payload?: { value?: string } }) => {\n  141 |     const label = payload?.value || ''","line":28,"column":59,"nodeType":null,"endLine":138,"endColumn":50},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. This value was memoized in source but not in compilation output.\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\category-stacked-chart.tsx:28:59\n   26 |   const todayLabel = format(getTodayDate(), 'M/d')\n   27 |\n>  28 |   const { chartData, categories, maxValue, weekdayMap } = useMemo(() => {\n      |                                                           ^^^^^^^^^^^^^^^\n>  29 |     // 教材名の一覧を取得（reference_book_idがある場合はそのname、ない場合はsubject）\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  30 |     const materialSet = new Set<string>()\n      …\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 137 |     return { chartData: result, categories: categoryList, maxValue, weekdayMap }\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 138 |   }, [studyLogs, selectedPeriodType, dateOffset])\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Could not preserve existing memoization\n  139 |\n  140 |   const WeekTick = ({ x, y, payload }: { x?: number; y?: number; payload?: { value?: string } }) => {\n  141 |     const label = payload?.value || ''","line":28,"column":59,"nodeType":null,"endLine":138,"endColumn":50},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'referenceBooks'. Either include it or remove the dependency array.","line":138,"column":6,"nodeType":"ArrayExpression","endLine":138,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [studyLogs, selectedPeriodType, referenceBooks, dateOffset]","fix":{"range":[4818,4861],"text":"[studyLogs, selectedPeriodType, referenceBooks, dateOffset]"}}]},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\category-stacked-chart.tsx:288:54\n  286 |               axisLine={false}\n  287 |               tickLine={false}\n> 288 |               tick={selectedPeriodType === 'week' ? <WeekTick /> : { fontSize: 10, fill: '#6b7280' }}\n      |                                                      ^^^^^^^^ This component is created during render\n  289 |               tickFormatter={\n  290 |                 selectedPeriodType === 'week'\n  291 |                   ? undefined\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\category-stacked-chart.tsx:140:20\n  138 |   }, [studyLogs, selectedPeriodType, dateOffset])\n  139 |\n> 140 |   const WeekTick = ({ x, y, payload }: { x?: number; y?: number; payload?: { value?: string } }) => {\n      |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 141 |     const label = payload?.value || ''\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 142 |     const weekday = weekdayMap.get(label) || ''\n      …\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 153 |     )\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 154 |   }\n      | ^^^^ The component is created during render here\n  155 |\n  156 |   // 期間ラベルを生成\n  157 |   const getPeriodLabel = (): string => {","line":288,"column":54,"nodeType":null,"endLine":288,"endColumn":62}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useMemo, useState } from 'react'\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts'\nimport { format } from 'date-fns'\nimport { ja } from 'date-fns/locale'\nimport { getStudyDay, getTodayDate } from '@/lib/date-utils'\nimport { ChevronLeft, ChevronRight } from 'lucide-react'\nimport type { StudyLog, ReferenceBook } from '@/types/database'\nimport { Button } from '@/components/ui/button'\nimport { getMaterialColor } from '@/lib/color-utils'\n\ninterface CategoryStackedChartProps {\n  studyLogs: StudyLog[]\n  referenceBooks?: ReferenceBook[]\n}\n\nconst PERIOD_OPTIONS = [\n  { label: '7日', type: 'week' as const },\n  { label: '30日', type: 'month' as const },\n] as const\n\nexport function CategoryStackedChart({ studyLogs, referenceBooks = [] }: CategoryStackedChartProps) {\n  const [selectedPeriodType, setSelectedPeriodType] = useState<'week' | 'month'>('week')\n  const [dateOffset, setDateOffset] = useState(0) // 日付のオフセット（クリックでシフト）\n  const todayLabel = format(getTodayDate(), 'M/d')\n\n  const { chartData, categories, maxValue, weekdayMap } = useMemo(() => {\n    // 教材名の一覧を取得（reference_book_idがある場合はそのname、ない場合はsubject）\n    const materialSet = new Set<string>()\n    studyLogs.forEach((log) => {\n      if (log.reference_book_id) {\n        const book = referenceBooks.find((b) => b.id === log.reference_book_id)\n        if (book) {\n          materialSet.add(book.name)\n        } else if (log.subject) {\n          materialSet.add(log.subject)\n        }\n      } else if (log.subject) {\n        materialSet.add(log.subject)\n      }\n    })\n    const categoryList = Array.from(materialSet).sort()\n\n    if (studyLogs.length === 0) {\n      return { chartData: [], categories: categoryList, maxValue: 0, weekdayMap: new Map<string, string>() }\n    }\n\n    const logDates = studyLogs.map((log) => getStudyDay(new Date(log.started_at)))\n    const uniqueDates = Array.from(new Set(logDates)).sort()\n\n    if (uniqueDates.length === 0) {\n      return { chartData: [], categories: categoryList, maxValue: 0, weekdayMap: new Map<string, string>() }\n    }\n\n    const today = getTodayDate() // 03:00-03:00の区切りで今日を取得\n\n    // 表示する日付の範囲を決定\n    let startDate = new Date(today)\n    let endDate = new Date(today)\n\n    if (selectedPeriodType === 'week') {\n      // 直近7日（今日が先頭）\n      endDate = new Date(today)\n      endDate.setDate(endDate.getDate() - dateOffset * 7)\n      startDate = new Date(endDate)\n      startDate.setDate(startDate.getDate() - 6)\n    } else if (selectedPeriodType === 'month') {\n      // 直近30日（今日が先頭）\n      endDate = new Date(today)\n      endDate.setDate(endDate.getDate() - dateOffset * 30)\n      startDate = new Date(endDate)\n      startDate.setDate(startDate.getDate() - 29)\n    }\n    \n    // 開始日の時刻を12:00:00に設定して、getStudyDayの判定に影響されないようにする\n    startDate.setHours(12, 0, 0, 0)\n    endDate.setHours(12, 0, 0, 0)\n\n    // 日付ごとのデータを生成\n    const result: Array<{\n      date: string\n      fullDate: string\n      [key: string]: string | number\n    }> = []\n\n    const currentDate = new Date(endDate)\n    \n    while (currentDate >= startDate) {\n      // グラフの日付ラベル用（表示のみ）\n      const dateLabel = format(currentDate, 'M/d')\n      // データの日付判定用（03:00-03:00の区切りで判定）\n      // currentDateは12:00:00に設定されているので、getStudyDayはその日付をそのまま返す\n      const studyDay = getStudyDay(currentDate)\n\n      const dayData: { date: string; fullDate: string; [key: string]: string | number } = {\n        date: dateLabel,\n        fullDate: studyDay,\n      }\n\n      // 各カテゴリの学習時間を集計\n      // started_atの日付を03:00-03:00の区切りで判定して、グラフの日付と一致するか確認\n      const dayLogs = studyLogs.filter((log) => {\n        const logDay = getStudyDay(new Date(log.started_at))\n        return logDay === studyDay\n      })\n\n      categoryList.forEach((category) => {\n        const categoryMinutes = dayLogs\n          .filter((log) => log.subject === category)\n          .reduce((sum, log) => sum + log.study_minutes, 0)\n        // 0分の場合はキーを設定しない（バーを表示しない）\n        if (categoryMinutes > 0) {\n          // 時間に変換（小数点第2位まで保持して、数分のデータも正確に表示）\n          dayData[category] = Math.round((categoryMinutes / 60) * 100) / 100\n        }\n      })\n\n      result.push(dayData)\n      currentDate.setDate(currentDate.getDate() - 1)\n      // 時刻を12:00:00に維持\n      currentDate.setHours(12, 0, 0, 0)\n    }\n\n    // データの最大値を計算（0より大きい値のみ）\n    const allValues = result.flatMap((d) =>\n      categoryList.map((cat) => (d[cat] as number) || 0)\n    ).filter((v) => v > 0)\n    const maxValue = allValues.length > 0 ? Math.max(...allValues) : 0\n\n    const weekdayMap = new Map<string, string>()\n    result.forEach(({ date, fullDate }) => {\n      const dateObj = new Date(`${fullDate}T12:00:00`)\n      weekdayMap.set(date, format(dateObj, 'EEE', { locale: ja }))\n    })\n\n    return { chartData: result, categories: categoryList, maxValue, weekdayMap }\n  }, [studyLogs, selectedPeriodType, dateOffset])\n\n  const WeekTick = ({ x, y, payload }: { x?: number; y?: number; payload?: { value?: string } }) => {\n    const label = payload?.value || ''\n    const weekday = weekdayMap.get(label) || ''\n    const isToday = label === todayLabel\n    const dateText = isToday ? '今日' : label\n    if (x === undefined || y === undefined) return null\n    return (\n      <g transform={`translate(${x},${y})`}>\n        <text textAnchor=\"middle\" fill=\"#6b7280\" fontSize={10}>\n          <tspan x=\"0\" dy=\"0\">{dateText}</tspan>\n          <tspan x=\"0\" dy=\"12\">{weekday}</tspan>\n        </text>\n      </g>\n    )\n  }\n\n  // 期間ラベルを生成\n  const getPeriodLabel = (): string => {\n    if (selectedPeriodType === 'week') {\n      if (dateOffset === 0) return '過去7日'\n      const start = dateOffset * 7\n      const end = dateOffset * 7 + 6\n      return `${start}日前〜${end}日前`\n    } else if (selectedPeriodType === 'month') {\n      if (dateOffset === 0) return '過去30日'\n      const start = dateOffset * 30\n      const end = dateOffset * 30 + 29\n      return `${start}日前〜${end}日前`\n    }\n    return ''\n  }\n\n  if (chartData.length === 0 || categories.length === 0) {\n    return (\n      <div className=\"space-y-3\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex gap-1\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setDateOffset(dateOffset + 1)}\n                className=\"h-7 w-7 p-0\"\n                title=\"前の期間を見る\"\n              >\n                <ChevronLeft className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setDateOffset(Math.max(0, dateOffset - 1))}\n                disabled={dateOffset === 0}\n                className=\"h-7 w-7 p-0\"\n                title=\"次の期間を見る\"\n              >\n                <ChevronRight className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            {getPeriodLabel() && (\n              <span className=\"text-sm text-muted-foreground font-medium\">\n                {getPeriodLabel()}\n              </span>\n            )}\n          </div>\n          <div className=\"flex gap-2\">\n            {PERIOD_OPTIONS.map((option) => (\n              <Button\n                key={option.label}\n                variant={selectedPeriodType === option.type ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => {\n                  setSelectedPeriodType(option.type)\n                  setDateOffset(0)\n                }}\n                className=\"h-7 text-xs\"\n              >\n                {option.label}\n              </Button>\n            ))}\n          </div>\n        </div>\n        <div className=\"text-center py-8 text-muted-foreground\">\n          学習記録がありません\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      {/* 期間選択ボタンとナビゲーション */}\n      <div className=\"flex items-center justify-between gap-2\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"flex gap-1\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setDateOffset(dateOffset + 1)}\n              className=\"h-7 w-7 p-0\"\n              title=\"前の期間を見る\"\n            >\n              <ChevronLeft className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setDateOffset(Math.max(0, dateOffset - 1))}\n              disabled={dateOffset === 0}\n              className=\"h-7 w-7 p-0\"\n              title=\"次の期間を見る\"\n            >\n              <ChevronRight className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          {getPeriodLabel() && (\n            <span className=\"text-sm text-muted-foreground font-medium\">\n              {getPeriodLabel()}\n            </span>\n          )}\n        </div>\n        <div className=\"flex gap-2\">\n            {PERIOD_OPTIONS.map((option) => (\n            <Button\n              key={option.label}\n                variant={selectedPeriodType === option.type ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => {\n                setSelectedPeriodType(option.type)\n                setDateOffset(0) // 期間変更時はオフセットをリセット\n              }}\n              className=\"h-7 text-xs\"\n            >\n              {option.label}\n            </Button>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"relative\">\n        <div>\n          <div>\n            <ResponsiveContainer width=\"100%\" height={selectedPeriodType === 'month' ? 250 : 200}>\n          <BarChart data={chartData} margin={{ top: 5, right: 40, left: 20, bottom: 5 }}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" vertical={false} />\n            <XAxis\n              dataKey=\"date\"\n              axisLine={false}\n              tickLine={false}\n              tick={selectedPeriodType === 'week' ? <WeekTick /> : { fontSize: 10, fill: '#6b7280' }}\n              tickFormatter={\n                selectedPeriodType === 'week'\n                  ? undefined\n                  : (label: string) => (label === todayLabel ? '今日' : label)\n              }\n              reversed\n              angle={selectedPeriodType === 'month' ? -45 : 0}\n              textAnchor={selectedPeriodType === 'month' ? 'end' : 'middle'}\n              height={selectedPeriodType === 'month' ? 60 : 36}\n              interval={selectedPeriodType === 'month' ? 2 : 0}\n            />\n            <YAxis\n              tick={{ fontSize: 11, fill: '#6b7280' }}\n              axisLine={false}\n              tickLine={false}\n              label={{ value: '時間', position: 'insideLeft', style: { textAnchor: 'middle', fill: '#6b7280', fontSize: 11 } }}\n              domain={[0, (dataMax: number) => {\n                // データの最大値に応じて適切なスケールを設定\n                if (dataMax === 0) return 0.1 // データがない場合は0.1時間（6分）\n                // 数分のデータも見えるように、常に少し余裕を持たせる\n                if (dataMax < 0.05) return 0.05 // 3分未満の場合は0.05時間（3分）\n                if (dataMax < 0.1) return 0.1 // 6分未満の場合は0.1時間（6分）\n                if (dataMax < 0.5) return Math.max(0.1, Math.ceil(dataMax * 20) / 20) // 30分未満の場合は0.05時間刻み\n                if (dataMax < 1) return Math.ceil(dataMax * 2) / 2 // 1時間未満の場合は0.5時間刻み\n                if (dataMax < 5) return Math.ceil(dataMax) + 0.5 // 5時間未満の場合は少し余裕を持たせる\n                return Math.max(5, Math.ceil(dataMax / 5) * 5) // 5時間以上の場合は5時間刻み\n              }]}\n              allowDecimals={true}\n              tickFormatter={(value: number) => {\n                // 目盛りの表示形式を調整\n                if (value < 1) {\n                  // 1時間未満の場合は分で表示\n                  const minutes = Math.round(value * 60)\n                  if (minutes === 0) return '0'\n                  return `${minutes}分`\n                }\n                return `${value}時間`\n              }}\n            />\n            <Tooltip\n              formatter={(value, name) => {\n                const numericValue = typeof value === 'number' ? value : 0\n                // 0または非常に小さい値（0.001時間未満、約0.06秒）のみ非表示\n                if (numericValue === 0 || numericValue < 0.001) return null\n                const totalMinutes = Math.round(numericValue * 60)\n                if (totalMinutes === 0) return null\n                const hours = Math.floor(totalMinutes / 60)\n                const mins = totalMinutes % 60\n                if (hours > 0 && mins > 0) {\n                  return [`${hours}時間${mins}分`, String(name)]\n                } else if (hours > 0) {\n                  return [`${hours}時間`, String(name)]\n                } else {\n                  return [`${mins}分`, String(name)]\n                }\n              }}\n              labelFormatter={(label) => `日付: ${label}`}\n              contentStyle={{\n                backgroundColor: 'white',\n                border: '1px solid #e5e7eb',\n                borderRadius: '8px',\n                padding: '8px',\n              }}\n            />\n            {categories.map((category, index) => (\n              <Bar\n                key={category}\n                dataKey={category}\n                stackId=\"a\"\n                fill={getMaterialColor(category)}\n                radius={index === categories.length - 1 ? [4, 4, 0, 0] : [0, 0, 0, 0]}\n              />\n            ))}\n              </BarChart>\n            </ResponsiveContainer>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\daily-goal-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2452,2455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2452,2455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useMemo, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/client'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport type { Profile } from '@/types/database'\n\ninterface DailyGoalCardProps {\n  profile: Profile\n  todayMinutes: number\n}\n\nconst getLocalDateString = () => {\n  const now = new Date()\n  const year = now.getFullYear()\n  const month = String(now.getMonth() + 1).padStart(2, '0')\n  const day = String(now.getDate()).padStart(2, '0')\n  return `${year}-${month}-${day}`\n}\n\nexport function DailyGoalCard({ profile, todayMinutes }: DailyGoalCardProps) {\n  const router = useRouter()\n  const [isSaving, setIsSaving] = useState(false)\n  const [overrideMinutes, setOverrideMinutes] = useState<string>(() => {\n    if (profile.today_target_date === getLocalDateString() && profile.today_target_minutes) {\n      return String(profile.today_target_minutes)\n    }\n    return ''\n  })\n\n  const { targetMinutes, isWeekend } = useMemo(() => {\n    const today = new Date()\n    const day = today.getDay()\n    const weekend = day === 0 || day === 6\n    const defaultTarget = weekend\n      ? profile.weekend_target_minutes ?? 120\n      : profile.weekday_target_minutes ?? 60\n\n    const todayOverride =\n      profile.today_target_date === getLocalDateString()\n        ? profile.today_target_minutes\n        : null\n\n    return {\n      targetMinutes: todayOverride ?? defaultTarget,\n      isWeekend: weekend,\n    }\n  }, [profile])\n\n  const progress = Math.min(100, Math.round((todayMinutes / Math.max(1, targetMinutes)) * 100))\n\n  const handleSaveTodayTarget = async () => {\n    const minutes = parseInt(overrideMinutes, 10)\n    if (isNaN(minutes) || minutes < 1) {\n      alert('1分以上で入力してください')\n      return\n    }\n    setIsSaving(true)\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n      if (!user) return\n\n      const today = getLocalDateString()\n      const { error } = await supabase\n        .from('profiles')\n        .update({\n          today_target_minutes: minutes,\n          today_target_date: today,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('user_id', user.id)\n\n      if (error) throw error\n      router.refresh()\n    } catch (err: any) {\n      alert(err.message || '更新に失敗しました')\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  return (\n    <Card className=\"shadow-lg border-2 border-blue-200\">\n      <CardHeader>\n        <CardTitle className=\"text-lg\">今日の目標</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n            <span>{isWeekend ? '土日祝' : '平日'}の目標</span>\n            <span>{targetMinutes}分</span>\n          </div>\n          <div className=\"w-full bg-gray-200 rounded-full h-4 overflow-hidden\">\n            <div\n              className=\"h-full bg-blue-500 transition-all\"\n              style={{ width: `${progress}%` }}\n            />\n          </div>\n          <div className=\"text-sm text-muted-foreground\">\n            今日の学習: {todayMinutes}分 / 達成率 {progress}%\n          </div>\n        </div>\n\n        <div className=\"flex items-end gap-2\">\n          <div className=\"flex-1 space-y-1\">\n            <label className=\"text-xs text-muted-foreground\">今日の目標を変更</label>\n            <Input\n              type=\"number\"\n              min=\"1\"\n              value={overrideMinutes}\n              onChange={(e) => setOverrideMinutes(e.target.value)}\n              placeholder={`${targetMinutes}`}\n            />\n          </div>\n          <Button onClick={handleSaveTodayTarget} disabled={isSaving}>\n            {isSaving ? '保存中...' : '更新'}\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\mascot-message.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\mascot-message.tsx:15:5\n  13 |\n  14 |   useEffect(() => {\n> 15 |     setIsVisible(true)\n     |     ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  16 |   }, [message])\n  17 |\n  18 |   const emotionClass = {","line":15,"column":5,"nodeType":null,"endLine":15,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport Image from 'next/image'\nimport { useEffect, useState } from 'react'\n\ninterface MascotMessageProps {\n  message: string\n  emotion?: 'happy' | 'encouraging' | 'warning' | 'excited'\n}\n\nexport function MascotMessage({ message, emotion = 'happy' }: MascotMessageProps) {\n  const [isVisible, setIsVisible] = useState(false)\n\n  useEffect(() => {\n    setIsVisible(true)\n  }, [message])\n\n  const emotionClass = {\n    happy: 'border-blue-300 bg-blue-50',\n    encouraging: 'border-green-300 bg-green-50',\n    warning: 'border-orange-300 bg-orange-50',\n    excited: 'border-purple-300 bg-purple-50',\n  }[emotion]\n\n  return (\n    <div className={`flex items-start space-x-4 transition-all duration-300 ${isVisible ? 'opacity-100' : 'opacity-0'}`}>\n      <div className=\"relative w-20 h-20 flex-shrink-0 rounded-full overflow-hidden\" style={{ background: 'linear-gradient(to bottom right, rgb(239 246 255), rgb(238 242 255))' }}>\n        <Image\n          src=\"/images/mascot.png\"\n          alt=\"マスコット\"\n          fill\n          className=\"object-cover animate-bounce-slow\"\n        />\n      </div>\n      <div className=\"flex-1 pt-2\">\n        <div className={`rounded-lg p-4 border-2 shadow-md relative ${emotionClass}`}>\n          <div className=\"absolute -left-2 top-6 w-0 h-0 border-t-8 border-t-transparent border-r-8 border-r-current border-b-8 border-b-transparent\" />\n          <p className=\"text-sm font-medium text-foreground leading-relaxed relative z-10\">\n            {message}\n          </p>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\reference-book-chart.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2822,2825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2822,2825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'innerRadius' is assigned a value but never used.","line":88,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":88,"endColumn":42}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useMemo, useState } from 'react'\nimport { PieChart, Pie, Cell, Tooltip, ResponsiveContainer } from 'recharts'\nimport type { StudyLog, ReferenceBook } from '@/types/database'\nimport { getMaterialColor } from '@/lib/color-utils'\n\ninterface ReferenceBookChartProps {\n  studyLogs: StudyLog[]\n  referenceBooks: ReferenceBook[]\n  range?: {\n    start: Date\n    end: Date\n  }\n}\n\nexport function ReferenceBookChart({\n  studyLogs,\n  referenceBooks,\n  range,\n}: ReferenceBookChartProps) {\n  const [isSmallScreen, setIsSmallScreen] = useState(false)\n\n  useEffect(() => {\n    const mediaQuery = window.matchMedia('(max-width: 640px)')\n    const handleChange = () => setIsSmallScreen(mediaQuery.matches)\n    handleChange()\n    mediaQuery.addEventListener('change', handleChange)\n    return () => mediaQuery.removeEventListener('change', handleChange)\n  }, [])\n\n  const data = useMemo(() => {\n    const bookMap = new Map<string, { name: string; minutes: number }>()\n\n    studyLogs.forEach((log) => {\n      const logDate = new Date(log.started_at)\n      if (range) {\n        if (logDate < range.start || logDate >= range.end) return\n      }\n\n      if (log.reference_book_id) {\n        const book = referenceBooks.find((b) => b.id === log.reference_book_id)\n        if (book) {\n          const existing = bookMap.get(log.reference_book_id) || { name: book.name, minutes: 0 }\n          bookMap.set(log.reference_book_id, {\n            name: existing.name,\n            minutes: existing.minutes + log.study_minutes,\n          })\n        }\n      } else if (log.subject) {\n        // 後方互換性: reference_book_idがない場合はsubjectを使用\n        const key = `subject_${log.subject}`\n        const existing = bookMap.get(key) || { name: log.subject, minutes: 0 }\n        bookMap.set(key, {\n          name: existing.name,\n          minutes: existing.minutes + log.study_minutes,\n        })\n      }\n    })\n\n    const totalMinutes = Array.from(bookMap.values()).reduce((sum, book) => sum + book.minutes, 0)\n\n    return Array.from(bookMap.values())\n      .map((book) => ({\n        name: book.name,\n        value: book.minutes,\n        percentage: totalMinutes > 0 ? Math.round((book.minutes / totalMinutes) * 100) : 0,\n        color: getMaterialColor(book.name),\n      }))\n      .filter((item) => item.value > 0)\n      .sort((a, b) => b.value - a.value)\n  }, [studyLogs, referenceBooks, range])\n\n  if (data.length === 0) {\n    return <div className=\"text-center py-6 text-muted-foreground\">学習記録がありません</div>\n  }\n\n  const formatTime = (minutes: number): string => {\n    const hours = Math.floor(minutes / 60)\n    const mins = minutes % 60\n    if (hours > 0 && mins > 0) return `${hours}時間${mins}分`\n    if (hours > 0) return `${hours}時間`\n    return `${mins}分`\n  }\n\n  // カスタムラベルコンポーネント（常に表示される）\n  const renderCustomLabel = (entry: any) => {\n    const { cx, cy, midAngle, innerRadius, outerRadius, percentage, value, payload } = entry\n    const RADIAN = Math.PI / 180\n    const radius = outerRadius + 14\n    const x = cx + radius * Math.cos(-midAngle * RADIAN)\n    const y = cy + radius * Math.sin(-midAngle * RADIAN)\n\n    return (\n      <text\n        x={x}\n        y={y}\n        fill={payload?.color || '#111827'}\n        textAnchor={x > cx ? 'start' : 'end'}\n        dominantBaseline=\"central\"\n        fontSize={12}\n        fontWeight=\"bold\"\n        style={{ pointerEvents: 'none', userSelect: 'none' }}\n      >\n        {`${percentage}% (${formatTime(value)})`}\n      </text>\n    )\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <ResponsiveContainer width=\"100%\" height={240}>\n        <PieChart>\n          <Pie\n            data={data}\n            dataKey=\"value\"\n            nameKey=\"name\"\n            innerRadius={isSmallScreen ? 35 : 45}\n            outerRadius={isSmallScreen ? 80 : 90}\n            paddingAngle={2}\n            label={isSmallScreen ? undefined : renderCustomLabel}\n            labelLine={false}\n            isAnimationActive={false}\n          >\n            {data.map((item) => (\n              <Cell key={`cell-${item.name}`} fill={item.color} />\n            ))}\n          </Pie>\n          {!isSmallScreen && (\n            <Tooltip\n              formatter={(value) => {\n                const numericValue = typeof value === 'number' ? value : 0\n                return formatTime(numericValue)\n              }}\n            />\n          )}\n        </PieChart>\n      </ResponsiveContainer>\n\n      <div className=\"space-y-2\">\n        {data.map((item) => (\n          <div key={item.name} className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <div\n                className=\"w-3 h-3 rounded\"\n                style={{ backgroundColor: item.color }}\n              />\n              <span className=\"text-sm\">{item.name}</span>\n            </div>\n            <span className=\"text-sm font-semibold\">\n              {formatTime(item.value)} ({item.percentage}%)\n            </span>\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\reference-book-manager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'uploadData' is assigned a value but never used.","line":78,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3819,3822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3819,3822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5088,5091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5088,5091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useRef } from 'react'\nimport Image from 'next/image'\nimport { Plus, X, Book, Video, Trash2 } from 'lucide-react'\nimport { createClient } from '@/lib/supabase/client'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport type { ReferenceBook } from '@/types/database'\n\ninterface ReferenceBookManagerProps {\n  referenceBooks: ReferenceBook[]\n  selectedBookId: string | null\n  onSelect: (bookId: string | null) => void\n  onRefresh: () => void\n}\n\nexport function ReferenceBookManager({\n  referenceBooks,\n  selectedBookId,\n  onSelect,\n  onRefresh,\n}: ReferenceBookManagerProps) {\n  const [showAddForm, setShowAddForm] = useState(false)\n  const [bookName, setBookName] = useState('')\n  const [bookImage, setBookImage] = useState<string | null>(null)\n  const [isSaving, setIsSaving] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (file) {\n      const reader = new FileReader()\n      reader.onloadend = () => {\n        setBookImage(reader.result as string)\n      }\n      reader.readAsDataURL(file)\n    }\n  }\n\n  const handleAddBook = async () => {\n    if (!bookName.trim()) {\n      alert('教材名を入力してください')\n      return\n    }\n\n    setIsSaving(true)\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n\n      if (!user) {\n        alert('ログインが必要です')\n        return\n      }\n\n      // 同じ名前の削除済み教材があるか確認\n      const { data: deletedBook } = await supabase\n        .from('reference_books')\n        .select('*')\n        .eq('user_id', user.id)\n        .eq('name', bookName.trim())\n        .not('deleted_at', 'is', null)\n        .order('deleted_at', { ascending: false })\n        .limit(1)\n        .maybeSingle()\n\n      // 画像をSupabase Storageにアップロード\n      let imageUrl: string | null = null\n      if (bookImage) {\n        try {\n          const file = await dataURLtoFile(bookImage, `${user.id}/${Date.now()}.jpg`)\n          const fileName = `${user.id}/${Date.now()}.jpg`\n          const { data: uploadData, error: uploadError } = await supabase.storage\n            .from('reference-books')\n            .upload(fileName, file, {\n              cacheControl: '3600',\n              upsert: false,\n            })\n\n          if (uploadError) {\n            console.error('Upload error:', uploadError)\n            // Storageバケットが存在しない場合は、画像なしで続行\n            alert('画像のアップロードに失敗しましたが、教材は追加されます。Storageバケット「reference-books」を作成してください。')\n          } else {\n            const { data: urlData } = supabase.storage\n              .from('reference-books')\n              .getPublicUrl(fileName)\n            imageUrl = urlData.publicUrl\n          }\n        } catch (error) {\n          console.error('Image upload failed:', error)\n          // 画像アップロードに失敗しても参考書は追加できるようにする\n        }\n      }\n\n      if (deletedBook) {\n        // 削除済み教材を復活させる\n        const { error } = await supabase\n          .from('reference_books')\n          .update({\n            deleted_at: null,\n            image_url: imageUrl || deletedBook.image_url,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', deletedBook.id)\n\n        if (error) throw error\n      } else {\n        // 新規作成\n        const { error } = await supabase.from('reference_books').insert({\n          user_id: user.id,\n          name: bookName,\n          image_url: imageUrl,\n          type: 'book',\n        })\n\n        if (error) throw error\n      }\n\n      setBookName('')\n      setBookImage(null)\n      setShowAddForm(false)\n      onRefresh()\n    } catch (error: any) {\n      alert(error.message || '教材の追加に失敗しました')\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  const dataURLtoFile = (dataurl: string, filename: string): Promise<File> => {\n    return new Promise((resolve) => {\n      const arr = dataurl.split(',')\n      const mime = arr[0].match(/:(.*?);/)?.[1] || 'image/jpeg'\n      const bstr = atob(arr[1])\n      let n = bstr.length\n      const u8arr = new Uint8Array(n)\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n)\n      }\n      resolve(new File([u8arr], filename, { type: mime }))\n    })\n  }\n\n  const handleDeleteBook = async (bookId: string) => {\n    if (!confirm('この教材を削除しますか？学習記録は残ります。再登録すると過去の記録と紐づきます。')) return\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n\n      if (!user) {\n        alert('ログインが必要です')\n        return\n      }\n\n      // 論理削除（deleted_atを設定）\n      const { error } = await supabase\n        .from('reference_books')\n        .update({\n          deleted_at: new Date().toISOString(),\n          updated_at: new Date().toISOString(),\n        })\n        .eq('id', bookId)\n\n      if (error) throw error\n\n      if (selectedBookId === bookId) {\n        onSelect(null)\n      }\n\n      onRefresh()\n    } catch (error: any) {\n      alert(error.message || '教材の削除に失敗しました')\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"text-lg font-semibold\">教材</h3>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => setShowAddForm(!showAddForm)}\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          追加\n        </Button>\n      </div>\n\n      {showAddForm && (\n        <Card className=\"border-2 border-blue-200\">\n          <CardHeader>\n            <CardTitle className=\"text-base\">新しい教材を追加</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"book_name\">名前</Label>\n              <Input\n                id=\"book_name\"\n                value={bookName}\n                onChange={(e) => setBookName(e.target.value)}\n                placeholder=\"例: チャート式数学I\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>画像（任意）</Label>\n              <div className=\"flex gap-2\">\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleImageSelect}\n                  className=\"hidden\"\n                />\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => fileInputRef.current?.click()}\n                  className=\"flex-1\"\n                >\n                  画像を選択\n                </Button>\n                {bookImage && (\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setBookImage(null)}\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </Button>\n                )}\n              </div>\n              {bookImage && (\n                <div className=\"relative w-32 h-32 border rounded-lg overflow-hidden\">\n                  <Image\n                    src={bookImage}\n                    alt=\"Preview\"\n                    fill\n                    className=\"object-cover\"\n                  />\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex gap-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  setShowAddForm(false)\n                  setBookName('')\n                  setBookImage(null)\n                }}\n                className=\"flex-1\"\n              >\n                キャンセル\n              </Button>\n              <Button\n                type=\"button\"\n                onClick={handleAddBook}\n                disabled={isSaving || !bookName.trim()}\n                className=\"flex-1\"\n              >\n                {isSaving ? '追加中...' : '追加'}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-4\">\n        {referenceBooks.map((book) => (\n          <Card\n            key={book.id}\n            className={`cursor-pointer transition-all ${\n              selectedBookId === book.id\n                ? 'border-2 border-blue-500 shadow-lg'\n                : 'border hover:border-blue-300'\n            }`}\n            onClick={() => onSelect(book.id)}\n          >\n            <CardContent className=\"pt-3 pb-3 relative flex flex-col items-center text-center sm:items-start sm:text-left\">\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={(e) => {\n                  e.stopPropagation()\n                  handleDeleteBook(book.id)\n                }}\n                className=\"absolute right-2 top-2 h-7 w-7 text-muted-foreground hover:text-red-600\"\n                aria-label=\"参考書を削除\"\n              >\n                <Trash2 className=\"w-4 h-4\" />\n              </Button>\n\n              <div className=\"flex flex-col items-center gap-2 sm:items-start\">\n                {book.image_url ? (\n                  <div className=\"relative w-14 h-14 flex-shrink-0 rounded overflow-hidden\">\n                    <Image\n                      src={book.image_url}\n                      alt={book.name}\n                      fill\n                      className=\"object-cover\"\n                    />\n                  </div>\n                ) : (\n                  <div className=\"w-14 h-14 flex-shrink-0 bg-gray-100 rounded flex items-center justify-center\">\n                    {book.type === 'book' ? (\n                      <Book className=\"w-8 h-8 text-gray-400\" />\n                    ) : (\n                      <Video className=\"w-8 h-8 text-gray-400\" />\n                    )}\n                  </div>\n                )}\n                <div className=\"w-full\">\n                  <p className=\"font-semibold text-sm leading-snug break-words\">\n                    {book.name || '教材'}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-1 hidden sm:block\">\n                    {book.type === 'book' ? '参考書' : '動画授業'}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {referenceBooks.length === 0 && !showAddForm && (\n        <div className=\"text-center py-8 text-muted-foreground\">\n          <p>参考書が登録されていません</p>\n          <p className=\"text-sm mt-2\">「追加」ボタンから参考書を追加してください</p>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\streak-display.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\ui\\input.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":4,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":4,"endColumn":28,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[72,149],"text":"type InputProps = React.InputHTMLAttributes<HTMLInputElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\ui\\label.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":4,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":4,"endColumn":28,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[72,149],"text":"type LabelProps = React.LabelHTMLAttributes<HTMLLabelElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface LabelProps\n  extends React.LabelHTMLAttributes<HTMLLabelElement> {}\n\nconst Label = React.forwardRef<HTMLLabelElement, LabelProps>(\n  ({ className, ...props }, ref) => (\n    <label\n      ref={ref}\n      className={cn(\n        \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nLabel.displayName = \"Label\"\n\nexport { Label }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\components\\weekly-monthly-goal-cards.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3988,3991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3988,3991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4796,4799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4796,4799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useMemo, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/client'\nimport { getThisMonthStart, getThisWeekStart } from '@/lib/date-utils'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport type { Profile } from '@/types/database'\n\ninterface WeeklyMonthlyGoalCardsProps {\n  profile: Profile\n  weekMinutes: number\n  monthMinutes: number\n}\n\nconst getLocalDateString = (date: Date) => {\n  const year = date.getFullYear()\n  const month = String(date.getMonth() + 1).padStart(2, '0')\n  const day = String(date.getDate()).padStart(2, '0')\n  return `${year}-${month}-${day}`\n}\n\nexport function WeeklyMonthlyGoalCards({\n  profile,\n  weekMinutes,\n  monthMinutes,\n}: WeeklyMonthlyGoalCardsProps) {\n  const router = useRouter()\n  const [isSavingWeek, setIsSavingWeek] = useState(false)\n  const [isSavingMonth, setIsSavingMonth] = useState(false)\n\n  const weekStartDateString = useMemo(() => getLocalDateString(getThisWeekStart()), [])\n  const monthStartDateString = useMemo(() => getLocalDateString(getThisMonthStart()), [])\n\n  const [weekOverrideMinutes, setWeekOverrideMinutes] = useState<string>(() => {\n    if (profile.week_target_date === weekStartDateString && profile.week_target_minutes) {\n      return String(profile.week_target_minutes)\n    }\n    return ''\n  })\n\n  const [monthOverrideMinutes, setMonthOverrideMinutes] = useState<string>(() => {\n    if (profile.month_target_date === monthStartDateString && profile.month_target_minutes) {\n      return String(profile.month_target_minutes)\n    }\n    return ''\n  })\n\n  const todayDateString = getLocalDateString(new Date())\n\n  const getDailyTargetForDate = (date: Date) => {\n    const day = date.getDay()\n    const isWeekend = day === 0 || day === 6\n    const defaultTarget = isWeekend\n      ? profile.weekend_target_minutes ?? 120\n      : profile.weekday_target_minutes ?? 60\n\n    if (profile.today_target_date === todayDateString) {\n      const dateString = getLocalDateString(date)\n      if (dateString === todayDateString && profile.today_target_minutes) {\n        return profile.today_target_minutes\n      }\n    }\n\n    return defaultTarget\n  }\n\n  const getTargetSum = (startDate: Date, endDate: Date) => {\n    const cursor = new Date(startDate)\n    cursor.setHours(12, 0, 0, 0)\n    const end = new Date(endDate)\n    end.setHours(12, 0, 0, 0)\n\n    let total = 0\n    while (cursor <= end) {\n      total += getDailyTargetForDate(cursor)\n      cursor.setDate(cursor.getDate() + 1)\n    }\n    return total\n  }\n\n  const weekTarget =\n    profile.week_target_date === weekStartDateString && profile.week_target_minutes\n      ? profile.week_target_minutes\n      : getTargetSum(getThisWeekStart(), new Date())\n\n  const monthTarget =\n    profile.month_target_date === monthStartDateString && profile.month_target_minutes\n      ? profile.month_target_minutes\n      : getTargetSum(getThisMonthStart(), new Date())\n\n  const weekProgress = Math.min(\n    100,\n    Math.round((weekMinutes / Math.max(1, weekTarget)) * 100)\n  )\n  const monthProgress = Math.min(\n    100,\n    Math.round((monthMinutes / Math.max(1, monthTarget)) * 100)\n  )\n\n  const handleSaveWeekTarget = async () => {\n    const minutes = parseInt(weekOverrideMinutes, 10)\n    if (isNaN(minutes) || minutes < 1) {\n      alert('1分以上で入力してください')\n      return\n    }\n    setIsSavingWeek(true)\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n      if (!user) return\n\n      const { error } = await supabase\n        .from('profiles')\n        .update({\n          week_target_minutes: minutes,\n          week_target_date: weekStartDateString,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('user_id', user.id)\n\n      if (error) throw error\n      router.refresh()\n    } catch (err: any) {\n      alert(err.message || '更新に失敗しました')\n    } finally {\n      setIsSavingWeek(false)\n    }\n  }\n\n  const handleSaveMonthTarget = async () => {\n    const minutes = parseInt(monthOverrideMinutes, 10)\n    if (isNaN(minutes) || minutes < 1) {\n      alert('1分以上で入力してください')\n      return\n    }\n    setIsSavingMonth(true)\n    try {\n      const supabase = createClient()\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n      if (!user) return\n\n      const { error } = await supabase\n        .from('profiles')\n        .update({\n          month_target_minutes: minutes,\n          month_target_date: monthStartDateString,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('user_id', user.id)\n\n      if (error) throw error\n      router.refresh()\n    } catch (err: any) {\n      alert(err.message || '更新に失敗しました')\n    } finally {\n      setIsSavingMonth(false)\n    }\n  }\n\n  return (\n    <>\n      <Card className=\"shadow-lg border-2 border-blue-200\">\n        <CardHeader>\n          <CardTitle className=\"text-lg\">今週の目標</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n              <span>今週の目標</span>\n              <span>{weekTarget}分</span>\n            </div>\n            <div className=\"w-full bg-gray-200 rounded-full h-4 overflow-hidden\">\n              <div\n                className=\"h-full bg-blue-500 transition-all\"\n                style={{ width: `${weekProgress}%` }}\n              />\n            </div>\n            <div className=\"text-sm text-muted-foreground\">\n              今週の学習: {weekMinutes}分 / 達成率 {weekProgress}%\n            </div>\n          </div>\n\n          <div className=\"flex items-end gap-2\">\n            <div className=\"flex-1 space-y-1\">\n              <label className=\"text-xs text-muted-foreground\">今週の目標を変更</label>\n              <Input\n                type=\"number\"\n                min=\"1\"\n                value={weekOverrideMinutes}\n                onChange={(e) => setWeekOverrideMinutes(e.target.value)}\n                placeholder={`${weekTarget}`}\n              />\n            </div>\n            <Button onClick={handleSaveWeekTarget} disabled={isSavingWeek}>\n              {isSavingWeek ? '保存中...' : '更新'}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"shadow-lg border-2 border-blue-200\">\n        <CardHeader>\n          <CardTitle className=\"text-lg\">今月の目標</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n              <span>今月の目標</span>\n              <span>{monthTarget}分</span>\n            </div>\n            <div className=\"w-full bg-gray-200 rounded-full h-4 overflow-hidden\">\n              <div\n                className=\"h-full bg-blue-500 transition-all\"\n                style={{ width: `${monthProgress}%` }}\n              />\n            </div>\n            <div className=\"text-sm text-muted-foreground\">\n              今月の学習: {monthMinutes}分 / 達成率 {monthProgress}%\n            </div>\n          </div>\n\n          <div className=\"flex items-end gap-2\">\n            <div className=\"flex-1 space-y-1\">\n              <label className=\"text-xs text-muted-foreground\">今月の目標を変更</label>\n              <Input\n                type=\"number\"\n                min=\"1\"\n                value={monthOverrideMinutes}\n                onChange={(e) => setMonthOverrideMinutes(e.target.value)}\n                placeholder={`${monthTarget}`}\n              />\n            </div>\n            <Button onClick={handleSaveMonthTarget} disabled={isSavingMonth}>\n              {isSavingMonth ? '保存中...' : '更新'}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\lib\\color-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\lib\\date-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\lib\\gamification.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'yesterdayStr' is assigned a value but never used.","line":24,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { StudyLog } from '@/types/database'\nimport { differenceInDays } from 'date-fns'\nimport { getStudyDay, getStudyDayDate } from '@/lib/date-utils'\n\n/**\n * ストリーク（連続学習日数）を計算\n */\nexport function calculateStreak(studyLogs: StudyLog[]): {\n  currentStreak: number\n  longestStreak: number\n  lastStudyDate: Date | null\n} {\n  if (studyLogs.length === 0) {\n    return { currentStreak: 0, longestStreak: 0, lastStudyDate: null }\n  }\n\n  // 日付ごとにグループ化\n  const dates = new Set(studyLogs.map((log) => getStudyDay(new Date(log.started_at))))\n  const sortedDates = Array.from(dates)\n    .map((d) => getStudyDayDate(d))\n    .sort((a, b) => b.getTime() - a.getTime())\n\n  const todayStr = getStudyDay(new Date())\n  const yesterdayStr = getStudyDay(new Date(getStudyDayDate(todayStr).getTime() - 24 * 60 * 60 * 1000))\n\n  // 現在のストリークを計算\n  let currentStreak = 0\n  let checkDate = getStudyDayDate(todayStr)\n  let lastStudyDate: Date | null = null\n\n  for (const logDate of sortedDates) {\n    const logDateStr = getStudyDay(logDate)\n    const checkDateStr = getStudyDay(checkDate)\n\n    if (logDateStr === checkDateStr || logDateStr === getStudyDay(new Date(checkDate.getTime() - 24 * 60 * 60 * 1000))) {\n      currentStreak++\n      if (lastStudyDate === null) {\n        lastStudyDate = logDate\n      }\n      checkDate = new Date(logDate.getTime() - 24 * 60 * 60 * 1000)\n    } else {\n      break\n    }\n  }\n\n  // 最長ストリークを計算\n  let longestStreak = 0\n  let tempStreak = 0\n  let prevDate: Date | null = null\n\n  for (const date of sortedDates) {\n    if (prevDate === null) {\n      tempStreak = 1\n    } else {\n      const daysDiff = differenceInDays(prevDate, date)\n      if (daysDiff === 1) {\n        tempStreak++\n      } else {\n        longestStreak = Math.max(longestStreak, tempStreak)\n        tempStreak = 1\n      }\n    }\n    prevDate = date\n  }\n  longestStreak = Math.max(longestStreak, tempStreak)\n\n  return {\n    currentStreak,\n    longestStreak,\n    lastStudyDate: sortedDates[0] || null,\n  }\n}\n\n/**\n * バッジを計算\n */\nexport function calculateBadges(\n  profile: { current_deviation: number | null; target_deviation: number | null },\n  studyLogs: StudyLog[],\n  streak: { currentStreak: number; longestStreak: number }\n): string[] {\n  const badges: string[] = []\n  const totalMinutes = studyLogs.reduce((sum, log) => sum + log.study_minutes, 0)\n  const totalHours = Math.floor(totalMinutes / 60)\n\n  // 学習時間バッジ\n  if (totalHours >= 100) badges.push('🏆 学習マスター')\n  else if (totalHours >= 50) badges.push('⭐ 学習エキスパート')\n  else if (totalHours >= 20) badges.push('📚 学習上級者')\n  else if (totalHours >= 10) badges.push('📖 学習中級者')\n  else if (totalHours >= 1) badges.push('🌱 学習初心者')\n\n  // ストリークバッジ\n  if (streak.currentStreak >= 30) badges.push('🔥 30日連続達成')\n  else if (streak.currentStreak >= 14) badges.push('💪 2週間連続達成')\n  else if (streak.currentStreak >= 7) badges.push('✨ 1週間連続達成')\n  else if (streak.currentStreak >= 3) badges.push('🎯 3日連続達成')\n\n  // 偏差値バッジ\n  if (profile.current_deviation && profile.target_deviation) {\n    if (profile.current_deviation >= profile.target_deviation) {\n      badges.push('🎓 目標達成')\n    } else if (profile.current_deviation >= profile.target_deviation - 5) {\n      badges.push('📈 目標まであと少し')\n    }\n  }\n\n  // 科目バッジ\n  const subjects = new Set(studyLogs.map((log) => log.subject))\n  if (subjects.size >= 5) badges.push('📝 5科目マスター')\n  else if (subjects.size >= 3) badges.push('📋 3科目マスター')\n\n  return badges\n}\n\n/**\n * 今日のミッションを生成\n */\nexport function getTodayMission(\n  studyLogs: StudyLog[],\n  streak: { currentStreak: number }\n): {\n  title: string\n  description: string\n  target: number\n  current: number\n  completed: boolean\n} {\n  const todayStr = getStudyDay(new Date())\n  const todayMinutes = studyLogs\n    .filter((log) => getStudyDay(new Date(log.started_at)) === todayStr)\n    .reduce((sum, log) => sum + log.study_minutes, 0)\n\n  // ストリーク維持ミッション\n  if (streak.currentStreak > 0) {\n    return {\n      title: '🔥 ストリーク維持',\n      description: '今日も学習して連続記録を更新しよう！',\n      target: 30, // 最低30分\n      current: todayMinutes,\n      completed: todayMinutes >= 30,\n    }\n  }\n\n  // 初日ミッション\n  return {\n    title: '🚀 学習開始',\n    description: '今日から学習習慣を始めよう！',\n    target: 30,\n    current: todayMinutes,\n    completed: todayMinutes >= 30,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\lib\\storage\\study-timer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\lib\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\lib\\supabase\\queries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\lib\\supabase\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\middleware.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":32,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createServerClient } from '@supabase/ssr'\nimport { NextResponse, type NextRequest } from 'next/server'\n\nexport async function middleware(request: NextRequest) {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    console.error('Missing Supabase environment variables')\n    // 環境変数が設定されていない場合は、ログイン画面以外をログイン画面にリダイレクト\n    if (request.nextUrl.pathname !== '/login') {\n      return NextResponse.redirect(new URL('/login', request.url))\n    }\n    return NextResponse.next()\n  }\n\n  let response = NextResponse.next({\n    request: {\n      headers: request.headers,\n    },\n  })\n\n  const supabase = createServerClient(\n    supabaseUrl,\n    supabaseAnonKey,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll()\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value, options }) => request.cookies.set(name, value))\n          response = NextResponse.next({\n            request,\n          })\n          cookiesToSet.forEach(({ name, value, options }) =>\n            response.cookies.set(name, value, options)\n          )\n        },\n      },\n    }\n  )\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  const pathname = request.nextUrl.pathname\n\n  // ログイン画面とオンボーディング画面は認証チェックのみ\n  if (pathname === '/login' || pathname === '/onboarding') {\n    if (user) {\n      // ログイン済みの場合、プロフィールをチェック\n      const { data: profile } = await supabase\n        .from('profiles')\n        .select('onboarding_completed')\n        .eq('user_id', user.id)\n        .single()\n\n      if (pathname === '/login') {\n        // ログイン画面にいる場合、オンボーディング状態に応じてリダイレクト\n        if (!profile || !profile.onboarding_completed) {\n          return NextResponse.redirect(new URL('/onboarding', request.url))\n        }\n        return NextResponse.redirect(new URL('/app/home', request.url))\n      }\n\n      if (pathname === '/onboarding') {\n        // オンボーディング画面にいる場合、完了済みならホームへ\n        if (profile && profile.onboarding_completed) {\n          return NextResponse.redirect(new URL('/app/home', request.url))\n        }\n        // 未完了ならそのまま通す\n        return response\n      }\n    }\n    // 未ログインならそのまま通す\n    return response\n  }\n\n  // /app配下は認証必須\n  if (pathname.startsWith('/app')) {\n    if (!user) {\n      return NextResponse.redirect(new URL('/login', request.url))\n    }\n\n    // オンボーディング未完了ならリダイレクト\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('onboarding_completed')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!profile || !profile.onboarding_completed) {\n      return NextResponse.redirect(new URL('/onboarding', request.url))\n    }\n  }\n\n  return response\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public folder\n     */\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\babel.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\components\\FullScreenLoader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\contexts\\ProfileContext.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\contexts\\ProfileContext.tsx:42:5\n  40 |\n  41 |   useEffect(() => {\n> 42 |     fetchProfile()\n     |     ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  43 |   }, [fetchProfile])\n  44 |\n  45 |   const refreshProfile = useCallback(async () => {","line":42,"column":5,"nodeType":null,"endLine":42,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useCallback, useContext, useEffect, useMemo, useState } from 'react'\nimport type { Session } from '@supabase/supabase-js'\nimport { supabase } from '../lib/supabase'\nimport type { Profile } from '../types'\n\ntype ProfileContextValue = {\n  userId: string\n  profile: Profile | null\n  loading: boolean\n  refreshProfile: () => Promise<void>\n  createProfile: (data: Omit<Profile, 'id' | 'user_id' | 'onboarding_completed'>) => Promise<void>\n  updateProfile: (data: Partial<Profile>) => Promise<void>\n}\n\nconst ProfileContext = createContext<ProfileContextValue | null>(null)\n\nexport function ProfileProvider({ session, children }: { session: Session; children: React.ReactNode }) {\n  const [profile, setProfile] = useState<Profile | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  const fetchProfile = useCallback(async () => {\n    setLoading(true)\n    const { data, error } = await supabase\n      .from('profiles')\n      .select('*')\n      .eq('user_id', session.user.id)\n      .single()\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        setProfile(null)\n      } else {\n        console.error('Failed to fetch profile:', error.message)\n      }\n    } else {\n      setProfile(data as Profile)\n    }\n    setLoading(false)\n  }, [session.user.id])\n\n  useEffect(() => {\n    fetchProfile()\n  }, [fetchProfile])\n\n  const refreshProfile = useCallback(async () => {\n    await fetchProfile()\n  }, [fetchProfile])\n\n  const createProfile = useCallback(\n    async (data: Omit<Profile, 'id' | 'user_id' | 'onboarding_completed'>) => {\n      const { error, data: created } = await supabase\n        .from('profiles')\n        .insert({\n          user_id: session.user.id,\n          school_name: data.school_name,\n          current_deviation: data.current_deviation,\n          target_deviation: data.target_deviation,\n          exam_date: data.exam_date ?? null,\n          onboarding_completed: true,\n        })\n        .select()\n        .single()\n\n      if (error) {\n        throw error\n      }\n\n      setProfile(created as Profile)\n    },\n    [session.user.id]\n  )\n\n  const updateProfile = useCallback(\n    async (data: Partial<Profile>) => {\n      const { error, data: updated } = await supabase\n        .from('profiles')\n        .update({\n          ...data,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('user_id', session.user.id)\n        .select()\n        .single()\n\n      if (error) {\n        throw error\n      }\n\n      setProfile(updated as Profile)\n    },\n    [session.user.id]\n  )\n\n  const value = useMemo(\n    () => ({\n      userId: session.user.id,\n      profile,\n      loading,\n      refreshProfile,\n      createProfile,\n      updateProfile,\n    }),\n    [session.user.id, profile, loading, refreshProfile, createProfile, updateProfile]\n  )\n\n  return <ProfileContext.Provider value={value}>{children}</ProfileContext.Provider>\n}\n\nexport function useProfile() {\n  const context = useContext(ProfileContext)\n  if (!context) {\n    throw new Error('useProfile must be used within ProfileProvider')\n  }\n  return context\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\lib\\date.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\lib\\format.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\lib\\gamification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\lib\\supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\navigation\\AppTabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\navigation\\AuthStack.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\HomeScreen.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\HomeScreen.tsx:57:5\n  55 |\n  56 |   useEffect(() => {\n> 57 |     loadData()\n     |     ^^^^^^^^ Avoid calling setState() directly within an effect\n  58 |   }, [loadData])\n  59 |\n  60 |   useFocusEffect(","line":57,"column":5,"nodeType":null,"endLine":57,"endColumn":13},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":155,"column":13,"nodeType":"JSXOpeningElement","endLine":155,"endColumn":115}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useEffect, useMemo, useState } from 'react'\nimport {\n  Image,\n  KeyboardAvoidingView,\n  Platform,\n  Pressable,\n  ScrollView,\n  StyleSheet,\n  Text,\n  TextInput,\n  View,\n} from 'react-native'\nimport { useFocusEffect } from '@react-navigation/native'\nimport { useProfile } from '../contexts/ProfileContext'\nimport { supabase } from '../lib/supabase'\nimport type { Profile, StudyLog } from '../types'\nimport { formatMinutes } from '../lib/format'\nimport { calculateStreak } from '../lib/gamification'\nimport { getThisMonthStart, getThisWeekStart, getTodayStart } from '../lib/date'\n\nconst mascotUrl = (baseUrl?: string) =>\n  `${(baseUrl || 'https://ai-yobikou.vercel.app').replace(/\\/$/, '')}/images/mascot.png`\n\nexport function HomeScreen() {\n  const { userId, profile: cachedProfile } = useProfile()\n  const [profile, setProfile] = useState<Profile | null>(cachedProfile)\n  const [studyLogs, setStudyLogs] = useState<StudyLog[]>([])\n  const [isSavingToday, setIsSavingToday] = useState(false)\n  const [isSavingWeek, setIsSavingWeek] = useState(false)\n  const [isSavingMonth, setIsSavingMonth] = useState(false)\n  const [todayOverride, setTodayOverride] = useState('')\n  const [weekOverride, setWeekOverride] = useState('')\n  const [monthOverride, setMonthOverride] = useState('')\n\n  const loadData = useCallback(async () => {\n    const [profileResult, logsResult] = await Promise.all([\n      supabase.from('profiles').select('*').eq('user_id', userId).single(),\n      supabase.from('study_logs').select('*').eq('user_id', userId).order('started_at', { ascending: false }),\n    ])\n    if (profileResult.data) {\n      setProfile(profileResult.data as Profile)\n      const todayStr = getLocalDateString()\n      if (profileResult.data.today_target_date === todayStr && profileResult.data.today_target_minutes) {\n        setTodayOverride(String(profileResult.data.today_target_minutes))\n      }\n      if (profileResult.data.week_target_minutes) {\n        setWeekOverride(String(profileResult.data.week_target_minutes))\n      }\n      if (profileResult.data.month_target_minutes) {\n        setMonthOverride(String(profileResult.data.month_target_minutes))\n      }\n    }\n    setStudyLogs((logsResult.data || []) as StudyLog[])\n  }, [userId])\n\n  useEffect(() => {\n    loadData()\n  }, [loadData])\n\n  useFocusEffect(\n    useCallback(() => {\n      loadData()\n    }, [loadData])\n  )\n\n  const { todayMinutes, weekMinutes, monthMinutes, totalMinutes } = useMemo(() => {\n    const todayStart = getTodayStart()\n    const weekStart = getThisWeekStart()\n    const monthStart = getThisMonthStart()\n    const today = studyLogs.reduce((sum, log) => {\n      const date = new Date(log.started_at)\n      return date >= todayStart ? sum + log.study_minutes : sum\n    }, 0)\n    const week = studyLogs.reduce((sum, log) => {\n      const date = new Date(log.started_at)\n      return date >= weekStart ? sum + log.study_minutes : sum\n    }, 0)\n    const month = studyLogs.reduce((sum, log) => {\n      const date = new Date(log.started_at)\n      return date >= monthStart ? sum + log.study_minutes : sum\n    }, 0)\n    const total = studyLogs.reduce((sum, log) => sum + log.study_minutes, 0)\n    return { todayMinutes: today, weekMinutes: week, monthMinutes: month, totalMinutes: total }\n  }, [studyLogs])\n\n  const streak = useMemo(() => calculateStreak(studyLogs), [studyLogs])\n  const latestStudyLog = studyLogs[0] ?? null\n\n  const comment = useMemo(() => {\n    if (streak.currentStreak >= 7) return '🔥 最高！連続学習が続いてるよ！'\n    if (streak.currentStreak >= 3) return '💪 いい感じ！このペースを維持しよう！'\n    if (streak.currentStreak >= 1) return '✨ 今日も学習できたね！'\n    return '📚 今日からスタート！一緒に頑張ろう！'\n  }, [streak.currentStreak])\n\n  const dailyTarget = useMemo(() => {\n    if (!profile) return 60\n    const today = new Date()\n    const isWeekend = today.getDay() === 0 || today.getDay() === 6\n    const defaultTarget = isWeekend\n      ? profile.weekend_target_minutes ?? 120\n      : profile.weekday_target_minutes ?? 60\n    const todayStr = getLocalDateString()\n    if (profile.today_target_date === todayStr && profile.today_target_minutes) {\n      return profile.today_target_minutes\n    }\n    return defaultTarget\n  }, [profile])\n\n  const weekTarget = useMemo(() => {\n    if (!profile) return 420\n    if (profile.week_target_minutes) return profile.week_target_minutes\n    return (profile.weekday_target_minutes ?? 60) * 5 + (profile.weekend_target_minutes ?? 120) * 2\n  }, [profile])\n\n  const monthTarget = useMemo(() => {\n    if (!profile) return 1800\n    if (profile.month_target_minutes) return profile.month_target_minutes\n    const daily = profile.weekday_target_minutes ?? 60\n    const weekend = profile.weekend_target_minutes ?? 120\n    return daily * 22 + weekend * 8\n  }, [profile])\n\n  const handleSaveTarget = async (type: 'today' | 'week' | 'month') => {\n    if (!profile) return\n    const value =\n      type === 'today' ? parseInt(todayOverride, 10) : type === 'week' ? parseInt(weekOverride, 10) : parseInt(monthOverride, 10)\n    if (isNaN(value) || value < 1) return\n    if (type === 'today') setIsSavingToday(true)\n    if (type === 'week') setIsSavingWeek(true)\n    if (type === 'month') setIsSavingMonth(true)\n    const payload =\n      type === 'today'\n        ? { today_target_minutes: value, today_target_date: getLocalDateString() }\n        : type === 'week'\n          ? { week_target_minutes: value, week_target_date: getLocalDateString(getThisWeekStart()) }\n          : { month_target_minutes: value, month_target_date: getLocalDateString(getThisMonthStart()) }\n    await supabase.from('profiles').update({ ...payload, updated_at: new Date().toISOString() }).eq('user_id', userId)\n    setProfile({ ...profile, ...payload })\n    setIsSavingToday(false)\n    setIsSavingWeek(false)\n    setIsSavingMonth(false)\n  }\n\n  return (\n    <KeyboardAvoidingView\n      style={styles.screen}\n      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\n      keyboardVerticalOffset={80}\n    >\n      <ScrollView contentContainerStyle={styles.container} keyboardShouldPersistTaps=\"handled\">\n      <View style={[styles.card, styles.mascotCard]}>\n        <View style={styles.mascotRow}>\n          <View style={styles.mascotCircle}>\n            <Image source={{ uri: mascotUrl(process.env.EXPO_PUBLIC_API_BASE_URL) }} style={styles.mascotImage} />\n          </View>\n          <View style={styles.balloon}>\n            <Text style={styles.balloonText}>{comment}</Text>\n          </View>\n        </View>\n      </View>\n\n      <View style={styles.card}>\n        <Text style={styles.cardTitle}>今日の目標</Text>\n        <ProgressRow label=\"目標\" value={`${dailyTarget}分`} />\n        <ProgressBar progress={Math.min(100, Math.round((todayMinutes / Math.max(1, dailyTarget)) * 100))} />\n        <Text style={styles.mutedText}>\n          今日の学習: {todayMinutes}分 / 達成率 {Math.min(100, Math.round((todayMinutes / Math.max(1, dailyTarget)) * 100))}%\n        </Text>\n        <View style={styles.inlineRow}>\n          <View style={styles.flex}>\n            <Text style={styles.smallLabel}>今日の目標を変更</Text>\n            <TextInput\n              style={styles.input}\n              placeholder={`${dailyTarget}`}\n              keyboardType=\"numeric\"\n              value={todayOverride}\n              onChangeText={setTodayOverride}\n            />\n          </View>\n          <Pressable style={styles.primaryButton} onPress={() => handleSaveTarget('today')} disabled={isSavingToday}>\n            <Text style={styles.primaryButtonText}>{isSavingToday ? '保存中...' : '更新'}</Text>\n          </Pressable>\n        </View>\n      </View>\n\n      <View style={styles.card}>\n        <Text style={styles.cardTitle}>今週の目標</Text>\n        <ProgressRow label=\"今週の目標\" value={`${weekTarget}分`} />\n        <ProgressBar progress={Math.min(100, Math.round((weekMinutes / Math.max(1, weekTarget)) * 100))} />\n        <Text style={styles.mutedText}>\n          今週の学習: {weekMinutes}分 / 達成率 {Math.min(100, Math.round((weekMinutes / Math.max(1, weekTarget)) * 100))}%\n        </Text>\n        <View style={styles.inlineRow}>\n          <View style={styles.flex}>\n            <Text style={styles.smallLabel}>今週の目標を変更</Text>\n            <TextInput\n              style={styles.input}\n              placeholder={`${weekTarget}`}\n              keyboardType=\"numeric\"\n              value={weekOverride}\n              onChangeText={setWeekOverride}\n            />\n          </View>\n          <Pressable style={styles.primaryButton} onPress={() => handleSaveTarget('week')} disabled={isSavingWeek}>\n            <Text style={styles.primaryButtonText}>{isSavingWeek ? '保存中...' : '更新'}</Text>\n          </Pressable>\n        </View>\n      </View>\n\n      <View style={styles.card}>\n        <Text style={styles.cardTitle}>今月の目標</Text>\n        <ProgressRow label=\"今月の目標\" value={`${monthTarget}分`} />\n        <ProgressBar progress={Math.min(100, Math.round((monthMinutes / Math.max(1, monthTarget)) * 100))} />\n        <Text style={styles.mutedText}>\n          今月の学習: {monthMinutes}分 / 達成率 {Math.min(100, Math.round((monthMinutes / Math.max(1, monthTarget)) * 100))}%\n        </Text>\n        <View style={styles.inlineRow}>\n          <View style={styles.flex}>\n            <Text style={styles.smallLabel}>今月の目標を変更</Text>\n            <TextInput\n              style={styles.input}\n              placeholder={`${monthTarget}`}\n              keyboardType=\"numeric\"\n              value={monthOverride}\n              onChangeText={setMonthOverride}\n            />\n          </View>\n          <Pressable style={styles.primaryButton} onPress={() => handleSaveTarget('month')} disabled={isSavingMonth}>\n            <Text style={styles.primaryButtonText}>{isSavingMonth ? '保存中...' : '更新'}</Text>\n          </Pressable>\n        </View>\n      </View>\n\n      <View style={styles.card}>\n        <Text style={styles.cardTitle}>学習記録</Text>\n        <View style={styles.summaryItem}>\n          <Text style={styles.summaryLabel}>累積学習時間</Text>\n          <Text style={styles.summaryValue}>{formatMinutes(totalMinutes)}</Text>\n        </View>\n        {latestStudyLog && (\n          <View style={[styles.summaryItem, styles.summarySecondary]}>\n            <Text style={styles.summaryLabel}>最後の学習</Text>\n            <Text style={styles.summaryValue}>{new Date(latestStudyLog.started_at).toLocaleDateString('ja-JP')}</Text>\n          </View>\n        )}\n      </View>\n\n      {streak.currentStreak > 0 && (\n        <View style={[styles.card, styles.streakCard]}>\n          <View style={styles.streakRow}>\n            <View>\n              <Text style={styles.streakTitle}>{streak.currentStreak}日連続</Text>\n              <Text style={styles.mutedText}>最長記録: {streak.longestStreak}日</Text>\n            </View>\n            <Text style={styles.streakEmoji}>🔥</Text>\n          </View>\n        </View>\n      )}\n      </ScrollView>\n    </KeyboardAvoidingView>\n  )\n}\n\nconst getLocalDateString = (date = new Date()) => {\n  const year = date.getFullYear()\n  const month = String(date.getMonth() + 1).padStart(2, '0')\n  const day = String(date.getDate()).padStart(2, '0')\n  return `${year}-${month}-${day}`\n}\n\nfunction ProgressRow({ label, value }: { label: string; value: string }) {\n  return (\n    <View style={styles.progressRow}>\n      <Text style={styles.mutedText}>{label}</Text>\n      <Text style={styles.mutedText}>{value}</Text>\n    </View>\n  )\n}\n\nfunction ProgressBar({ progress }: { progress: number }) {\n  return (\n    <View style={styles.progressTrack}>\n      <View style={[styles.progressFill, { width: `${progress}%` }]} />\n    </View>\n  )\n}\n\nconst styles = StyleSheet.create({\n  screen: {\n    flex: 1,\n  },\n  container: {\n    padding: 16,\n    backgroundColor: '#f8fafc',\n    gap: 12,\n  },\n  card: {\n    backgroundColor: '#ffffff',\n    borderRadius: 16,\n    padding: 16,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n  },\n  cardTitle: {\n    fontSize: 16,\n    fontWeight: '700',\n    marginBottom: 12,\n  },\n  mascotCard: {\n    backgroundColor: '#eef2ff',\n    borderColor: '#c7d2fe',\n  },\n  mascotRow: {\n    flexDirection: 'row',\n    alignItems: 'flex-start',\n    gap: 12,\n  },\n  mascotCircle: {\n    width: 80,\n    height: 80,\n    borderRadius: 40,\n    backgroundColor: '#e0e7ff',\n    alignItems: 'center',\n    justifyContent: 'center',\n    overflow: 'hidden',\n  },\n  mascotImage: {\n    width: 70,\n    height: 70,\n    resizeMode: 'cover',\n  },\n  balloon: {\n    flex: 1,\n    backgroundColor: '#ffffff',\n    padding: 12,\n    borderRadius: 12,\n    borderWidth: 2,\n    borderColor: '#93c5fd',\n  },\n  balloonText: {\n    fontSize: 13,\n    color: '#0f172a',\n    fontWeight: '600',\n  },\n  progressRow: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    marginBottom: 8,\n  },\n  progressTrack: {\n    height: 12,\n    backgroundColor: '#e2e8f0',\n    borderRadius: 999,\n    overflow: 'hidden',\n    marginBottom: 8,\n  },\n  progressFill: {\n    height: 12,\n    backgroundColor: '#3b82f6',\n  },\n  inlineRow: {\n    flexDirection: 'row',\n    alignItems: 'flex-end',\n    gap: 8,\n    marginTop: 8,\n  },\n  input: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 8,\n    paddingHorizontal: 10,\n    paddingVertical: 6,\n    fontSize: 14,\n    backgroundColor: '#ffffff',\n  },\n  smallLabel: {\n    fontSize: 11,\n    color: '#64748b',\n    marginBottom: 4,\n  },\n  primaryButton: {\n    backgroundColor: '#2563eb',\n    paddingHorizontal: 14,\n    paddingVertical: 10,\n    borderRadius: 10,\n    alignItems: 'center',\n  },\n  primaryButtonText: {\n    color: '#ffffff',\n    fontSize: 12,\n    fontWeight: '600',\n  },\n  mutedText: {\n    fontSize: 12,\n    color: '#64748b',\n  },\n  flex: {\n    flex: 1,\n  },\n  summaryItem: {\n    backgroundColor: '#eff6ff',\n    padding: 12,\n    borderRadius: 12,\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    marginBottom: 8,\n  },\n  summarySecondary: {\n    backgroundColor: '#f5f3ff',\n  },\n  summaryLabel: {\n    fontSize: 12,\n    color: '#475569',\n  },\n  summaryValue: {\n    fontSize: 14,\n    fontWeight: '700',\n    color: '#2563eb',\n  },\n  streakCard: {\n    backgroundColor: '#fff7ed',\n    borderColor: '#fed7aa',\n  },\n  streakRow: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  streakTitle: {\n    fontSize: 20,\n    fontWeight: '700',\n    color: '#ea580c',\n  },\n  streakEmoji: {\n    fontSize: 24,\n  },\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\LogScreen.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\LogScreen.tsx:125:5\n  123 |\n  124 |   useEffect(() => {\n> 125 |     loadData()\n      |     ^^^^^^^^ Avoid calling setState() directly within an effect\n  126 |   }, [userId])\n  127 |\n  128 |   useFocusEffect(","line":125,"column":5,"nodeType":null,"endLine":125,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":126,"column":6,"nodeType":"ArrayExpression","endLine":126,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, userId]","fix":{"range":[4171,4179],"text":"[loadData, userId]"}}]},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `loadData`, but the source dependencies were [userId]. Inferred different dependency than source.\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\LogScreen.tsx:129:17\n  127 |\n  128 |   useFocusEffect(\n> 129 |     useCallback(() => {\n      |                 ^^^^^^^\n> 130 |       loadData()\n      | ^^^^^^^^^^^^^^^^\n> 131 |     }, [userId])\n      | ^^^^^^ Could not preserve existing manual memoization\n  132 |   )\n  133 |\n  134 |   const todayStart = startOfDay()","line":129,"column":17,"nodeType":null,"endLine":131,"endColumn":6},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":131,"column":8,"nodeType":"ArrayExpression","endLine":131,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [loadData]","fix":{"range":[4248,4256],"text":"[loadData]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subjectTotals' is assigned a value but never used.","line":155,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":155,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":416,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":416,"endColumn":20},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `getMinutesInRange`, but the source dependencies were [studyLogs, weekOffset]. Inferred different dependency than source.\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\LogScreen.tsx:487:39\n  485 |   }, [studyLogs, materialRangeType, dayOffset, weekOffset, monthOffset])\n  486 |\n> 487 |   const selectedWeekMinutes = useMemo(() => {\n      |                                       ^^^^^^^\n> 488 |     const range = getWeekRange(weekOffset)\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 489 |     return getMinutesInRange(range.start, range.end)\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 490 |   }, [studyLogs, weekOffset])\n      | ^^^^ Could not preserve existing manual memoization\n  491 |\n  492 |   const selectedMonthMinutes = useMemo(() => {\n  493 |     const range = getMonthRange(monthOffset)","line":487,"column":39,"nodeType":null,"endLine":490,"endColumn":4},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getMinutesInRange'. Either include it or remove the dependency array.","line":490,"column":6,"nodeType":"ArrayExpression","endLine":490,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [getMinutesInRange, weekOffset]","fix":{"range":[15858,15881],"text":"[getMinutesInRange, weekOffset]"}}]},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `getMinutesInRange`, but the source dependencies were [studyLogs, monthOffset]. Inferred different dependency than source.\n\nC:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\LogScreen.tsx:492:40\n  490 |   }, [studyLogs, weekOffset])\n  491 |\n> 492 |   const selectedMonthMinutes = useMemo(() => {\n      |                                        ^^^^^^^\n> 493 |     const range = getMonthRange(monthOffset)\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 494 |     return getMinutesInRange(range.start, range.end)\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 495 |   }, [studyLogs, monthOffset])\n      | ^^^^ Could not preserve existing manual memoization\n  496 |\n  497 |   const chartData = useMemo(() => {\n  498 |     const days = chartRange === '7' ? 7 : 30","line":492,"column":40,"nodeType":null,"endLine":495,"endColumn":4},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getMinutesInRange'. Either include it or remove the dependency array.","line":495,"column":6,"nodeType":"ArrayExpression","endLine":495,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [monthOffset, getMinutesInRange]","fix":{"range":[16034,16058],"text":"[monthOffset, getMinutesInRange]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cycleRangeType' is assigned a value but never used.","line":548,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":548,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cycleOffset' is assigned a value but never used.","line":560,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":560,"endColumn":20}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useEffect, useMemo, useState } from 'react'\nimport {\n  Alert,\n  KeyboardAvoidingView,\n  Linking,\n  Modal,\n  FlatList,\n  Platform,\n  Pressable,\n  ScrollView,\n  Share,\n  StyleSheet,\n  Text,\n  TextInput,\n  View,\n} from 'react-native'\nimport Svg, { Circle, G } from 'react-native-svg'\nimport { Ionicons } from '@expo/vector-icons'\nimport { useFocusEffect } from '@react-navigation/native'\nimport { supabase } from '../lib/supabase'\nimport { useProfile } from '../contexts/ProfileContext'\nimport type { Profile, ReferenceBook, StudyLog } from '../types'\nimport { formatMinutes } from '../lib/format'\nimport {\n  formatDateInput,\n  formatDateLabel,\n  getStudyDay,\n  getStudyDayDate,\n  getThisMonthStart,\n  getThisWeekStart,\n  getTodayStart,\n  rangeContains,\n  startOfDay,\n  startOfMonth,\n  startOfWeek,\n} from '../lib/date'\n\nconst legendColors = [\n  '#0ea5e9',\n  '#f97316',\n  '#22c55e',\n  '#a855f7',\n  '#f43f5e',\n  '#14b8a6',\n  '#f59e0b',\n  '#3b82f6',\n  '#84cc16',\n  '#ec4899',\n  '#06b6d4',\n  '#6366f1',\n]\n\nexport function LogScreen() {\n  const { userId } = useProfile()\n  const [studyLogs, setStudyLogs] = useState<StudyLog[]>([])\n  const [referenceBooks, setReferenceBooks] = useState<ReferenceBook[]>([])\n  const [profile, setProfile] = useState<Profile | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [manualBookId, setManualBookId] = useState<string | null>(null)\n  const [manualMinutes, setManualMinutes] = useState('')\n  const [manualDate, setManualDate] = useState(formatDateInput(new Date()))\n  const [manualNotes, setManualNotes] = useState<string[]>([''])\n  const [attachNoteToExisting, setAttachNoteToExisting] = useState(false)\n  const [showManualInput, setShowManualInput] = useState(false)\n  const [showBookModal, setShowBookModal] = useState(false)\n  const [showEditBookModal, setShowEditBookModal] = useState(false)\n  const [showMemoLogs, setShowMemoLogs] = useState(false)\n  const [showEditLogs, setShowEditLogs] = useState(false)\n  const [editingLogIds, setEditingLogIds] = useState<string[]>([])\n  const [editBookId, setEditBookId] = useState<string | null>(null)\n  const [editSubject, setEditSubject] = useState('')\n  const [editMinutes, setEditMinutes] = useState('')\n  const [editDate, setEditDate] = useState(formatDateInput(new Date()))\n  const [editNote, setEditNote] = useState('')\n  const [showPastGoals, setShowPastGoals] = useState(false)\n  const [materialRangeType, setMaterialRangeType] = useState<'day' | 'week' | 'month' | 'total'>('day')\n  const [dayOffset, setDayOffset] = useState(0)\n  const [weekOffset, setWeekOffset] = useState(1)\n  const [monthOffset, setMonthOffset] = useState(1)\n  const [chartRange, setChartRange] = useState<'7' | '30'>('7')\n  const [chartOffset, setChartOffset] = useState(0)\n  const [showShareBanner, setShowShareBanner] = useState(true)\n  const [showRangeMenu, setShowRangeMenu] = useState(false)\n  const [showOffsetMenu, setShowOffsetMenu] = useState(false)\n  const [showWeekMenu, setShowWeekMenu] = useState(false)\n  const [showMonthMenu, setShowMonthMenu] = useState(false)\n\n  const loadData = async () => {\n    setLoading(true)\n    const [logsResult, booksResult, profileResult] = await Promise.all([\n      supabase\n        .from('study_logs')\n        .select('*')\n        .eq('user_id', userId)\n        .order('started_at', { ascending: false }),\n      supabase\n        .from('reference_books')\n        .select('*')\n        .eq('user_id', userId)\n        .is('deleted_at', null)\n        .order('created_at', { ascending: false }),\n      supabase\n        .from('profiles')\n        .select('*')\n        .eq('user_id', userId)\n        .single(),\n    ])\n    if (logsResult.error) {\n      Alert.alert('読み込みエラー', logsResult.error.message)\n    } else {\n      setStudyLogs((logsResult.data || []) as StudyLog[])\n    }\n    if (booksResult.error) {\n      Alert.alert('読み込みエラー', booksResult.error.message)\n    } else {\n      setReferenceBooks((booksResult.data || []) as ReferenceBook[])\n    }\n    if (!profileResult.error && profileResult.data) {\n      setProfile(profileResult.data as Profile)\n    }\n    setLoading(false)\n  }\n\n  useEffect(() => {\n    loadData()\n  }, [userId])\n\n  useFocusEffect(\n    useCallback(() => {\n      loadData()\n    }, [userId])\n  )\n\n  const todayStart = startOfDay()\n  const weekStart = startOfWeek()\n  const monthStart = startOfMonth()\n\n  const summary = useMemo(() => {\n    const today = studyLogs\n      .filter((log) => rangeContains(new Date(log.started_at), todayStart, new Date(todayStart.getTime() + 86400000)))\n      .reduce((sum, log) => sum + log.study_minutes, 0)\n    const week = studyLogs\n      .filter((log) => rangeContains(new Date(log.started_at), weekStart, new Date(weekStart.getTime() + 7 * 86400000)))\n      .reduce((sum, log) => sum + log.study_minutes, 0)\n    const month = studyLogs\n      .filter((log) =>\n        rangeContains(new Date(log.started_at), monthStart, new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 1))\n      )\n      .reduce((sum, log) => sum + log.study_minutes, 0)\n    const total = studyLogs.reduce((sum, log) => sum + log.study_minutes, 0)\n    return { today, week, month, total }\n  }, [studyLogs, todayStart, weekStart, monthStart])\n\n\n  const subjectTotals = useMemo(() => {\n    const map = new Map<string, number>()\n    studyLogs.forEach((log) => {\n      const key = log.subject || 'その他'\n      map.set(key, (map.get(key) || 0) + log.study_minutes)\n    })\n    return Array.from(map.entries()).sort((a, b) => b[1] - a[1])\n  }, [studyLogs])\n\n  const getMinutesInRange = (start: Date, end: Date): number => {\n    return studyLogs\n      .filter((log) => {\n        const logDate = new Date(log.started_at)\n        return logDate >= start && logDate < end\n      })\n      .reduce((sum, log) => sum + log.study_minutes, 0)\n  }\n\n  const getDayRange = (offset: number) => {\n    const start = getTodayStart()\n    start.setDate(start.getDate() - offset)\n    const end = new Date(start)\n    end.setDate(end.getDate() + 1)\n    return { start, end }\n  }\n\n  const getWeekRange = (offset: number) => {\n    const start = getThisWeekStart()\n    start.setDate(start.getDate() - 7 * offset)\n    const end = new Date(start)\n    end.setDate(end.getDate() + 7)\n    return { start, end }\n  }\n\n  const getMonthRange = (offset: number) => {\n    const start = getThisMonthStart()\n    start.setMonth(start.getMonth() - offset)\n    const end = new Date(start.getFullYear(), start.getMonth() + 1, 1)\n    return { start, end }\n  }\n\n  const getManualNoteValue = () => {\n    return manualNotes\n      .map((note) => note.trim())\n      .filter(Boolean)\n      .map((note) => `・${note}`)\n      .join('\\n')\n  }\n\n  const handleManualSubmit = async () => {\n    if (attachNoteToExisting) {\n      if (!manualDate) {\n        Alert.alert('入力エラー', '日付を入力してください')\n        return\n      }\n      const noteValue = getManualNoteValue()\n      if (!noteValue) {\n        Alert.alert('入力エラー', '勉強内容を入力してください')\n        return\n      }\n      const dateStart = new Date(manualDate)\n      dateStart.setHours(3, 0, 0, 0)\n      const dateEnd = new Date(dateStart)\n      dateEnd.setDate(dateEnd.getDate() + 1)\n      let query = supabase\n        .from('study_logs')\n        .select('id, note, started_at')\n        .eq('user_id', userId)\n        .gte('started_at', dateStart.toISOString())\n        .lt('started_at', dateEnd.toISOString())\n        .order('started_at', { ascending: false })\n        .limit(1)\n      if (manualBookId) {\n        query = query.eq('reference_book_id', manualBookId)\n      }\n      const { data: existing, error } = await query\n      if (error || !existing?.[0]) {\n        Alert.alert('エラー', '指定した日の記録が見つかりませんでした。')\n        return\n      }\n      const current = existing[0]\n      const newNote = current.note ? `${current.note}\\n\\n${noteValue}` : noteValue\n      await supabase.from('study_logs').update({ note: newNote }).eq('id', current.id)\n      setManualNotes([''])\n      setAttachNoteToExisting(false)\n      await loadData()\n      Alert.alert('追加完了', 'メモを追加しました。')\n      return\n    }\n\n    if (!manualBookId || !manualDate) {\n      Alert.alert('入力エラー', '教材と日付を入力してください')\n      return\n    }\n    if (!manualMinutes) {\n      Alert.alert('入力エラー', '学習時間を入力してください')\n      return\n    }\n\n    const minutes = parseInt(manualMinutes, 10)\n    if (isNaN(minutes) || minutes < 1) {\n      Alert.alert('入力エラー', '1分以上の学習時間を入力してください。')\n      return\n    }\n    const selectedBook = referenceBooks.find((book) => book.id === manualBookId)\n    const subject = selectedBook?.name?.trim() || 'その他'\n    const startedAt = new Date(manualDate)\n    startedAt.setHours(12, 0, 0, 0)\n    const noteValue = getManualNoteValue() || null\n    const { data, error } = await supabase\n      .from('study_logs')\n      .insert({\n        user_id: userId,\n        subject,\n        reference_book_id: manualBookId || null,\n        study_minutes: minutes,\n        started_at: startedAt.toISOString(),\n        note: noteValue,\n      })\n      .select()\n      .single()\n    if (error) {\n      Alert.alert('保存エラー', error.message)\n      return\n    }\n    if (noteValue && data?.id) {\n      const base = new Date(startedAt)\n      base.setHours(12, 0, 0, 0)\n      const reviewDays = [1, 3, 7, 14, 30, 60, 120, 240, 365, 730]\n      const tasks = reviewDays.map((days) => {\n        const due = new Date(base)\n        due.setDate(due.getDate() + days)\n        return {\n          user_id: userId,\n          study_log_id: data.id,\n          due_at: due.toISOString(),\n          status: 'pending',\n        }\n      })\n      await supabase.from('review_tasks').insert(tasks)\n    }\n    setManualMinutes('')\n    setManualDate(formatDateInput(new Date()))\n    setManualBookId(null)\n    setManualNotes([''])\n    setAttachNoteToExisting(false)\n    setShowManualInput(false)\n    await loadData()\n    Alert.alert('保存完了', '学習記録を追加しました。')\n  }\n\n\n  const logsWithNotes = studyLogs.filter((log) => log.note && log.note.trim().length > 0)\n\n  const groupedEditLogs = useMemo(() => {\n    const groups = new Map<\n      string,\n      {\n        ids: string[]\n        subject: string\n        reference_book_id: string | null\n        started_at: string\n        study_minutes: number\n        note: string | null\n        studyDay: string\n      }\n    >()\n    studyLogs.forEach((log) => {\n      const studyDay = getStudyDay(new Date(log.started_at))\n      const keyBase = log.reference_book_id ? `book:${log.reference_book_id}` : `subject:${log.subject}`\n      const key = `${studyDay}::${keyBase}`\n      const existing = groups.get(key)\n      if (!existing) {\n        groups.set(key, {\n          ids: [log.id],\n          subject: log.subject,\n          reference_book_id: log.reference_book_id || null,\n          started_at: log.started_at,\n          study_minutes: log.study_minutes,\n          note: log.note || null,\n          studyDay,\n        })\n      } else {\n        existing.ids.push(log.id)\n        existing.study_minutes += log.study_minutes\n        if (log.note && log.note.trim()) {\n          existing.note = existing.note ? `${existing.note}\\n\\n${log.note.trim()}` : log.note.trim()\n        }\n      }\n    })\n    return Array.from(groups.values())\n  }, [studyLogs])\n\n  const startEditGroup = (group: (typeof groupedEditLogs)[number]) => {\n    setEditingLogIds(group.ids)\n    setEditBookId(group.reference_book_id)\n    setEditSubject(group.subject)\n    setEditMinutes(String(group.study_minutes))\n    setEditDate(group.studyDay)\n    setEditNote(group.note || '')\n  }\n\n  const cancelEditLog = () => {\n    setEditingLogIds([])\n    setEditBookId(null)\n    setEditSubject('')\n    setEditMinutes('')\n    setEditDate(formatDateInput(new Date()))\n    setEditNote('')\n  }\n\n  const saveEditLog = async () => {\n    if (editingLogIds.length === 0) return\n    const minutes = parseInt(editMinutes, 10)\n    if (isNaN(minutes) || minutes < 1) {\n      Alert.alert('入力エラー', '1分以上の学習時間を入力してください。')\n      return\n    }\n    const selectedBook = referenceBooks.find((b) => b.id === editBookId)\n    const subject = selectedBook?.name?.trim() || editSubject.trim() || 'その他'\n    const inputDate = new Date(editDate)\n    inputDate.setHours(12, 0, 0, 0)\n    const startedAt = inputDate.toISOString()\n    const targetId = editingLogIds[0]\n    const { error } = await supabase\n      .from('study_logs')\n      .update({\n        subject,\n        reference_book_id: editBookId || null,\n        study_minutes: minutes,\n        started_at: startedAt,\n        note: editNote.trim() || null,\n      })\n      .eq('id', targetId)\n    if (error) {\n      Alert.alert('更新エラー', error.message)\n      return\n    }\n    if (editingLogIds.length > 1) {\n      const idsToDelete = editingLogIds.filter((id) => id !== targetId)\n      await supabase.from('study_logs').delete().in('id', idsToDelete)\n    }\n    cancelEditLog()\n    await loadData()\n  }\n\n  const deleteLogGroup = async (ids: string[]) => {\n    await supabase.from('study_logs').delete().in('id', ids)\n    await loadData()\n  }\n\n  const buildShareText = () => {\n    return `今日の学習: ${formatMinutes(summary.today)} / 今週: ${formatMinutes(summary.week)} / 今月: ${formatMinutes(\n      summary.month\n    )} / 累計: ${formatMinutes(summary.total)}`\n  }\n\n  const handleShare = async () => {\n    const message = buildShareText()\n    try {\n      await Share.share({ message })\n    } catch (_error) {\n      const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`\n      await Linking.openURL(url)\n    }\n  }\n\n  const getDailyTargetForDate = (date: Date) => {\n    if (!profile) return 60\n    const day = date.getDay()\n    const isWeekend = day === 0 || day === 6\n    const defaultTarget = isWeekend\n      ? profile.weekend_target_minutes ?? 120\n      : profile.weekday_target_minutes ?? 60\n    const dateString = formatDateInput(date)\n    if (profile.today_target_date === dateString && profile.today_target_minutes) {\n      return profile.today_target_minutes\n    }\n    return defaultTarget\n  }\n\n  const getWeekTarget = (weekStart: Date) => {\n    if (!profile) return 420\n    const weekStartDateString = formatDateInput(weekStart)\n    if (profile.week_target_date === weekStartDateString && profile.week_target_minutes) {\n      return profile.week_target_minutes\n    }\n    let total = 0\n    const cursor = new Date(weekStart)\n    for (let i = 0; i < 7; i++) {\n      total += getDailyTargetForDate(cursor)\n      cursor.setDate(cursor.getDate() + 1)\n    }\n    return total\n  }\n\n  const getMonthTarget = (monthStart: Date) => {\n    if (!profile) return 1800\n    const monthStartDateString = formatDateInput(monthStart)\n    if (profile.month_target_date === monthStartDateString && profile.month_target_minutes) {\n      return profile.month_target_minutes\n    }\n    let total = 0\n    const cursor = new Date(monthStart)\n    const end = new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 1)\n    while (cursor < end) {\n      total += getDailyTargetForDate(cursor)\n      cursor.setDate(cursor.getDate() + 1)\n    }\n    return total\n  }\n\n  const logsRangeTotals = useMemo(() => {\n    const range =\n      materialRangeType === 'day'\n        ? getDayRange(dayOffset)\n        : materialRangeType === 'week'\n          ? getWeekRange(weekOffset)\n          : materialRangeType === 'month'\n            ? getMonthRange(monthOffset)\n            : null\n    const filtered = range\n      ? studyLogs.filter((log) => rangeContains(new Date(log.started_at), range.start, range.end))\n      : studyLogs\n    const map = new Map<string, number>()\n    filtered.forEach((log) => {\n      const key = log.subject || 'その他'\n      map.set(key, (map.get(key) || 0) + log.study_minutes)\n    })\n    return Array.from(map.entries()).sort((a, b) => b[1] - a[1])\n  }, [studyLogs, materialRangeType, dayOffset, weekOffset, monthOffset])\n\n  const selectedWeekMinutes = useMemo(() => {\n    const range = getWeekRange(weekOffset)\n    return getMinutesInRange(range.start, range.end)\n  }, [studyLogs, weekOffset])\n\n  const selectedMonthMinutes = useMemo(() => {\n    const range = getMonthRange(monthOffset)\n    return getMinutesInRange(range.start, range.end)\n  }, [studyLogs, monthOffset])\n\n  const chartData = useMemo(() => {\n    const days = chartRange === '7' ? 7 : 30\n    const subjects = Array.from(new Set(studyLogs.map((log) => log.subject || 'その他')))\n    return Array.from({ length: days }, (_, index) => {\n      const date = new Date()\n      date.setDate(date.getDate() - (days - 1 - index + chartOffset * days))\n      const studyDay = getStudyDay(date)\n      const start = getStudyDayDate(studyDay)\n      const end = new Date(start)\n      end.setDate(end.getDate() + 1)\n      const totals: Record<string, number> = {}\n      subjects.forEach((subject) => {\n        totals[subject] = 0\n      })\n      studyLogs.forEach((log) => {\n        const logDate = new Date(log.started_at)\n        if (logDate >= start && logDate < end) {\n          const key = log.subject || 'その他'\n          totals[key] = (totals[key] || 0) + log.study_minutes\n        }\n      })\n      const totalMinutes = Object.values(totals).reduce((sum, value) => sum + value, 0)\n      return {\n        label: formatDateLabel(date),\n        totals,\n        totalMinutes,\n        subjects,\n      }\n    })\n  }, [chartRange, chartOffset, studyLogs])\n\n  const rangeTypeLabel = useMemo(() => {\n    if (materialRangeType === 'day') return '一日'\n    if (materialRangeType === 'week') return '一週間'\n    if (materialRangeType === 'month') return '一ヶ月'\n    return '総計'\n  }, [materialRangeType])\n\n  const offsetLabel = useMemo(() => {\n    if (materialRangeType === 'day') {\n      return dayOffset === 0 ? '今日' : `${dayOffset}日前`\n    }\n    if (materialRangeType === 'week') {\n      return weekOffset === 1 ? '先週' : `${weekOffset - 1}週間前`\n    }\n    if (materialRangeType === 'month') {\n      return monthOffset === 1 ? '先月' : `${monthOffset - 1}ヶ月前`\n    }\n    return '総計'\n  }, [materialRangeType, dayOffset, weekOffset, monthOffset])\n\n  const cycleRangeType = () => {\n    setMaterialRangeType((prev) => {\n      if (prev === 'day') return 'week'\n      if (prev === 'week') return 'month'\n      if (prev === 'month') return 'total'\n      return 'day'\n    })\n    setDayOffset(0)\n    setWeekOffset(0)\n    setMonthOffset(0)\n  }\n\n  const cycleOffset = () => {\n    if (materialRangeType === 'day') setDayOffset((prev) => (prev + 1) % 4)\n    if (materialRangeType === 'week') setWeekOffset((prev) => (prev % 6) + 1)\n    if (materialRangeType === 'month') setMonthOffset((prev) => (prev % 13) + 1)\n  }\n\n  const subjectColorMap = useMemo(() => {\n    const map = new Map<string, string>()\n    const subjects = Array.from(new Set(studyLogs.map((log) => log.subject || 'その他')))\n    subjects.forEach((subject, index) => {\n      if (map.has(subject)) return\n      const hash = Array.from(subject).reduce((acc, ch) => acc + ch.charCodeAt(0), 0)\n      const paletteColor = legendColors[index % legendColors.length]\n      const fallbackColor = `hsl(${(hash * 137.508) % 360}, 70%, 45%)`\n      map.set(subject, paletteColor || fallbackColor)\n    })\n    return map\n  }, [studyLogs])\n\n  const maxChartMinutes = Math.max(1, ...chartData.map((item) => item.totalMinutes))\n  const chartSubjects = useMemo(() => {\n    return Array.from(new Set(studyLogs.map((log) => log.subject || 'その他')))\n  }, [studyLogs])\n\n  const rangeOptions: { label: string; value: 'day' | 'week' | 'month' | 'total' }[] = [\n    { label: '一日', value: 'day' },\n    { label: '1週間', value: 'week' },\n    { label: '1ヶ月', value: 'month' },\n    { label: '総累計', value: 'total' },\n  ]\n\n  const offsetOptions = useMemo(() => {\n    if (materialRangeType === 'day') {\n      return [\n        { label: '今日', value: 0 },\n        { label: '昨日', value: 1 },\n        { label: '2日前', value: 2 },\n        { label: '3日前', value: 3 },\n        { label: '4日前', value: 4 },\n        { label: '5日前', value: 5 },\n        { label: '6日前', value: 6 },\n        { label: '7日前', value: 7 },\n      ]\n    }\n    if (materialRangeType === 'week') {\n      return Array.from({ length: 6 }, (_, index) => ({\n        label: index === 0 ? '先週' : `${index}週間前`,\n        value: index + 1,\n      }))\n    }\n    if (materialRangeType === 'month') {\n      return Array.from({ length: 13 }, (_, index) => ({\n        label: index === 0 ? '先月' : `${index}ヶ月前`,\n        value: index + 1,\n      }))\n    }\n    return []\n  }, [materialRangeType])\n  const weekOptions = Array.from({ length: 6 }, (_, index) => ({\n    label: index === 0 ? '先週' : `${index}週間前`,\n    value: index + 1,\n  }))\n  const monthOptions = Array.from({ length: 13 }, (_, index) => ({\n    label: index === 0 ? '先月' : `${index}ヶ月前`,\n    value: index + 1,\n  }))\n\n  const totalMinutesForDonut = logsRangeTotals.reduce((sum, [, minutes]) => sum + minutes, 0)\n  const donutData = logsRangeTotals.map(([subject, minutes], index) => ({\n    subject,\n    minutes,\n    color: subjectColorMap.get(subject) || legendColors[index % legendColors.length],\n    percent: totalMinutesForDonut > 0 ? Math.round((minutes / totalMinutesForDonut) * 100) : 0,\n  }))\n\n  return (\n    <KeyboardAvoidingView\n      style={styles.screen}\n      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\n      keyboardVerticalOffset={80}\n    >\n      <ScrollView contentContainerStyle={styles.container} keyboardShouldPersistTaps=\"handled\">\n      <View style={styles.card}>\n        <Text style={styles.sectionTitle}>学習時間</Text>\n        {loading ? (\n          <Text style={styles.mutedText}>読み込み中...</Text>\n        ) : (\n          <View style={styles.summaryRow}>\n            {[\n              { label: '今日', value: summary.today },\n              { label: '今週', value: summary.week },\n              { label: '今月', value: summary.month },\n              { label: '総計', value: summary.total },\n            ].map((item) => (\n              <View key={item.label} style={styles.summaryCard}>\n                <Text style={styles.summaryValue}>{formatMinutes(item.value)}</Text>\n                <Text style={styles.summaryLabel}>{item.label}</Text>\n              </View>\n            ))}\n          </View>\n        )}\n        <View style={styles.smallCardRow}>\n          <View style={styles.smallCard}>\n            <View style={styles.smallCardHeader}>\n              <Text style={styles.smallCardLabel}>先週</Text>\n              <View style={[styles.selectWrap, styles.selectWrapShrink]}>\n                <Pressable style={styles.smallSelectButton} onPress={() => setShowWeekMenu((prev) => !prev)}>\n                  <Text style={styles.smallSelectText} numberOfLines={1}>{weekOffset === 1 ? '先週' : `${weekOffset - 1}週間前`}</Text>\n                  <Ionicons name=\"chevron-down\" size={14} color=\"#334155\" />\n                </Pressable>\n                {showWeekMenu && (\n                  <View style={[styles.selectMenu, styles.selectMenuSmall]}>\n                    {weekOptions.map((option) => (\n                      <Pressable\n                        key={option.value}\n                        style={styles.selectMenuItem}\n                        onPress={() => {\n                          setWeekOffset(option.value)\n                          setShowWeekMenu(false)\n                        }}\n                      >\n                        <Text style={styles.selectMenuText}>{option.label}</Text>\n                      </Pressable>\n                    ))}\n                  </View>\n                )}\n              </View>\n            </View>\n            <View style={styles.smallCardValueWrap}>\n              <Text style={styles.smallCardValue}>{formatMinutes(selectedWeekMinutes)}</Text>\n            </View>\n          </View>\n          <View style={styles.smallCard}>\n            <View style={styles.smallCardHeader}>\n              <Text style={styles.smallCardLabel}>先月</Text>\n              <View style={[styles.selectWrap, styles.selectWrapShrink]}>\n                <Pressable style={styles.smallSelectButton} onPress={() => setShowMonthMenu((prev) => !prev)}>\n                  <Text style={styles.smallSelectText} numberOfLines={1}>{monthOffset === 1 ? '先月' : `${monthOffset - 1}ヶ月前`}</Text>\n                  <Ionicons name=\"chevron-down\" size={14} color=\"#334155\" />\n                </Pressable>\n                {showMonthMenu && (\n                  <View style={[styles.selectMenu, styles.selectMenuSmall, styles.selectMenuRight]}>\n                    {monthOptions.map((option) => (\n                      <Pressable\n                        key={option.value}\n                        style={styles.selectMenuItem}\n                        onPress={() => {\n                          setMonthOffset(option.value)\n                          setShowMonthMenu(false)\n                        }}\n                      >\n                        <Text style={styles.selectMenuText}>{option.label}</Text>\n                      </Pressable>\n                    ))}\n                  </View>\n                )}\n              </View>\n            </View>\n            <View style={styles.smallCardValueWrap}>\n              <Text style={styles.smallCardValue}>{formatMinutes(selectedMonthMinutes)}</Text>\n            </View>\n          </View>\n        </View>\n      </View>\n\n      {showShareBanner && (\n        <View style={styles.shareBanner}>\n          <Pressable style={styles.row} onPress={handleShare}>\n            <Ionicons name=\"share-social-outline\" size={18} color=\"#2563eb\" />\n            <Text style={styles.shareText}>学習記録を共有</Text>\n          </Pressable>\n          <Pressable style={styles.closeButton} onPress={() => setShowShareBanner(false)}>\n            <Ionicons name=\"close\" size={16} color=\"#334155\" />\n          </Pressable>\n        </View>\n      )}\n\n      <View style={styles.card}>\n        <View style={styles.headerRow}>\n          <View style={styles.row}>\n            <Pressable\n              style={styles.navButton}\n              onPress={() => setChartOffset((prev) => prev + 1)}\n            >\n              <Ionicons name=\"chevron-back\" size={16} color=\"#334155\" />\n            </Pressable>\n            <Text style={styles.sectionTitle}>過去{chartRange === '7' ? '7日' : '30日'}</Text>\n            <Pressable\n              style={[styles.navButton, chartOffset === 0 && styles.navButtonDisabled]}\n              onPress={() => setChartOffset((prev) => Math.max(0, prev - 1))}\n              disabled={chartOffset === 0}\n            >\n              <Ionicons name=\"chevron-forward\" size={16} color={chartOffset === 0 ? '#cbd5e1' : '#334155'} />\n            </Pressable>\n          </View>\n          <View style={styles.row}>\n            <Pressable\n              style={[styles.rangeToggle, chartRange === '7' && styles.rangeToggleActive]}\n              onPress={() => {\n                setChartRange('7')\n                setChartOffset(0)\n              }}\n            >\n              <Text style={[styles.rangeToggleText, chartRange === '7' && styles.rangeToggleTextActive]}>7日</Text>\n            </Pressable>\n            <Pressable\n              style={[styles.rangeToggle, chartRange === '30' && styles.rangeToggleActive]}\n              onPress={() => {\n                setChartRange('30')\n                setChartOffset(0)\n              }}\n            >\n              <Text style={[styles.rangeToggleText, chartRange === '30' && styles.rangeToggleTextActive]}>\n                30日\n              </Text>\n            </Pressable>\n          </View>\n        </View>\n        <View style={styles.chartArea}>\n          <View style={styles.chartRow}>\n            <View style={styles.yAxis}>\n              <Text style={styles.yAxisTitle}>時間</Text>\n              <Text style={styles.yAxisLabel}>{formatMinutes(maxChartMinutes)}</Text>\n              <Text style={styles.yAxisLabel}>{formatMinutes(Math.round(maxChartMinutes / 2))}</Text>\n              <Text style={styles.yAxisLabel}>0</Text>\n            </View>\n            <View style={styles.chartBody}>\n              <View style={styles.chartBars}>\n                {chartData.map((item, index) => {\n                  const segments = chartSubjects\n                    .map((subject) => ({\n                      subject,\n                      minutes: item.totals[subject] || 0,\n                      color: subjectColorMap.get(subject),\n                    }))\n                    .filter((segment) => segment.minutes > 0)\n                  return (\n                    <View key={`${item.label}-${index}`} style={styles.chartBarItem}>\n                      <View style={styles.chartStack}>\n                        {segments.map((segment) => {\n                          return (\n                            <View\n                              key={`${item.label}-${segment.subject}`}\n                              style={[\n                                styles.chartBarSegment,\n                                {\n                                  height: Math.round((segment.minutes / maxChartMinutes) * 120),\n                                  backgroundColor: segment.color,\n                                },\n                              ]}\n                            />\n                          )\n                        })}\n                      </View>\n                    </View>\n                  )\n                })}\n              </View>\n              <View style={styles.chartLabels}>\n                {chartData.map((item, index) => (\n                  <Text key={`${item.label}-label-${index}`} style={styles.chartLabel}>\n                    {item.label}\n                  </Text>\n                ))}\n              </View>\n            </View>\n          </View>\n          <View style={styles.chartLegend}>\n            {chartSubjects.map((subject) => (\n              <View key={`legend-${subject}`} style={styles.legendItem}>\n                <View style={[styles.legendDot, { backgroundColor: subjectColorMap.get(subject) }]} />\n                <Text style={styles.legendText}>{subject}</Text>\n              </View>\n            ))}\n          </View>\n        </View>\n      </View>\n\n      <View style={styles.card}>\n        <Text style={styles.sectionTitle}>教材別の学習時間</Text>\n        <View style={styles.rangeControlRow}>\n          <View style={styles.rangeControl}>\n            <Text style={styles.rangeControlLabel}>表示期間</Text>\n            <View style={styles.selectWrap}>\n              <Pressable style={styles.selectButton} onPress={() => setShowRangeMenu((prev) => !prev)}>\n                <Text style={styles.selectButtonText}>{rangeTypeLabel}</Text>\n                <Ionicons name=\"chevron-down\" size={14} color=\"#334155\" />\n              </Pressable>\n              {showRangeMenu && (\n                <View style={styles.selectMenu}>\n                  {rangeOptions.map((option) => (\n                    <Pressable\n                      key={option.value}\n                      style={styles.selectMenuItem}\n                      onPress={() => {\n                        setMaterialRangeType(option.value)\n                        setDayOffset(0)\n                        setWeekOffset(option.value === 'week' ? 1 : 0)\n                        setMonthOffset(option.value === 'month' ? 1 : 0)\n                        setShowRangeMenu(false)\n                      }}\n                    >\n                      <Text style={styles.selectMenuText}>{option.label}</Text>\n                    </Pressable>\n                  ))}\n                </View>\n              )}\n            </View>\n          </View>\n          {materialRangeType !== 'total' && (\n            <View style={styles.selectWrap}>\n              <Pressable style={styles.selectButton} onPress={() => setShowOffsetMenu((prev) => !prev)}>\n                <Text style={styles.selectButtonText}>{offsetLabel}</Text>\n                <Ionicons name=\"chevron-down\" size={14} color=\"#334155\" />\n              </Pressable>\n              {showOffsetMenu && (\n                <View style={[styles.selectMenu, styles.selectMenuRight]}>\n                  {offsetOptions.map((option) => (\n                    <Pressable\n                      key={option.label}\n                      style={styles.selectMenuItem}\n                      onPress={() => {\n                        if (materialRangeType === 'day') setDayOffset(option.value)\n                        if (materialRangeType === 'week') setWeekOffset(option.value)\n                        if (materialRangeType === 'month') setMonthOffset(option.value)\n                        setShowOffsetMenu(false)\n                      }}\n                    >\n                      <Text style={styles.selectMenuText}>{option.label}</Text>\n                    </Pressable>\n                  ))}\n                </View>\n              )}\n            </View>\n          )}\n        </View>\n        {logsRangeTotals.length === 0 ? (\n          <Text style={styles.mutedText}>学習記録がありません</Text>\n        ) : (\n          <>\n            <View style={styles.donutWrap}>\n              <Svg width={220} height={220}>\n                <G rotation={-90} origin=\"110, 110\">\n                  {donutData.reduce<{ offset: number; nodes: JSX.Element[] }>(\n                    (acc, item, idx) => {\n                      const radius = 70\n                      const circumference = 2 * Math.PI * radius\n                      const dash = (item.minutes / Math.max(1, totalMinutesForDonut)) * circumference\n                      const gap = circumference - dash\n                      acc.nodes.push(\n                        <Circle\n                          key={`${item.subject}-${idx}`}\n                          cx=\"110\"\n                          cy=\"110\"\n                          r={radius}\n                          stroke={item.color}\n                          strokeWidth={26}\n                          strokeDasharray={`${dash} ${gap}`}\n                          strokeDashoffset={-acc.offset}\n                          strokeLinecap=\"round\"\n                          fill=\"transparent\"\n                        />\n                      )\n                      acc.offset += dash\n                      return acc\n                    },\n                    { offset: 0, nodes: [] }\n                  ).nodes}\n                </G>\n              </Svg>\n            </View>\n            {donutData.map((item) => (\n              <View key={item.subject} style={styles.donutRow}>\n                <View style={styles.legendItem}>\n                  <View style={[styles.legendDot, { backgroundColor: item.color }]} />\n                  <Text style={styles.legendText}>{item.subject}</Text>\n                </View>\n                <Text style={styles.donutValue}>\n                  {formatMinutes(item.minutes)} ({item.percent}%)\n                </Text>\n              </View>\n            ))}\n          </>\n        )}\n      </View>\n\n      <View style={styles.card}>\n        <View style={styles.headerRow}>\n          <View>\n            <Text style={styles.sectionTitle}>学習記録の入力</Text>\n            <Text style={styles.sectionSubtitle}>今日や過去の学習内容をまとめて入力できます</Text>\n          </View>\n          <Pressable style={styles.plusButton} onPress={() => setShowManualInput((prev) => !prev)}>\n            <Ionicons name={showManualInput ? 'remove' : 'add'} size={18} color=\"#334155\" />\n          </Pressable>\n        </View>\n        {showManualInput && (\n          <>\n            <Pressable\n              style={styles.checkboxContainer}\n              onPress={() => setAttachNoteToExisting((prev) => !prev)}\n            >\n              <Ionicons\n                name={attachNoteToExisting ? 'checkbox' : 'square-outline'}\n                size={24}\n                color={attachNoteToExisting ? '#2563eb' : '#94a3b8'}\n              />\n              <Text style={styles.checkboxLabel}>\n                計測済みの記録にメモを追加（時間入力不要）\n              </Text>\n            </Pressable>\n\n            {!attachNoteToExisting && (\n              <>\n                <View style={styles.inputGroup}>\n                  <Text style={styles.label}>教材</Text>\n                  <Pressable\n                    style={styles.selectTrigger}\n                    onPress={() => setShowBookModal(true)}\n                  >\n                    <Text style={styles.selectTriggerText}>\n                      {manualBookId\n                        ? referenceBooks.find((b) => b.id === manualBookId)?.name || 'その他'\n                        : 'その他'}\n                    </Text>\n                    <Ionicons name=\"chevron-down\" size={20} color=\"#64748b\" />\n                  </Pressable>\n                </View>\n                <View style={styles.inputGroup}>\n                  <Text style={styles.label}>学習時間（分）</Text>\n                  <TextInput\n                    style={styles.input}\n                    keyboardType=\"numeric\"\n                    value={manualMinutes}\n                    onChangeText={setManualMinutes}\n                    placeholder=\"60\"\n                  />\n                </View>\n              </>\n            )}\n\n            <View style={styles.inputGroup}>\n              <Text style={styles.label}>学習日</Text>\n              <TextInput\n                style={styles.input}\n                value={manualDate}\n                onChangeText={setManualDate}\n                placeholder=\"YYYY-MM-DD\"\n              />\n            </View>\n\n            <View style={styles.inputGroup}>\n              <Text style={styles.label}>勉強内容</Text>\n              {manualNotes.map((note, index) => (\n                <View key={`note-${index}`} style={styles.noteRow}>\n                  <TextInput\n                    style={[styles.input, styles.noteInput]}\n                    value={note}\n                    onChangeText={(value) => {\n                      const next = [...manualNotes]\n                      next[index] = value\n                      setManualNotes(next)\n                    }}\n                    placeholder=\"例: 二次関数の最大最小\"\n                    multiline\n                  />\n                  <Pressable\n                    style={styles.deleteButton}\n                    onPress={() => {\n                      const next = manualNotes.filter((_, i) => i !== index)\n                      setManualNotes(next.length ? next : [''])\n                    }}\n                  >\n                    <Text style={styles.deleteText}>削除</Text>\n                  </Pressable>\n                </View>\n              ))}\n              <Pressable style={styles.outlineButton} onPress={() => setManualNotes([...manualNotes, ''])}>\n                <Text style={styles.outlineButtonText}>内容を追加</Text>\n              </Pressable>\n            </View>\n            <Pressable style={styles.primaryButton} onPress={handleManualSubmit}>\n              <Text style={styles.primaryButtonText}>送信</Text>\n            </Pressable>\n\n            <Modal\n              visible={showBookModal}\n              transparent={true}\n              animationType=\"fade\"\n              onRequestClose={() => setShowBookModal(false)}\n            >\n              <Pressable style={styles.modalOverlay} onPress={() => setShowBookModal(false)}>\n                <View style={styles.modalContent}>\n                  <View style={styles.modalHeader}>\n                    <Text style={styles.modalTitle}>教材を選択</Text>\n                    <Pressable onPress={() => setShowBookModal(false)}>\n                      <Ionicons name=\"close\" size={24} color=\"#64748b\" />\n                    </Pressable>\n                  </View>\n                  <FlatList\n                    data={[{ id: null, name: 'その他' }, ...referenceBooks]}\n                    keyExtractor={(item) => item.id || 'other'}\n                    renderItem={({ item }) => (\n                      <Pressable\n                        style={styles.modalItem}\n                        onPress={() => {\n                          setManualBookId(item.id || null)\n                          setShowBookModal(false)\n                        }}\n                      >\n                        <Text\n                          style={[\n                            styles.modalItemText,\n                            manualBookId === (item.id || null) && styles.modalItemTextSelected,\n                          ]}\n                        >\n                          {item.name}\n                        </Text>\n                        {manualBookId === (item.id || null) && (\n                          <Ionicons name=\"checkmark\" size={20} color=\"#2563eb\" />\n                        )}\n                      </Pressable>\n                    )}\n                  />\n                </View>\n              </Pressable>\n            </Modal>\n          </>\n        )}\n      </View>\n\n      <View style={styles.card}>\n        <View style={styles.headerRow}>\n          <View>\n            <Text style={styles.sectionTitle}>学習内容メモ</Text>\n            <Text style={styles.sectionSubtitle}>入力した内容をあとから見返せます</Text>\n          </View>\n          <Pressable style={styles.plusButton} onPress={() => setShowMemoLogs((prev) => !prev)}>\n            <Ionicons name={showMemoLogs ? 'remove' : 'add'} size={18} color=\"#334155\" />\n          </Pressable>\n        </View>\n        {showMemoLogs && (\n          <>\n            {logsWithNotes.length === 0 ? (\n              <Text style={styles.mutedText}>まだメモがありません</Text>\n            ) : (\n              logsWithNotes.map((log) => (\n                <View key={log.id} style={styles.logItem}>\n                  <View>\n                    <Text style={styles.logTitle}>\n                      {log.subject} / {formatMinutes(log.study_minutes)}\n                    </Text>\n                    <Text style={styles.mutedText}>{new Date(log.started_at).toLocaleDateString('ja-JP')}</Text>\n                    <Text style={styles.noteText}>{log.note}</Text>\n                  </View>\n                </View>\n              ))\n            )}\n          </>\n        )}\n      </View>\n\n      <View style={styles.card}>\n        <View style={styles.headerRow}>\n          <View>\n            <Text style={styles.sectionTitle}>学習記録の修正</Text>\n            <Text style={styles.sectionSubtitle}>直近の記録を編集・削除できます</Text>\n          </View>\n          <Pressable style={styles.plusButton} onPress={() => setShowEditLogs((prev) => !prev)}>\n            <Ionicons name={showEditLogs ? 'remove' : 'add'} size={18} color=\"#334155\" />\n          </Pressable>\n        </View>\n        {showEditLogs && (\n          <>\n            {groupedEditLogs.length === 0 && <Text style={styles.mutedText}>学習記録がありません</Text>}\n            {groupedEditLogs.slice(0, 20).map((group) => (\n              <View key={`${group.studyDay}-${group.subject}-${group.reference_book_id || 'none'}`} style={styles.logItem}>\n                {editingLogIds.length > 0 && editingLogIds.includes(group.ids[0]) ? (\n                  <View>\n                    <Text style={styles.label}>教材</Text>\n                    <Pressable\n                      style={styles.selectTrigger}\n                      onPress={() => setShowEditBookModal(true)}\n                    >\n                      <Text style={styles.selectTriggerText}>\n                        {editBookId\n                          ? referenceBooks.find((b) => b.id === editBookId)?.name || 'その他'\n                          : 'その他'}\n                      </Text>\n                      <Ionicons name=\"chevron-down\" size={20} color=\"#64748b\" />\n                    </Pressable>\n                    <Modal\n                      visible={showEditBookModal}\n                      transparent={true}\n                      animationType=\"fade\"\n                      onRequestClose={() => setShowEditBookModal(false)}\n                    >\n                      <Pressable style={styles.modalOverlay} onPress={() => setShowEditBookModal(false)}>\n                        <View style={styles.modalContent}>\n                          <View style={styles.modalHeader}>\n                            <Text style={styles.modalTitle}>教材を選択</Text>\n                            <Pressable onPress={() => setShowEditBookModal(false)}>\n                              <Ionicons name=\"close\" size={24} color=\"#64748b\" />\n                            </Pressable>\n                          </View>\n                          <FlatList\n                            data={[{ id: null, name: 'その他' }, ...referenceBooks]}\n                            keyExtractor={(item) => item.id || 'other'}\n                            renderItem={({ item }) => (\n                              <Pressable\n                                style={styles.modalItem}\n                                onPress={() => {\n                                  setEditBookId(item.id || null)\n                                  setShowEditBookModal(false)\n                                }}\n                              >\n                                <Text\n                                  style={[\n                                    styles.modalItemText,\n                                    editBookId === (item.id || null) && styles.modalItemTextSelected,\n                                  ]}\n                                >\n                                  {item.name}\n                                </Text>\n                                {editBookId === (item.id || null) && (\n                                  <Ionicons name=\"checkmark\" size={20} color=\"#2563eb\" />\n                                )}\n                              </Pressable>\n                            )}\n                          />\n                        </View>\n                      </Pressable>\n                    </Modal>\n                    <Text style={styles.label}>科目名（自由入力）</Text>\n                    <TextInput style={styles.input} value={editSubject} onChangeText={setEditSubject} />\n                    <Text style={styles.label}>学習時間（分）</Text>\n                    <TextInput style={styles.input} value={editMinutes} onChangeText={setEditMinutes} keyboardType=\"numeric\" />\n                    <Text style={styles.label}>学習日</Text>\n                    <TextInput style={styles.input} value={editDate} onChangeText={setEditDate} />\n                    <Text style={styles.label}>勉強内容</Text>\n                    <TextInput style={[styles.input, styles.noteInput]} value={editNote} onChangeText={setEditNote} multiline />\n                    <View style={styles.row}>\n                      <Pressable style={styles.primaryButton} onPress={saveEditLog}>\n                        <Text style={styles.primaryButtonText}>保存</Text>\n                      </Pressable>\n                      <Pressable style={styles.outlineButton} onPress={cancelEditLog}>\n                        <Text style={styles.outlineButtonText}>キャンセル</Text>\n                      </Pressable>\n                      <Pressable style={styles.deleteButton} onPress={() => deleteLogGroup(group.ids)}>\n                        <Text style={styles.deleteText}>削除</Text>\n                      </Pressable>\n                    </View>\n                  </View>\n                ) : (\n                  <View style={styles.row}>\n                    <View style={styles.flex}>\n                      <Text style={styles.mutedText}>{getStudyDayDate(group.studyDay).toLocaleDateString('ja-JP')}</Text>\n                      <Text style={styles.logTitle}>\n                        {group.subject} / {formatMinutes(group.study_minutes)}\n                      </Text>\n                      {group.note && <Text style={styles.noteText}>{group.note}</Text>}\n                    </View>\n                    <Pressable style={styles.outlineButton} onPress={() => startEditGroup(group)}>\n                      <Text style={styles.outlineButtonText}>編集</Text>\n                    </Pressable>\n                  </View>\n                )}\n              </View>\n            ))}\n          </>\n        )}\n      </View>\n\n      {profile && (\n        <View style={styles.card}>\n          <View style={styles.headerRow}>\n            <View>\n              <Text style={styles.sectionTitle}>過去の目標達成状況</Text>\n              <Text style={styles.sectionSubtitle}>過去の日・週・月の目標達成状況を確認</Text>\n            </View>\n            <Pressable style={styles.plusButton} onPress={() => setShowPastGoals((prev) => !prev)}>\n              <Ionicons name={showPastGoals ? 'remove' : 'add'} size={18} color=\"#334155\" />\n            </Pressable>\n          </View>\n          {showPastGoals && (\n            <>\n              {[1, 2, 3, 4, 5].map((i) => {\n                const date = new Date()\n                date.setDate(date.getDate() - i)\n                const target = getDailyTargetForDate(date)\n                const dayStart = new Date(date)\n                dayStart.setHours(3, 0, 0, 0)\n                const dayEnd = new Date(dayStart)\n                dayEnd.setDate(dayEnd.getDate() + 1)\n                const actual = getMinutesInRange(dayStart, dayEnd)\n                const progress = Math.min(100, Math.round((actual / Math.max(1, target)) * 100))\n                return (\n                  <View key={`past-day-${i}`} style={styles.goalItem}>\n                    <Text style={styles.mutedText}>{date.toLocaleDateString('ja-JP')}</Text>\n                    <Text style={styles.goalText}>\n                      {formatMinutes(actual)} / {formatMinutes(target)}（達成率 {progress}%）\n                    </Text>\n                    <ProgressBar progress={progress} />\n                  </View>\n                )\n              })}\n              {[1, 2, 3].map((i) => {\n                const weekStart = getThisWeekStart()\n                weekStart.setDate(weekStart.getDate() - 7 * i)\n                const weekEnd = new Date(weekStart)\n                weekEnd.setDate(weekEnd.getDate() + 7)\n                const target = getWeekTarget(weekStart)\n                const actual = getMinutesInRange(weekStart, weekEnd)\n                const progress = Math.min(100, Math.round((actual / Math.max(1, target)) * 100))\n                return (\n                  <View key={`past-week-${i}`} style={styles.goalItem}>\n                    <Text style={styles.mutedText}>{formatDateLabel(weekStart)} 週</Text>\n                    <Text style={styles.goalText}>\n                      {formatMinutes(actual)} / {formatMinutes(target)}（達成率 {progress}%）\n                    </Text>\n                    <ProgressBar progress={progress} />\n                  </View>\n                )\n              })}\n              {[1, 2, 3].map((i) => {\n                const monthStart = getThisMonthStart()\n                monthStart.setMonth(monthStart.getMonth() - i)\n                const monthEnd = new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 1)\n                const target = getMonthTarget(monthStart)\n                const actual = getMinutesInRange(monthStart, monthEnd)\n                const progress = Math.min(100, Math.round((actual / Math.max(1, target)) * 100))\n                return (\n                  <View key={`past-month-${i}`} style={styles.goalItem}>\n                    <Text style={styles.mutedText}>\n                      {monthStart.getFullYear()}年{monthStart.getMonth() + 1}月\n                    </Text>\n                    <Text style={styles.goalText}>\n                      {formatMinutes(actual)} / {formatMinutes(target)}（達成率 {progress}%）\n                    </Text>\n                    <ProgressBar progress={progress} />\n                  </View>\n                )\n              })}\n            </>\n          )}\n        </View>\n      )}\n\n      </ScrollView>\n    </KeyboardAvoidingView>\n  )\n}\n\nfunction ProgressBar({ progress }: { progress: number }) {\n  return (\n    <View style={styles.progressTrack}>\n      <View style={[styles.progressFill, { width: `${progress}%` }]} />\n    </View>\n  )\n}\n\nconst styles = StyleSheet.create({\n  screen: {\n    flex: 1,\n  },\n  container: {\n    padding: 16,\n    backgroundColor: '#f1f5fb',\n  },\n  headerRow: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  card: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 16,\n    padding: 16,\n    marginBottom: 12,\n    backgroundColor: '#ffffff',\n  },\n  sectionTitle: {\n    fontSize: 16,\n    fontWeight: '600',\n  },\n  sectionSubtitle: {\n    fontSize: 12,\n    color: '#94a3b8',\n  },\n  summaryRow: {\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    gap: 8,\n    marginTop: 12,\n  },\n  summaryCard: {\n    flexBasis: '48%',\n    backgroundColor: '#f3f4f6',\n    borderRadius: 12,\n    paddingVertical: 12,\n    alignItems: 'center',\n  },\n  summaryValue: {\n    fontSize: 16,\n    fontWeight: '700',\n  },\n  summaryLabel: {\n    fontSize: 12,\n    color: '#6b7280',\n    marginTop: 4,\n  },\n  smallCardRow: {\n    flexDirection: 'row',\n    gap: 10,\n    marginTop: 12,\n  },\n  smallCard: {\n    flex: 1,\n    minWidth: 0,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 12,\n    padding: 12,\n    backgroundColor: '#f8fafc',\n  },\n  smallCardHeader: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  smallCardLabel: {\n    fontSize: 12,\n    color: '#94a3b8',\n  },\n  smallSelectButton: {\n    borderWidth: 1,\n    borderColor: '#d1d5db',\n    borderRadius: 10,\n    paddingHorizontal: 10,\n    paddingVertical: 6,\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 6,\n    backgroundColor: '#eef2f7',\n    flexShrink: 1,\n    minWidth: 0,\n  },\n  smallSelectText: {\n    fontSize: 12,\n    color: '#334155',\n    fontWeight: '600',\n    flexShrink: 1,\n  },\n  smallCardBadge: {\n    fontSize: 11,\n    color: '#334155',\n    backgroundColor: '#e2e8f0',\n    paddingHorizontal: 6,\n    paddingVertical: 2,\n    borderRadius: 8,\n  },\n  smallCardValueWrap: {\n    marginTop: 8,\n    paddingVertical: 6,\n    paddingHorizontal: 8,\n    backgroundColor: '#f1f5f9',\n    borderRadius: 8,\n  },\n  smallCardValue: {\n    fontSize: 14,\n    fontWeight: '700',\n    color: '#0f172a',\n  },\n  shareBanner: {\n    borderWidth: 1,\n    borderColor: '#cbd5f5',\n    borderRadius: 12,\n    padding: 12,\n    backgroundColor: '#eef2ff',\n    marginBottom: 12,\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  shareText: {\n    color: '#2563eb',\n    fontWeight: '600',\n    marginLeft: 8,\n  },\n  closeButton: {\n    width: 28,\n    height: 28,\n    borderRadius: 8,\n    borderWidth: 1,\n    borderColor: '#cbd5f5',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#f8fafc',\n  },\n  rangeToggle: {\n    borderWidth: 1,\n    borderColor: '#cbd5f5',\n    borderRadius: 10,\n    paddingHorizontal: 10,\n    paddingVertical: 6,\n    backgroundColor: '#f8fafc',\n  },\n  rangeToggleActive: {\n    backgroundColor: '#2563eb',\n    borderColor: '#2563eb',\n  },\n  rangeToggleText: {\n    color: '#0f172a',\n    fontSize: 12,\n  },\n  rangeToggleTextActive: {\n    color: '#ffffff',\n  },\n  navButton: {\n    width: 28,\n    height: 28,\n    borderRadius: 8,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#f8fafc',\n  },\n  navButtonDisabled: {\n    backgroundColor: '#f1f5f9',\n    borderColor: '#e2e8f0',\n  },\n  chartArea: {\n    marginTop: 12,\n  },\n  chartRow: {\n    flexDirection: 'row',\n    alignItems: 'flex-end',\n  },\n  yAxis: {\n    width: 44,\n    alignItems: 'flex-start',\n    justifyContent: 'space-between',\n    height: 150,\n    paddingBottom: 18,\n  },\n  yAxisTitle: {\n    fontSize: 10,\n    color: '#94a3b8',\n    marginBottom: 4,\n  },\n  yAxisLabel: {\n    fontSize: 9,\n    color: '#94a3b8',\n  },\n  chartBody: {\n    flex: 1,\n  },\n  chartBars: {\n    flexDirection: 'row',\n    alignItems: 'flex-end',\n    justifyContent: 'space-between',\n    minHeight: 130,\n    paddingHorizontal: 4,\n  },\n  chartStack: {\n    height: 120,\n    justifyContent: 'flex-end',\n    alignItems: 'center',\n    flexDirection: 'column',\n    gap: 0,\n  },\n  chartBarItem: {\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'flex-end',\n    marginHorizontal: 2,\n  },\n  chartBarSegment: {\n    width: 10,\n    borderRadius: 0,\n  },\n  chartLabels: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    marginTop: 6,\n  },\n  chartLabel: {\n    fontSize: 9,\n    color: '#94a3b8',\n    flex: 1,\n    textAlign: 'center',\n  },\n  chartLegend: {\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    gap: 8,\n    marginTop: 8,\n  },\n  legendRow: {\n    flexDirection: 'row',\n    gap: 8,\n    marginTop: 8,\n    flexWrap: 'wrap',\n  },\n  donutWrap: {\n    alignItems: 'center',\n    justifyContent: 'center',\n    marginTop: 8,\n    marginBottom: 8,\n  },\n  donutRow: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    paddingVertical: 6,\n    borderBottomWidth: 1,\n    borderBottomColor: '#e5e7eb',\n  },\n  donutValue: {\n    fontSize: 12,\n    color: '#0f172a',\n    fontWeight: '600',\n  },\n  legendItem: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 4,\n  },\n  legendDot: {\n    width: 8,\n    height: 8,\n    borderRadius: 999,\n  },\n  legendText: {\n    fontSize: 11,\n    color: '#475569',\n  },\n  rangeControlRow: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    marginTop: 10,\n  },\n  rangeControl: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 8,\n  },\n  rangeControlLabel: {\n    fontSize: 12,\n    color: '#64748b',\n  },\n  selectButton: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 10,\n    paddingHorizontal: 10,\n    paddingVertical: 6,\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 6,\n    backgroundColor: '#f8fafc',\n  },\n  selectButtonText: {\n    fontSize: 12,\n    color: '#334155',\n  },\n  selectWrap: {\n    position: 'relative',\n  },\n  selectWrapShrink: {\n    flex: 1,\n    minWidth: 0,\n  },\n  selectMenu: {\n    position: 'absolute',\n    top: 40,\n    left: 0,\n    right: 0,\n    backgroundColor: 'rgba(255,255,255,0.92)',\n    borderRadius: 16,\n    borderWidth: 1,\n    borderColor: 'rgba(226,232,240,0.8)',\n    paddingVertical: 8,\n    minWidth: 160,\n    paddingHorizontal: 4,\n    shadowColor: '#94a3b8',\n    shadowOpacity: 0.15,\n    shadowRadius: 8,\n    zIndex: 10,\n  },\n  selectMenuSmall: {\n    minWidth: 140,\n  },\n  selectMenuRight: {\n    left: 'auto',\n    right: 0,\n    minWidth: 180,\n  },\n  selectMenuItem: {\n    paddingHorizontal: 14,\n    paddingVertical: 12,\n    borderRadius: 12,\n  },\n  selectMenuText: {\n    fontSize: 13,\n    color: '#334155',\n  },\n  barRow: {\n    marginBottom: 12,\n  },\n  barLabelRow: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    marginBottom: 4,\n  },\n  barLabel: {\n    fontSize: 12,\n    color: '#111827',\n  },\n  barValue: {\n    fontSize: 12,\n    color: '#6b7280',\n  },\n  barTrack: {\n    height: 8,\n    borderRadius: 999,\n    backgroundColor: '#e5e7eb',\n    overflow: 'hidden',\n  },\n  barFill: {\n    height: 8,\n    borderRadius: 999,\n    backgroundColor: '#4f46e5',\n  },\n  inputGroup: {\n    marginBottom: 12,\n  },\n  row: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 8,\n  },\n  flex: {\n    flex: 1,\n  },\n  label: {\n    fontSize: 12,\n    color: '#6b7280',\n    marginBottom: 4,\n  },\n  toggleButton: {\n    paddingHorizontal: 10,\n    paddingVertical: 6,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 8,\n  },\n  toggleButtonText: {\n    fontSize: 12,\n    color: '#2563eb',\n  },\n  plusButton: {\n    width: 36,\n    height: 36,\n    borderRadius: 10,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#f8fafc',\n  },\n  input: {\n    borderWidth: 1,\n    borderColor: '#e5e7eb',\n    borderRadius: 8,\n    paddingHorizontal: 12,\n    paddingVertical: 8,\n    fontSize: 14,\n    backgroundColor: '#f8fafc',\n  },\n  noteInput: {\n    minHeight: 80,\n    textAlignVertical: 'top',\n  },\n  primaryButton: {\n    backgroundColor: '#2563eb',\n    paddingVertical: 12,\n    borderRadius: 8,\n    alignItems: 'center',\n  },\n  outlineButton: {\n    borderWidth: 1,\n    borderColor: '#cbd5f5',\n    paddingVertical: 10,\n    borderRadius: 8,\n    alignItems: 'center',\n    backgroundColor: '#f8fafc',\n  },\n  outlineButtonText: {\n    color: '#2563eb',\n    fontWeight: '600',\n    fontSize: 12,\n  },\n  primaryButtonText: {\n    color: '#ffffff',\n    fontWeight: '600',\n  },\n  deleteButton: {\n    alignItems: 'center',\n    justifyContent: 'center',\n    paddingHorizontal: 10,\n  },\n  bookPicker: {\n    gap: 8,\n  },\n  bookChip: {\n    paddingHorizontal: 12,\n    paddingVertical: 6,\n    borderRadius: 999,\n    borderWidth: 1,\n    borderColor: '#e5e7eb',\n  },\n  bookChipActive: {\n    backgroundColor: '#eef2ff',\n    borderColor: '#4f46e5',\n  },\n  bookChipText: {\n    fontSize: 12,\n  },\n  logItem: {\n    borderWidth: 1,\n    borderColor: '#e5e7eb',\n    borderRadius: 10,\n    padding: 12,\n    marginBottom: 10,\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    gap: 12,\n  },\n  logTitle: {\n    fontSize: 14,\n    fontWeight: '600',\n  },\n  mutedText: {\n    fontSize: 12,\n    color: '#6b7280',\n  },\n  noteText: {\n    fontSize: 12,\n    color: '#374151',\n    marginTop: 6,\n  },\n  deleteText: {\n    color: '#ef4444',\n    fontSize: 12,\n  },\n  noteRow: {\n    flexDirection: 'row',\n    alignItems: 'flex-start',\n    gap: 8,\n    marginBottom: 8,\n  },\n  goalItem: {\n    borderWidth: 1,\n    borderColor: '#e5e7eb',\n    borderRadius: 10,\n    padding: 10,\n    marginBottom: 8,\n    gap: 4,\n  },\n  goalText: {\n    fontSize: 12,\n    color: '#0f172a',\n  },\n  progressTrack: {\n    height: 8,\n    borderRadius: 999,\n    backgroundColor: '#e5e7eb',\n    overflow: 'hidden',\n    marginTop: 4,\n  },\n  progressFill: {\n    height: 8,\n    backgroundColor: '#3b82f6',\n  },\n  checkboxContainer: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    marginBottom: 16,\n    padding: 8,\n    borderRadius: 8,\n    backgroundColor: '#f8fafc',\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n  },\n  checkboxLabel: {\n    marginLeft: 8,\n    fontSize: 14,\n    color: '#334155',\n    fontWeight: '500',\n    flex: 1,\n  },\n  selectTrigger: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    borderWidth: 1,\n    borderColor: '#e5e7eb',\n    borderRadius: 8,\n    paddingHorizontal: 12,\n    paddingVertical: 12,\n    backgroundColor: '#ffffff',\n  },\n  selectTriggerText: {\n    fontSize: 14,\n    color: '#0f172a',\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n    justifyContent: 'flex-end',\n  },\n  modalContent: {\n    backgroundColor: '#ffffff',\n    borderTopLeftRadius: 20,\n    borderTopRightRadius: 20,\n    padding: 20,\n    maxHeight: '80%',\n  },\n  modalHeader: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    marginBottom: 16,\n  },\n  modalTitle: {\n    fontSize: 18,\n    fontWeight: '700',\n    color: '#0f172a',\n  },\n  modalItem: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    paddingVertical: 16,\n    borderBottomWidth: 1,\n    borderBottomColor: '#f1f5f9',\n  },\n  modalItemText: {\n    fontSize: 16,\n    color: '#334155',\n  },\n  modalItemTextSelected: {\n    color: '#2563eb',\n    fontWeight: '600',\n  },\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\LoginScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1197,1200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1197,1200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":60,"column":11,"nodeType":"JSXOpeningElement","endLine":60,"endColumn":67}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\nimport {\n  Alert,\n  Image,\n  KeyboardAvoidingView,\n  Platform,\n  Pressable,\n  ScrollView,\n  StyleSheet,\n  Text,\n  TextInput,\n  View,\n} from 'react-native'\nimport { supabase } from '../lib/supabase'\n\nexport function LoginScreen() {\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [mode, setMode] = useState<'signin' | 'signup'>('signin')\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const mascot = `${(process.env.EXPO_PUBLIC_API_BASE_URL || 'https://ai-yobikou.vercel.app').replace(/\\/$/, '')}/images/mascot.png`\n\n  const handleSubmit = async () => {\n    if (!email || !password) {\n      setError('メールアドレスとパスワードを入力してください。')\n      return\n    }\n\n    setLoading(true)\n    setError(null)\n    try {\n      if (mode === 'signin') {\n        const { error } = await supabase.auth.signInWithPassword({ email, password })\n        if (error) throw error\n      } else {\n        const { error } = await supabase.auth.signUp({ email, password })\n        if (error) throw error\n        Alert.alert('確認メール送信', 'メールを確認してサインインしてください。')\n      }\n    } catch (error: any) {\n      setError(error?.message ?? 'ログインに失敗しました。')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <KeyboardAvoidingView\n      style={styles.screen}\n      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\n      keyboardVerticalOffset={80}\n    >\n      <ScrollView\n        contentContainerStyle={styles.container}\n        keyboardShouldPersistTaps=\"handled\"\n      >\n        <View style={styles.mascotWrap}>\n          <Image source={{ uri: mascot }} style={styles.mascot} />\n        </View>\n        <View style={styles.card}>\n          <Text style={styles.cardTitle}>{mode === 'signin' ? 'ログイン' : '新規登録'}</Text>\n          <Text style={styles.cardSubtitle}>\n            {mode === 'signin' ? 'まなびAIへようこそ' : 'アカウントを作成して学習を始めましょう'}\n          </Text>\n          {error && <Text style={styles.errorText}>{error}</Text>}\n          <Text style={styles.label}>メールアドレス</Text>\n          <TextInput\n            style={styles.input}\n            placeholder=\"example@email.com\"\n            autoCapitalize=\"none\"\n            keyboardType=\"email-address\"\n            value={email}\n            onChangeText={setEmail}\n          />\n          <Text style={styles.label}>パスワード</Text>\n          <TextInput\n            style={styles.input}\n            placeholder=\"••••••••\"\n            secureTextEntry\n            value={password}\n            onChangeText={setPassword}\n          />\n          <Pressable style={styles.primaryButton} onPress={handleSubmit} disabled={loading}>\n            <Text style={styles.primaryButtonText}>\n              {loading ? '処理中...' : mode === 'signin' ? 'ログイン' : '新規登録'}\n            </Text>\n          </Pressable>\n          <Pressable\n            style={styles.linkButton}\n            onPress={() => {\n              setMode(mode === 'signin' ? 'signup' : 'signin')\n              setError(null)\n            }}\n            disabled={loading}\n          >\n            <Text style={styles.linkText}>\n              {mode === 'signin' ? '新規登録はこちら' : '既にアカウントをお持ちの方はこちら'}\n            </Text>\n          </Pressable>\n        </View>\n      </ScrollView>\n    </KeyboardAvoidingView>\n  )\n}\n\nconst styles = StyleSheet.create({\n  screen: {\n    flex: 1,\n  },\n  container: {\n    flexGrow: 1,\n    justifyContent: 'center',\n    padding: 24,\n    backgroundColor: '#eff6ff',\n  },\n  mascotWrap: {\n    alignItems: 'center',\n    marginBottom: 16,\n  },\n  mascot: {\n    width: 120,\n    height: 120,\n    resizeMode: 'contain',\n  },\n  card: {\n    backgroundColor: '#ffffff',\n    borderRadius: 16,\n    padding: 16,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n  },\n  cardTitle: {\n    fontSize: 20,\n    fontWeight: '700',\n    textAlign: 'center',\n  },\n  cardSubtitle: {\n    fontSize: 12,\n    color: '#64748b',\n    textAlign: 'center',\n    marginTop: 6,\n    marginBottom: 12,\n  },\n  label: {\n    fontSize: 12,\n    color: '#475569',\n    marginTop: 8,\n  },\n  input: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 10,\n    paddingHorizontal: 12,\n    paddingVertical: 10,\n    marginTop: 4,\n    fontSize: 14,\n  },\n  primaryButton: {\n    backgroundColor: '#2563eb',\n    paddingVertical: 12,\n    borderRadius: 10,\n    alignItems: 'center',\n    marginTop: 12,\n  },\n  primaryButtonText: {\n    color: '#ffffff',\n    fontSize: 16,\n    fontWeight: '600',\n  },\n  linkButton: {\n    marginTop: 16,\n    alignItems: 'center',\n  },\n  linkText: {\n    color: '#2563eb',\n    fontSize: 14,\n  },\n  errorText: {\n    backgroundColor: '#fee2e2',\n    color: '#b91c1c',\n    padding: 8,\n    borderRadius: 8,\n    fontSize: 12,\n    marginTop: 12,\n    marginBottom: 4,\n  },\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\OnboardingScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Alert' is defined but never used.","line":3,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Alert"},"fix":{"range":[51,57],"text":""},"desc":"Remove unused variable \"Alert\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1241,1244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1241,1244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":56,"column":11,"nodeType":"JSXOpeningElement","endLine":56,"endColumn":67}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\nimport {\n  Alert,\n  Image,\n  KeyboardAvoidingView,\n  Platform,\n  Pressable,\n  ScrollView,\n  StyleSheet,\n  Text,\n  TextInput,\n  View,\n} from 'react-native'\nimport { useProfile } from '../contexts/ProfileContext'\n\nexport function OnboardingScreen() {\n  const { createProfile } = useProfile()\n  const [schoolName, setSchoolName] = useState('')\n  const [currentDeviation, setCurrentDeviation] = useState('')\n  const [targetDeviation, setTargetDeviation] = useState('')\n  const [examDate, setExamDate] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const mascot = `${(process.env.EXPO_PUBLIC_API_BASE_URL || 'https://ai-yobikou.vercel.app').replace(/\\/$/, '')}/images/mascot.png`\n\n  const handleSubmit = async () => {\n    if (!schoolName || !currentDeviation || !targetDeviation) {\n      setError('志望校名と偏差値を入力してください。')\n      return\n    }\n\n    setLoading(true)\n    setError(null)\n    try {\n      await createProfile({\n        school_name: schoolName,\n        current_deviation: Number(currentDeviation),\n        target_deviation: Number(targetDeviation),\n        exam_date: examDate ? examDate : null,\n      })\n    } catch (error: any) {\n      setError(error?.message ?? 'オンボーディングに失敗しました。')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <KeyboardAvoidingView\n      style={styles.screen}\n      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\n      keyboardVerticalOffset={80}\n    >\n      <ScrollView contentContainerStyle={styles.container} keyboardShouldPersistTaps=\"handled\">\n        <View style={styles.mascotWrap}>\n          <Image source={{ uri: mascot }} style={styles.mascot} />\n        </View>\n        <View style={styles.card}>\n          <Text style={styles.cardTitle}>初回設定</Text>\n          <Text style={styles.cardSubtitle}>志望校、現在の偏差値、試験日を入力してください</Text>\n          {error && <Text style={styles.errorText}>{error}</Text>}\n          <Text style={styles.label}>志望校名</Text>\n          <TextInput\n            style={styles.input}\n            placeholder=\"例: 東京大学\"\n            value={schoolName}\n            onChangeText={setSchoolName}\n          />\n          <Text style={styles.label}>現在の偏差値</Text>\n          <TextInput\n            style={styles.input}\n            placeholder=\"50\"\n            keyboardType=\"numeric\"\n            value={currentDeviation}\n            onChangeText={(value) => {\n              setCurrentDeviation(value)\n              setTargetDeviation(value)\n            }}\n          />\n          <Text style={styles.label}>目標偏差値</Text>\n          <TextInput\n            style={styles.input}\n            placeholder=\"50\"\n            keyboardType=\"numeric\"\n            value={targetDeviation}\n            onChangeText={setTargetDeviation}\n          />\n          <Text style={styles.helperText}>初期値は現在の偏差値と同じ値に設定されます</Text>\n          <Text style={styles.label}>試験日（任意）</Text>\n          <TextInput\n            style={styles.input}\n            placeholder=\"YYYY-MM-DD\"\n            value={examDate}\n            onChangeText={setExamDate}\n          />\n          <Text style={styles.helperText}>後から設定で変更できます</Text>\n          <Pressable style={styles.primaryButton} onPress={handleSubmit} disabled={loading}>\n            <Text style={styles.primaryButtonText}>{loading ? '処理中...' : '設定を完了する'}</Text>\n          </Pressable>\n        </View>\n      </ScrollView>\n    </KeyboardAvoidingView>\n  )\n}\n\nconst styles = StyleSheet.create({\n  screen: {\n    flex: 1,\n  },\n  container: {\n    flexGrow: 1,\n    padding: 24,\n    backgroundColor: '#eff6ff',\n    justifyContent: 'center',\n  },\n  mascotWrap: {\n    alignItems: 'center',\n    marginBottom: 12,\n  },\n  mascot: {\n    width: 120,\n    height: 120,\n    resizeMode: 'contain',\n  },\n  card: {\n    backgroundColor: '#ffffff',\n    borderRadius: 16,\n    padding: 16,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n  },\n  cardTitle: {\n    fontSize: 20,\n    fontWeight: '700',\n    textAlign: 'center',\n  },\n  cardSubtitle: {\n    fontSize: 12,\n    color: '#64748b',\n    textAlign: 'center',\n    marginTop: 6,\n    marginBottom: 12,\n  },\n  label: {\n    fontSize: 12,\n    color: '#475569',\n    marginTop: 8,\n  },\n  input: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 10,\n    paddingHorizontal: 12,\n    paddingVertical: 10,\n    marginTop: 4,\n    fontSize: 14,\n  },\n  helperText: {\n    fontSize: 11,\n    color: '#64748b',\n    marginTop: 4,\n  },\n  primaryButton: {\n    backgroundColor: '#2563eb',\n    paddingVertical: 12,\n    borderRadius: 10,\n    alignItems: 'center',\n    marginTop: 12,\n  },\n  primaryButtonText: {\n    color: '#ffffff',\n    fontSize: 16,\n    fontWeight: '600',\n  },\n  errorText: {\n    backgroundColor: '#fee2e2',\n    color: '#b91c1c',\n    padding: 8,\n    borderRadius: 8,\n    fontSize: 12,\n    marginBottom: 6,\n  },\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\QAScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5565,5568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5565,5568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":247,"column":15,"nodeType":"JSXOpeningElement","endLine":247,"endColumn":76},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":256,"column":29,"nodeType":"JSXOpeningElement","endLine":256,"endColumn":85},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":258,"column":40,"nodeType":"JSXOpeningElement","endLine":258,"endColumn":112},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":268,"column":23,"nodeType":"JSXOpeningElement","endLine":268,"endColumn":86},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":282,"column":15,"nodeType":"JSXOpeningElement","endLine":282,"endColumn":77}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useRef, useState } from 'react'\nimport {\n  Alert,\n  Image,\n  KeyboardAvoidingView,\n  Platform,\n  Pressable,\n  ScrollView,\n  StyleSheet,\n  Text,\n  TextInput,\n  View,\n} from 'react-native'\nimport * as ImagePicker from 'expo-image-picker'\nimport AsyncStorage from '@react-native-async-storage/async-storage'\nimport Markdown from 'react-native-markdown-display'\nimport { Ionicons } from '@expo/vector-icons'\nimport { supabase } from '../lib/supabase'\n\ntype Message = {\n  id: string\n  role: 'user' | 'assistant'\n  content: string\n  imageUrl?: string\n}\n\ntype ChatSession = {\n  id: string\n  title: string\n  messages: Message[]\n  updatedAt: number\n}\n\nconst STORAGE_KEY = 'qa_chat_sessions'\nconst ACTIVE_KEY = 'qa_active_chat_id'\nconst STORAGE_MAX_MESSAGES = 50\n\nexport function QAScreen() {\n  const [sessions, setSessions] = useState<ChatSession[]>([])\n  const [activeChatId, setActiveChatId] = useState<string | null>(null)\n  const [messages, setMessages] = useState<Message[]>([])\n  const [input, setInput] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [selectedImage, setSelectedImage] = useState<string | null>(null)\n  const [userAvatarUrl, setUserAvatarUrl] = useState<string | null>(null)\n  const scrollRef = useRef<ScrollView | null>(null)\n\n  const endpoint = useMemo(() => {\n    const direct = process.env.EXPO_PUBLIC_QA_ENDPOINT\n    const base = process.env.EXPO_PUBLIC_API_BASE_URL\n    if (direct) return direct\n    if (base) return `${base.replace(/\\/$/, '')}/api/qa`\n    return ''\n  }, [])\n\n  const mascot = `${(process.env.EXPO_PUBLIC_API_BASE_URL || 'https://ai-yobikou.vercel.app').replace(/\\/$/, '')}/images/mascot.png`\n\n  useEffect(() => {\n    const load = async () => {\n      const stored = await AsyncStorage.getItem(STORAGE_KEY)\n      const active = await AsyncStorage.getItem(ACTIVE_KEY)\n      if (stored) {\n        const parsed = JSON.parse(stored) as ChatSession[]\n        setSessions(parsed)\n        const activeId = active || parsed[0]?.id || null\n        setActiveChatId(activeId)\n        const activeSession = parsed.find((s) => s.id === activeId) || parsed[0]\n        setMessages(activeSession?.messages || [])\n      } else {\n        const initial: ChatSession = {\n          id: Date.now().toString(),\n          title: 'チャット 1',\n          messages: [],\n          updatedAt: Date.now(),\n        }\n        setSessions([initial])\n        setActiveChatId(initial.id)\n      }\n    }\n    load()\n  }, [])\n\n  useEffect(() => {\n    const save = async () => {\n      if (!activeChatId) return\n      const trimmed = messages.slice(-STORAGE_MAX_MESSAGES)\n      setSessions((prev) =>\n        prev.map((s) => (s.id === activeChatId ? { ...s, messages: trimmed, updatedAt: Date.now() } : s))\n      )\n    }\n    save()\n  }, [messages, activeChatId])\n\n  useEffect(() => {\n    if (sessions.length === 0) return\n    AsyncStorage.setItem(STORAGE_KEY, JSON.stringify(sessions))\n    if (activeChatId) {\n      AsyncStorage.setItem(ACTIVE_KEY, activeChatId)\n    }\n  }, [sessions, activeChatId])\n\n  useEffect(() => {\n    const loadAvatar = async () => {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n      if (!user) return\n      const { data } = await supabase.from('profiles').select('avatar_url').eq('user_id', user.id).single()\n      if (data?.avatar_url) setUserAvatarUrl(data.avatar_url)\n    }\n    loadAvatar()\n  }, [])\n\n  const pickImage = async (useCamera = false) => {\n    if (useCamera) {\n      const permission = await ImagePicker.requestCameraPermissionsAsync()\n      if (permission.status !== 'granted') {\n        Alert.alert('権限が必要です', 'カメラへのアクセスを許可してください。')\n        return\n      }\n    } else {\n      const permission = await ImagePicker.requestMediaLibraryPermissionsAsync()\n      if (permission.status !== 'granted') {\n        Alert.alert('権限が必要です', '写真へのアクセスを許可してください。')\n        return\n      }\n    }\n    const result = useCamera\n      ? await ImagePicker.launchCameraAsync({ base64: true, quality: 0.8 })\n      : await ImagePicker.launchImageLibraryAsync({ base64: true, quality: 0.8 })\n    if (!result.canceled && result.assets[0]?.base64) {\n      const asset = result.assets[0]\n      const dataUrl = `data:${asset.mimeType || 'image/jpeg'};base64,${asset.base64}`\n      setSelectedImage(dataUrl)\n    }\n  }\n\n  const handleSend = async () => {\n    if (loading) return\n    if (!input.trim() && !selectedImage) return\n    if (!endpoint) {\n      Alert.alert('設定が必要です', 'QAエンドポイントを環境変数に設定してください。')\n      return\n    }\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: input.trim(),\n      imageUrl: selectedImage || undefined,\n    }\n    setMessages((prev) => [...prev, userMessage])\n    setInput('')\n    setSelectedImage(null)\n    setLoading(true)\n\n    try {\n      const history = messages.map((m) => ({\n        role: m.role,\n        content: m.content,\n        imageUrl: m.imageUrl,\n      }))\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          message: userMessage.content,\n          image: userMessage.imageUrl,\n          history,\n        }),\n      })\n      if (!response.ok) throw new Error('AIの応答に失敗しました')\n      const data = await response.json()\n      const assistantMessage: Message = {\n        id: (Date.now() + 1).toString(),\n        role: 'assistant',\n        content: data.response || '回答が取得できませんでした。',\n      }\n      setMessages((prev) => [...prev, assistantMessage])\n    } catch (error: any) {\n      Alert.alert('エラー', error?.message || '通信に失敗しました。')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleCreateChat = () => {\n    const nextIndex = sessions.length + 1\n    const newSession: ChatSession = {\n      id: Date.now().toString(),\n      title: `チャット ${nextIndex}`,\n      messages: [],\n      updatedAt: Date.now(),\n    }\n    setSessions((prev) => [newSession, ...prev])\n    setActiveChatId(newSession.id)\n    setMessages([])\n  }\n\n  const handleDeleteChat = () => {\n    if (!activeChatId) return\n    Alert.alert('確認', 'このチャットを削除しますか？', [\n      { text: 'キャンセル', style: 'cancel' },\n      {\n        text: '削除',\n        style: 'destructive',\n        onPress: () => {\n          const remaining = sessions.filter((s) => s.id !== activeChatId)\n          const next = remaining[0]\n          setSessions(remaining.length ? remaining : [])\n          setActiveChatId(next?.id ?? null)\n          setMessages(next?.messages ?? [])\n        },\n      },\n    ])\n  }\n\n  useEffect(() => {\n    setTimeout(() => scrollRef.current?.scrollToEnd({ animated: true }), 150)\n  }, [messages])\n\n  return (\n    <KeyboardAvoidingView\n      style={styles.screen}\n      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\n      keyboardVerticalOffset={80}\n    >\n      <View style={styles.container}>\n        <View style={styles.header}>\n          <Text style={styles.headerTitle}>Q&A</Text>\n          <View style={styles.headerActions}>\n            <Pressable style={styles.headerIcon} onPress={handleCreateChat}>\n              <Ionicons name=\"create-outline\" size={18} color=\"#334155\" />\n            </Pressable>\n            <Pressable style={styles.headerIcon} onPress={handleDeleteChat}>\n              <Ionicons name=\"trash-outline\" size={18} color=\"#334155\" />\n            </Pressable>\n          </View>\n        </View>\n\n        <ScrollView\n          ref={scrollRef}\n          contentContainerStyle={styles.messageList}\n          keyboardShouldPersistTaps=\"handled\"\n        >\n          {messages.length === 0 && (\n            <View style={styles.emptyState}>\n              <Image source={{ uri: mascot }} style={styles.emptyMascot} />\n              <Text style={styles.emptyTitle}>こんにちは。何でも聞いてください</Text>\n              <Text style={styles.mutedText}>テキスト・画像どちらでもOKです</Text>\n            </View>\n          )}\n          {messages.map((message) => {\n            const isUser = message.role === 'user'\n            return (\n              <View key={message.id} style={[styles.messageRow, isUser && styles.messageRowUser]}>\n                {!isUser && <Image source={{ uri: mascot }} style={styles.avatar} />}\n                <View style={[styles.messageBubble, isUser ? styles.userBubble : styles.aiBubble]}>\n                  {message.imageUrl && <Image source={{ uri: message.imageUrl }} style={styles.imagePreview} />}\n                  {isUser ? (\n                    <Text style={styles.userText}>{message.content}</Text>\n                  ) : (\n                    <Markdown style={markdownStyles}>{message.content}</Markdown>\n                  )}\n                </View>\n                {isUser && (\n                  <View style={styles.avatarCircle}>\n                    {userAvatarUrl ? (\n                      <Image source={{ uri: userAvatarUrl }} style={styles.avatar} />\n                    ) : (\n                      <Text style={styles.avatarPlaceholder}>U</Text>\n                    )}\n                  </View>\n                )}\n              </View>\n            )\n          })}\n        </ScrollView>\n\n        <View style={styles.inputBar}>\n          {selectedImage && (\n            <View style={styles.previewRow}>\n              <Image source={{ uri: selectedImage }} style={styles.thumb} />\n              <Pressable style={styles.removePreview} onPress={() => setSelectedImage(null)}>\n                <Ionicons name=\"close\" size={16} color=\"#334155\" />\n              </Pressable>\n            </View>\n          )}\n          <View style={styles.inputRow}>\n            <Pressable style={styles.iconButton} onPress={() => pickImage(false)}>\n              <Ionicons name=\"image-outline\" size={18} color=\"#334155\" />\n            </Pressable>\n            <Pressable style={styles.iconButton} onPress={() => pickImage(true)}>\n              <Ionicons name=\"camera-outline\" size={18} color=\"#334155\" />\n            </Pressable>\n            <TextInput\n              style={styles.textInput}\n              placeholder=\"メッセージを入力...\"\n              multiline\n              value={input}\n              onChangeText={setInput}\n            />\n            <Pressable\n              style={[styles.sendButton, (!input.trim() && !selectedImage) && styles.sendButtonDisabled]}\n              onPress={handleSend}\n              disabled={loading || (!input.trim() && !selectedImage)}\n            >\n              <Ionicons name=\"paper-plane\" size={18} color=\"#ffffff\" />\n            </Pressable>\n          </View>\n        </View>\n      </View>\n    </KeyboardAvoidingView>\n  )\n}\n\nconst styles = StyleSheet.create({\n  screen: {\n    flex: 1,\n  },\n  container: {\n    flex: 1,\n    paddingTop: 12,\n    backgroundColor: '#f7f7f8',\n  },\n  header: {\n    paddingHorizontal: 16,\n    paddingBottom: 8,\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  headerTitle: {\n    fontSize: 18,\n    fontWeight: '700',\n    color: '#0f172a',\n  },\n  headerActions: {\n    flexDirection: 'row',\n    gap: 8,\n  },\n  headerIcon: {\n    width: 32,\n    height: 32,\n    borderRadius: 8,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#ffffff',\n  },\n  messageList: {\n    paddingHorizontal: 16,\n    paddingBottom: 120,\n  },\n  emptyState: {\n    alignItems: 'center',\n    paddingVertical: 40,\n  },\n  emptyMascot: {\n    width: 80,\n    height: 80,\n    marginBottom: 8,\n  },\n  emptyTitle: {\n    fontSize: 14,\n    fontWeight: '600',\n    color: '#0f172a',\n    marginBottom: 4,\n  },\n  mutedText: {\n    fontSize: 12,\n    color: '#64748b',\n  },\n  messageRow: {\n    flexDirection: 'row',\n    alignItems: 'flex-end',\n    gap: 8,\n    marginBottom: 12,\n  },\n  messageRowUser: {\n    justifyContent: 'flex-end',\n  },\n  messageBubble: {\n    maxWidth: '78%',\n    borderRadius: 16,\n    padding: 12,\n  },\n  aiBubble: {\n    backgroundColor: '#ffffff',\n    borderWidth: 1,\n    borderColor: '#e5e7eb',\n  },\n  userBubble: {\n    backgroundColor: '#e2e8f0',\n  },\n  userText: {\n    color: '#0f172a',\n    fontSize: 14,\n  },\n  avatar: {\n    width: 28,\n    height: 28,\n    borderRadius: 14,\n  },\n  avatarCircle: {\n    width: 28,\n    height: 28,\n    borderRadius: 14,\n    backgroundColor: '#e2e8f0',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  avatarPlaceholder: {\n    fontSize: 10,\n    color: '#64748b',\n  },\n  imagePreview: {\n    width: 160,\n    height: 120,\n    borderRadius: 10,\n    marginBottom: 8,\n  },\n  inputRow: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 8,\n  },\n  inputBar: {\n    borderTopWidth: 1,\n    borderTopColor: '#e2e8f0',\n    backgroundColor: '#ffffff',\n    paddingHorizontal: 12,\n    paddingTop: 8,\n    paddingBottom: 16,\n  },\n  iconButton: {\n    width: 36,\n    height: 36,\n    borderRadius: 10,\n    borderWidth: 1,\n    borderColor: '#cbd5f5',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#f1f5f9',\n  },\n  textInput: {\n    flex: 1,\n    minHeight: 40,\n    maxHeight: 120,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 18,\n    paddingHorizontal: 12,\n    paddingVertical: 8,\n    fontSize: 14,\n    backgroundColor: '#f8fafc',\n    textAlignVertical: 'top',\n  },\n  previewRow: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 8,\n    marginBottom: 8,\n  },\n  thumb: {\n    width: 44,\n    height: 44,\n    borderRadius: 10,\n  },\n  removePreview: {\n    width: 28,\n    height: 28,\n    borderRadius: 8,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#f8fafc',\n  },\n  sendButton: {\n    width: 42,\n    height: 42,\n    borderRadius: 999,\n    backgroundColor: '#4b8bff',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  sendButtonDisabled: {\n    opacity: 0.5,\n  },\n})\n\nconst markdownStyles = {\n  body: { color: '#0f172a', fontSize: 14 },\n  heading2: { fontSize: 16, fontWeight: '700', marginTop: 8 },\n  paragraph: { marginTop: 6 },\n  list_item: { marginVertical: 4 },\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\SettingsScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1261,1264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1261,1264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2548,2551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2548,2551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":101,"column":17,"nodeType":"JSXOpeningElement","endLine":101,"endColumn":81}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react'\nimport {\n  Alert,\n  Image,\n  KeyboardAvoidingView,\n  Platform,\n  Pressable,\n  ScrollView,\n  StyleSheet,\n  Text,\n  TextInput,\n  View,\n} from 'react-native'\nimport * as ImagePicker from 'expo-image-picker'\nimport { useProfile } from '../contexts/ProfileContext'\nimport { supabase } from '../lib/supabase'\n\nexport function SettingsScreen() {\n  const { profile, updateProfile, userId } = useProfile()\n  const [weekdayTarget, setWeekdayTarget] = useState('60')\n  const [weekendTarget, setWeekendTarget] = useState('120')\n  const [avatarUrl, setAvatarUrl] = useState<string | null>(null)\n  const [loading, setLoading] = useState(false)\n  const [isUploading, setIsUploading] = useState(false)\n\n  useEffect(() => {\n    if (profile) {\n      setWeekdayTarget(String(profile.weekday_target_minutes ?? 60))\n      setWeekendTarget(String(profile.weekend_target_minutes ?? 120))\n      setAvatarUrl(profile.avatar_url ?? null)\n    }\n  }, [profile])\n\n  const handleUpdate = async () => {\n    setLoading(true)\n    try {\n      await updateProfile({\n        weekday_target_minutes: Number(weekdayTarget),\n        weekend_target_minutes: Number(weekendTarget),\n      })\n      Alert.alert('更新完了', '設定を更新しました。')\n    } catch (error: any) {\n      Alert.alert('更新エラー', error?.message ?? '更新に失敗しました。')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handlePickAvatar = async () => {\n    const permission = await ImagePicker.requestMediaLibraryPermissionsAsync()\n    if (permission.status !== 'granted') {\n      Alert.alert('権限が必要です', '写真へのアクセスを許可してください。')\n      return\n    }\n    const result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\n      quality: 0.8,\n    })\n    if (result.canceled || !result.assets[0]) return\n    const asset = result.assets[0]\n    setIsUploading(true)\n    try {\n      const response = await fetch(asset.uri)\n      const blob = await response.blob()\n      const fileExt = asset.uri.split('.').pop() || 'jpg'\n      const filePath = `${userId}/${Date.now()}.${fileExt}`\n      const { error: uploadError } = await supabase.storage.from('avatars').upload(filePath, blob, {\n        cacheControl: '3600',\n        upsert: true,\n      })\n      if (uploadError) throw uploadError\n      const { data } = supabase.storage.from('avatars').getPublicUrl(filePath)\n      const publicUrl = data.publicUrl\n      await updateProfile({ avatar_url: publicUrl })\n      setAvatarUrl(publicUrl)\n      Alert.alert('更新完了', 'アイコンを更新しました。')\n    } catch (err: any) {\n      Alert.alert('アップロード失敗', err.message || '画像のアップロードに失敗しました。')\n    } finally {\n      setIsUploading(false)\n    }\n  }\n\n  const handleLogout = async () => {\n    await supabase.auth.signOut()\n  }\n\n  return (\n    <KeyboardAvoidingView\n      style={styles.screen}\n      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\n      keyboardVerticalOffset={80}\n    >\n      <ScrollView contentContainerStyle={styles.container} keyboardShouldPersistTaps=\"handled\">\n        <View style={styles.card}>\n          <Text style={styles.cardTitle}>設定</Text>\n          <Text style={styles.cardSubtitle}>学習目標を更新できます</Text>\n          <View style={styles.avatarRow}>\n            <View style={styles.avatarCircle}>\n              {avatarUrl ? (\n                <Image source={{ uri: avatarUrl }} style={styles.avatarImage} />\n              ) : (\n                <Text style={styles.avatarPlaceholder}>?</Text>\n              )}\n            </View>\n            <Pressable style={styles.outlineButton} onPress={handlePickAvatar} disabled={isUploading}>\n              <Text style={styles.outlineButtonText}>{isUploading ? 'アップロード中...' : 'アイコンを変更'}</Text>\n            </Pressable>\n          </View>\n          <Text style={styles.helperText}>正方形の画像がきれいに表示されます</Text>\n          <Text style={styles.label}>平日の目標学習時間（分）</Text>\n          <TextInput\n            style={styles.input}\n            keyboardType=\"numeric\"\n            value={weekdayTarget}\n            onChangeText={setWeekdayTarget}\n          />\n          <Text style={styles.label}>土日祝の目標学習時間（分）</Text>\n          <TextInput\n            style={styles.input}\n            keyboardType=\"numeric\"\n            value={weekendTarget}\n            onChangeText={setWeekendTarget}\n          />\n          <Pressable style={styles.primaryButton} onPress={handleUpdate} disabled={loading}>\n            <Text style={styles.primaryButtonText}>{loading ? '更新中...' : '設定を更新'}</Text>\n          </Pressable>\n          <Pressable style={styles.logoutButton} onPress={handleLogout}>\n            <Text style={styles.logoutText}>ログアウト</Text>\n          </Pressable>\n        </View>\n      </ScrollView>\n    </KeyboardAvoidingView>\n  )\n}\n\nconst styles = StyleSheet.create({\n  screen: {\n    flex: 1,\n  },\n  container: {\n    flexGrow: 1,\n    padding: 16,\n    backgroundColor: '#f1f5fb',\n    gap: 12,\n  },\n  card: {\n    backgroundColor: '#ffffff',\n    borderRadius: 16,\n    padding: 16,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    gap: 10,\n  },\n  cardTitle: {\n    fontSize: 18,\n    fontWeight: '700',\n  },\n  cardSubtitle: {\n    fontSize: 12,\n    color: '#94a3b8',\n  },\n  avatarRow: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 16,\n  },\n  avatarCircle: {\n    width: 64,\n    height: 64,\n    borderRadius: 32,\n    backgroundColor: '#e2e8f0',\n    alignItems: 'center',\n    justifyContent: 'center',\n    overflow: 'hidden',\n  },\n  avatarImage: {\n    width: 64,\n    height: 64,\n    resizeMode: 'cover',\n  },\n  avatarPlaceholder: {\n    color: '#94a3b8',\n    fontSize: 22,\n    fontWeight: '600',\n  },\n  outlineButton: {\n    borderWidth: 1,\n    borderColor: '#cbd5f5',\n    paddingVertical: 8,\n    paddingHorizontal: 12,\n    borderRadius: 10,\n    backgroundColor: '#f8fafc',\n  },\n  outlineButtonText: {\n    color: '#334155',\n    fontSize: 12,\n    fontWeight: '600',\n  },\n  helperText: {\n    marginTop: 8,\n    fontSize: 11,\n    color: '#64748b',\n  },\n  label: {\n    fontSize: 12,\n    color: '#475569',\n    marginTop: 8,\n  },\n  input: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 10,\n    paddingHorizontal: 12,\n    paddingVertical: 8,\n    fontSize: 14,\n    marginTop: 4,\n    backgroundColor: '#f8fafc',\n  },\n  primaryButton: {\n    backgroundColor: '#0b79bf',\n    paddingVertical: 12,\n    borderRadius: 12,\n    alignItems: 'center',\n    marginTop: 12,\n  },\n  primaryButtonText: {\n    color: '#ffffff',\n    fontSize: 13,\n    fontWeight: '600',\n  },\n  logoutButton: {\n    alignItems: 'center',\n    paddingVertical: 12,\n    backgroundColor: '#e11d48',\n    borderRadius: 12,\n    marginTop: 8,\n  },\n  logoutText: {\n    color: '#ffffff',\n    fontWeight: '600',\n  },\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\screens\\StudyScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3471,3474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3471,3474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":135,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":135,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":374,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":374,"endColumn":20},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":528,"column":27,"nodeType":"JSXOpeningElement","endLine":528,"endColumn":94}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useRef, useState } from 'react'\nimport {\n  Alert,\n  Image,\n  KeyboardAvoidingView,\n  Platform,\n  Pressable,\n  ScrollView,\n  StyleSheet,\n  Text,\n  TextInput,\n  View,\n} from 'react-native'\nimport { Ionicons } from '@expo/vector-icons'\nimport * as ImagePicker from 'expo-image-picker'\nimport { supabase } from '../lib/supabase'\nimport { useProfile } from '../contexts/ProfileContext'\nimport type { ReferenceBook, ReviewTask } from '../types'\nimport { formatTimer } from '../lib/format'\nimport { formatDateLabel, getStudyDay, getStudyDayDate } from '../lib/date'\n\nconst REVIEW_DAYS = [1, 3, 7, 14, 30, 60, 120, 240, 365, 730]\nconst DEFAULT_DIFFICULTY = 'normal'\n\ntype Difficulty = 'easy' | 'normal' | 'hard'\n\ntype QuizQuestion = {\n  question: string\n  choices: string[]\n  correct_index: number\n  explanation?: string\n  theme?: string\n}\n\ntype ThemeQuizState = {\n  loading: boolean\n  questions: QuizQuestion[]\n  answers: Record<number, number>\n}\n\ntype QuizState = {\n  themes: Record<string, ThemeQuizState>\n}\n\nexport function StudyScreen() {\n  const { userId } = useProfile()\n  const [referenceBooks, setReferenceBooks] = useState<ReferenceBook[]>([])\n  const [selectedBookId, setSelectedBookId] = useState<string | null>(null)\n  const [newBookName, setNewBookName] = useState('')\n  const [notes, setNotes] = useState<string[]>([''])\n  const [isRunning, setIsRunning] = useState(false)\n  const [seconds, setSeconds] = useState(0)\n  const [loading, setLoading] = useState(true)\n  const [successMessage, setSuccessMessage] = useState<string | null>(null)\n  const [reviewTasks, setReviewTasks] = useState<ReviewTask[]>([])\n  const [quizByTask, setQuizByTask] = useState<Record<string, QuizState>>({})\n  const [skippedThemes, setSkippedThemes] = useState<Record<string, string[]>>({})\n  const [difficultyByTheme, setDifficultyByTheme] = useState<Record<string, Difficulty>>({})\n  const [showBookPicker, setShowBookPicker] = useState(false)\n  const [showAddBookForm, setShowAddBookForm] = useState(false)\n  const [newBookImage, setNewBookImage] = useState<string | null>(null)\n  const intervalRef = useRef<ReturnType<typeof setInterval> | null>(null)\n  const endpoint = useMemo(() => {\n    const direct = process.env.EXPO_PUBLIC_QA_ENDPOINT\n    const base = process.env.EXPO_PUBLIC_API_BASE_URL\n    if (direct) return direct.replace(/\\/api\\/qa$/, '') + '/api/quiz'\n    if (base) return `${base.replace(/\\/$/, '')}/api/quiz`\n    return ''\n  }, [])\n\n  const selectedBook = useMemo(\n    () => referenceBooks.find((book) => book.id === selectedBookId) || null,\n    [referenceBooks, selectedBookId]\n  )\n\n  useEffect(() => {\n    const loadBooks = async () => {\n      setLoading(true)\n      const [booksResult, tasksResult] = await Promise.all([\n        supabase\n          .from('reference_books')\n          .select('*')\n          .eq('user_id', userId)\n          .is('deleted_at', null)\n          .order('created_at', { ascending: false }),\n        supabase\n          .from('review_tasks')\n          .select('id, due_at, status, study_log_id, study_logs(note, subject, started_at)')\n          .eq('user_id', userId)\n          .eq('status', 'pending')\n          .lte('due_at', new Date().toISOString())\n          .order('due_at', { ascending: true }),\n      ])\n      if (!booksResult.error) {\n        setReferenceBooks((booksResult.data || []) as ReferenceBook[])\n      }\n      if (!tasksResult.error) {\n        const normalized = ((tasksResult.data as any[]) || []).map((task) => ({\n          ...task,\n          study_logs: Array.isArray(task.study_logs) ? task.study_logs[0] ?? null : task.study_logs ?? null,\n        }))\n        setReviewTasks(normalized as ReviewTask[])\n      }\n      setLoading(false)\n    }\n    loadBooks()\n  }, [userId])\n\n  useEffect(() => {\n    if (isRunning) {\n      intervalRef.current = setInterval(() => {\n        setSeconds((prev) => prev + 1)\n      }, 1000)\n    }\n    return () => {\n      if (intervalRef.current) clearInterval(intervalRef.current)\n    }\n  }, [isRunning])\n\n  const handleAddBook = async () => {\n    if (!newBookName.trim()) return\n    let imageUrl: string | null = null\n    if (newBookImage) {\n      try {\n        const response = await fetch(newBookImage)\n        const blob = await response.blob()\n        const filePath = `${userId}/${Date.now()}.jpg`\n        const { error: uploadError } = await supabase.storage\n          .from('reference-books')\n          .upload(filePath, blob, { cacheControl: '3600', upsert: false })\n        if (!uploadError) {\n          const { data } = supabase.storage.from('reference-books').getPublicUrl(filePath)\n          imageUrl = data.publicUrl\n        }\n      } catch (_error) {\n        Alert.alert('画像のアップロードに失敗しました', '画像なしで教材を追加します。')\n      }\n    }\n\n    const { data: deletedBook } = await supabase\n      .from('reference_books')\n      .select('*')\n      .eq('user_id', userId)\n      .eq('name', newBookName.trim())\n      .not('deleted_at', 'is', null)\n      .order('deleted_at', { ascending: false })\n      .limit(1)\n      .maybeSingle()\n\n    if (deletedBook) {\n      const { error } = await supabase\n        .from('reference_books')\n        .update({\n          deleted_at: null,\n          image_url: imageUrl || deletedBook.image_url,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('id', deletedBook.id)\n      if (error) {\n        Alert.alert('保存エラー', error.message)\n        return\n      }\n      const restored = {\n        ...(deletedBook as ReferenceBook),\n        deleted_at: null,\n        image_url: imageUrl || deletedBook.image_url,\n      }\n      setReferenceBooks((prev) => [restored, ...prev])\n    } else {\n      const { error, data } = await supabase\n        .from('reference_books')\n        .insert({\n          user_id: userId,\n          name: newBookName.trim(),\n          image_url: imageUrl,\n          type: 'book',\n        })\n        .select()\n        .single()\n      if (error) {\n        Alert.alert('保存エラー', error.message)\n        return\n      }\n      setReferenceBooks((prev) => [data as ReferenceBook, ...prev])\n    }\n    setNewBookName('')\n    setNewBookImage(null)\n    setShowAddBookForm(false)\n  }\n\n  const handleDeleteBook = async (bookId: string) => {\n    const { error } = await supabase\n      .from('reference_books')\n      .update({ deleted_at: new Date().toISOString() })\n      .eq('id', bookId)\n    if (error) {\n      Alert.alert('削除エラー', error.message)\n      return\n    }\n    setReferenceBooks((prev) => prev.filter((book) => book.id !== bookId))\n    if (selectedBookId === bookId) setSelectedBookId(null)\n  }\n\n  const handleStart = () => {\n    if (!selectedBookId) {\n      Alert.alert('教材を選択してください')\n      return\n    }\n    setIsRunning(true)\n  }\n\n  const handlePause = () => {\n    setIsRunning(false)\n  }\n\n  const handleStop = async () => {\n    setIsRunning(false)\n    if (seconds < 60) {\n      setSeconds(0)\n      Alert.alert('1分以上の学習時間を記録してください')\n      return\n    }\n    if (!selectedBookId) {\n      Alert.alert('教材を選択してください')\n      setSeconds(0)\n      return\n    }\n    const minutes = Math.floor(seconds / 60)\n    const subject = selectedBook?.name?.trim() || 'その他'\n    const startedAt = new Date().toISOString()\n    const noteValue = notes\n      .map((value) => value.trim())\n      .filter(Boolean)\n      .map((value) => `・${value}`)\n      .join('\\n')\n    const { data, error } = await supabase\n      .from('study_logs')\n      .insert({\n        user_id: userId,\n        subject,\n        reference_book_id: selectedBook?.id || null,\n        study_minutes: minutes,\n        started_at: startedAt,\n        note: noteValue ? noteValue : null,\n      })\n      .select()\n      .single()\n    if (error) {\n      Alert.alert('保存エラー', error.message)\n      return\n    }\n    if (noteValue && data?.id) {\n      const base = new Date(startedAt)\n      base.setHours(12, 0, 0, 0)\n      const tasks = REVIEW_DAYS.map((days) => {\n        const due = new Date(base)\n        due.setDate(due.getDate() + days)\n        return {\n          user_id: userId,\n          study_log_id: data.id,\n          due_at: due.toISOString(),\n          status: 'pending',\n        }\n      })\n      await supabase.from('review_tasks').insert(tasks)\n    }\n    const messages = [\n      `🎉 ${subject}を${minutes}分学習したね！素晴らしい！`,\n      `✨ ${minutes}分の学習、お疲れ様！合格に一歩近づいたよ！`,\n      `💪 ${subject}を${minutes}分頑張ったね！この調子で続けよう！`,\n      `🔥 ${minutes}分の学習を記録したよ！連続記録を更新しよう！`,\n    ]\n    setSuccessMessage(messages[Math.floor(Math.random() * messages.length)])\n    setSeconds(0)\n    setNotes([''])\n  }\n\n  const getEncouragementMessage = () => {\n    const minutes = Math.floor(seconds / 60)\n    if (minutes === 0) return '🚀 学習を始めよう！一緒に頑張るよ！'\n    if (minutes < 30) return `💪 ${minutes}分経過！この調子で続けよう！`\n    if (minutes < 60) return `✨ ${minutes}分頑張ってるね！素晴らしい集中力だよ！`\n    return `🔥 ${Math.floor(minutes / 60)}時間以上！本当に頑張ってるね！`\n  }\n\n  const splitThemes = (text: string) => {\n    return text\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter(Boolean)\n      .map((line) => line.replace(/^[-*•・]\\s*/, '').trim())\n      .filter(Boolean)\n  }\n\n  const getThemeKey = (taskId: string, theme: string) => `${taskId}::${theme}`\n\n  const formatReviewDate = (dateString?: string | null) => {\n    if (!dateString) return ''\n    const studyDay = getStudyDay(new Date(dateString))\n    const studyDate = getStudyDayDate(studyDay)\n    const today = getStudyDayDate(getStudyDay(new Date()))\n    const diffDays = Math.max(0, Math.round((today.getTime() - studyDate.getTime()) / 86400000))\n    return `${formatDateLabel(studyDate)}(${diffDays}日前)`\n  }\n\n  const pickBookImage = async () => {\n    const permission = await ImagePicker.requestMediaLibraryPermissionsAsync()\n    if (permission.status !== 'granted') {\n      Alert.alert('権限が必要です', '写真へのアクセスを許可してください。')\n      return\n    }\n    const result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\n      quality: 0.8,\n    })\n    if (!result.canceled && result.assets[0]?.uri) {\n      setNewBookImage(result.assets[0].uri)\n    }\n  }\n\n  const handleGenerateQuiz = async (task: ReviewTask, theme?: string) => {\n    if (!endpoint) return\n    const noteValue = task.study_logs?.note?.trim()\n    if (!noteValue) return\n    const themeValue = theme || noteValue\n    const difficultyKey = getThemeKey(task.id, themeValue)\n    const difficulty = difficultyByTheme[difficultyKey] || DEFAULT_DIFFICULTY\n    setQuizByTask((prev) => {\n      const current = prev[task.id]?.themes || {}\n      const existing = current[themeValue]\n      return {\n        ...prev,\n        [task.id]: {\n          themes: {\n            ...current,\n            [themeValue]: {\n              loading: true,\n              questions: existing?.questions || [],\n              answers: existing?.answers || {},\n            },\n          },\n        },\n      }\n    })\n    try {\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ note: themeValue, count: 1, difficulty }),\n      })\n      if (!response.ok) throw new Error('クイズの生成に失敗しました')\n      const data = await response.json()\n      const questions = (data.questions || []).map((q: QuizQuestion) => ({\n        ...q,\n        theme: themeValue,\n      }))\n      setQuizByTask((prev) => {\n        const current = prev[task.id]?.themes || {}\n        const existing = current[themeValue]\n        return {\n          ...prev,\n          [task.id]: {\n            themes: {\n              ...current,\n              [themeValue]: {\n                loading: false,\n                questions,\n                answers: existing?.answers || {},\n              },\n            },\n          },\n        }\n      })\n    } catch (_error) {\n      setQuizByTask((prev) => {\n        const next = { ...prev }\n        delete next[task.id]\n        return next\n      })\n      Alert.alert('エラー', 'クイズの生成に失敗しました。')\n    }\n  }\n\n  const handleAnswer = async (taskId: string, theme: string, qIndex: number, choiceIndex: number) => {\n    const quiz = quizByTask[taskId]\n    const themeQuiz = quiz?.themes[theme]\n    if (!themeQuiz || themeQuiz.loading) return\n    if (themeQuiz.answers[qIndex] !== undefined) return\n\n    const question = themeQuiz.questions[qIndex]\n    if (!question) return\n\n    const isCorrect = choiceIndex === question.correct_index\n    await supabase.from('quiz_attempts').insert({\n      user_id: userId,\n      review_task_id: taskId,\n      question: question.question,\n      choices: question.choices,\n      correct_index: question.correct_index,\n      selected_index: choiceIndex,\n      is_correct: isCorrect,\n    })\n\n    const nextAnswers = { ...themeQuiz.answers, [qIndex]: choiceIndex }\n    const nextThemes = { ...(quiz?.themes || {}), [theme]: { ...themeQuiz, answers: nextAnswers } }\n    setQuizByTask((prev) => ({ ...prev, [taskId]: { themes: nextThemes } }))\n\n    const task = reviewTasks.find((t) => t.id === taskId)\n    const allThemes = splitThemes(task?.study_logs?.note || '')\n    const hidden = skippedThemes[taskId] || []\n    const isComplete = allThemes.every((themeItem) => {\n      if (hidden.includes(themeItem)) return true\n      const state = nextThemes[themeItem]\n      if (!state || state.questions.length === 0) return false\n      return Object.keys(state.answers).length >= state.questions.length\n    })\n    if (isComplete) {\n      await supabase.from('review_tasks').update({ status: 'completed' }).eq('id', taskId)\n      setReviewTasks((prev) => prev.filter((t) => t.id !== taskId))\n    }\n  }\n\n  const handleSkipTask = async (taskId: string) => {\n    await supabase.from('review_tasks').update({ status: 'skipped' }).eq('id', taskId)\n    setReviewTasks((prev) => prev.filter((t) => t.id !== taskId))\n  }\n\n  const handleSkipTheme = (taskId: string, theme: string, remaining: string[]) => {\n    setSkippedThemes((prev) => {\n      const current = prev[taskId] || []\n      if (current.includes(theme)) return prev\n      return { ...prev, [taskId]: [...current, theme] }\n    })\n    setQuizByTask((prev) => {\n      const current = prev[taskId]\n      if (!current) return prev\n      const nextThemes = { ...current.themes }\n      delete nextThemes[theme]\n      return { ...prev, [taskId]: { themes: nextThemes } }\n    })\n    const nextRemaining = remaining.filter((t) => t !== theme)\n    if (nextRemaining.length === 0) handleSkipTask(taskId)\n  }\n\n  return (\n    <KeyboardAvoidingView\n      style={styles.screen}\n      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\n      keyboardVerticalOffset={80}\n    >\n      <ScrollView contentContainerStyle={styles.container} keyboardShouldPersistTaps=\"handled\">\n      <View style={styles.card}>\n        <Text style={styles.cardTitle}>教材選択</Text>\n        <Text style={styles.cardSubtitle}>学習する教材を選択してください</Text>\n        <View style={styles.rowBetween}>\n          <Text style={styles.mutedText}>{selectedBook ? selectedBook.name : '教材が未選択です'}</Text>\n          <Pressable style={styles.outlineButton} onPress={() => setShowBookPicker((prev) => !prev)}>\n            <Text style={styles.outlineButtonText}>{showBookPicker ? '閉じる' : '教材を選ぶ'}</Text>\n          </Pressable>\n        </View>\n        {showBookPicker && (\n          <View style={styles.bookPickerArea}>\n            <View style={styles.bookHeaderRow}>\n              <Text style={styles.bookHeaderText}>教材</Text>\n              <Pressable style={styles.addChipButton} onPress={() => setShowAddBookForm((prev) => !prev)}>\n                <Ionicons name=\"add\" size={16} color=\"#334155\" />\n                <Text style={styles.addChipText}>追加</Text>\n              </Pressable>\n            </View>\n            {showAddBookForm && (\n              <View style={styles.addCard}>\n                <Text style={styles.addCardTitle}>新しい教材を追加</Text>\n                <Text style={styles.label}>名前</Text>\n                <TextInput\n                  style={styles.input}\n                  placeholder=\"例: チャート式数学I\"\n                  value={newBookName}\n                  onChangeText={setNewBookName}\n                />\n                <Text style={styles.label}>画像（任意）</Text>\n                <Pressable style={styles.imageSelectButton} onPress={pickBookImage}>\n                  <Text style={styles.imageSelectText}>画像を選択</Text>\n                </Pressable>\n                <View style={styles.row}>\n                  <Pressable\n                    style={[styles.outlineButton, styles.flex]}\n                    onPress={() => {\n                      setShowAddBookForm(false)\n                      setNewBookName('')\n                      setNewBookImage(null)\n                    }}\n                  >\n                    <Text style={styles.outlineButtonText}>キャンセル</Text>\n                  </Pressable>\n                  <Pressable style={[styles.primaryButton, styles.flex]} onPress={handleAddBook}>\n                    <Text style={styles.primaryButtonText}>追加</Text>\n                  </Pressable>\n                </View>\n              </View>\n            )}\n            {loading ? (\n              <Text style={styles.mutedText}>読み込み中...</Text>\n            ) : (\n              <View style={styles.bookGrid}>\n                {referenceBooks.map((book) => (\n                  <View\n                    key={book.id}\n                    style={[\n                      styles.bookCard,\n                      selectedBookId === book.id && styles.bookCardActive,\n                    ]}\n                  >\n                    <Pressable style={styles.trashButton} onPress={() => handleDeleteBook(book.id)}>\n                      <Ionicons name=\"trash-outline\" size={14} color=\"#64748b\" />\n                    </Pressable>\n                    <Pressable\n                      style={styles.bookSelectArea}\n                      onPress={() => {\n                        if (isRunning) {\n                          Alert.alert('計測中は教材を変更できません')\n                          return\n                        }\n                        setSelectedBookId(book.id)\n                      }}\n                    >\n                      <View style={styles.bookImageBox}>\n                        {book.image_url ? (\n                          <Image source={{ uri: book.image_url }} style={styles.bookImage} />\n                        ) : (\n                          <Ionicons name=\"book-outline\" size={32} color=\"#94a3b8\" />\n                        )}\n                      </View>\n                      <Text style={styles.bookCardText}>{book.name}</Text>\n                    </Pressable>\n                  </View>\n                ))}\n              </View>\n            )}\n          </View>\n        )}\n      </View>\n\n      {successMessage && (\n        <View style={styles.successCard}>\n          <Text style={styles.successText}>{successMessage}</Text>\n        </View>\n      )}\n      {isRunning && seconds > 0 && (\n        <View style={styles.successCard}>\n          <Text style={styles.successText}>{getEncouragementMessage()}</Text>\n        </View>\n      )}\n\n      <View style={styles.card}>\n        <Text style={styles.cardTitle}>リアルタイム計測</Text>\n        <Text style={styles.timer}>{formatTimer(seconds)}</Text>\n        <Text style={styles.mutedText}>教材を選択してください</Text>\n        <Pressable\n          style={[styles.startButton, !selectedBookId && styles.startButtonDisabled]}\n          onPress={handleStart}\n          disabled={!selectedBookId}\n        >\n          <Ionicons name=\"play\" size={18} color=\"#fff\" />\n          <Text style={styles.startButtonText}>\n            {selectedBookId ? '開始' : '教材を選択してください'}\n          </Text>\n        </Pressable>\n        {isRunning && (\n          <View style={styles.row}>\n            <Pressable style={styles.outlineButton} onPress={handlePause}>\n              <Text style={styles.outlineButtonText}>一時停止</Text>\n            </Pressable>\n            <Pressable style={styles.primaryButton} onPress={handleStop}>\n              <Text style={styles.primaryButtonText}>停止・保存</Text>\n            </Pressable>\n          </View>\n        )}\n        <View style={styles.noteHeader}>\n          <Text style={styles.noteTitle}>学習メモ（復習カードで使います）</Text>\n          <Text style={styles.noteHelper}>\n            1つの入力欄＝1テーマです。なるべく具体的に書いてください。\n          </Text>\n        </View>\n        {notes.map((value, index) => (\n          <View key={`note-${index}`} style={styles.noteRow}>\n            <TextInput\n              style={[styles.input, styles.noteInput, styles.noteField]}\n              placeholder=\"例: 英文法の比較級。\"\n              value={value}\n              onChangeText={(text) => {\n                const next = [...notes]\n                next[index] = text\n                setNotes(next)\n              }}\n              multiline\n            />\n            <Pressable\n              style={styles.noteDeleteButton}\n              onPress={() => {\n                const next = notes.filter((_, i) => i !== index)\n                setNotes(next.length ? next : [''])\n              }}\n            >\n              <Ionicons name=\"trash-outline\" size={14} color=\"#94a3b8\" />\n            </Pressable>\n          </View>\n        ))}\n        <Pressable style={styles.addNoteButton} onPress={() => setNotes([...notes, ''])}>\n          <Ionicons name=\"add\" size={16} color=\"#334155\" />\n          <Text style={styles.addNoteText}>学習メモを追加</Text>\n        </Pressable>\n      </View>\n\n      <View style={styles.card}>\n        <Text style={styles.cardTitle}>復習カード</Text>\n        <Text style={styles.cardSubtitle}>忘却曲線に合わせて今日の復習を出題します</Text>\n        {reviewTasks.length === 0 && <Text style={styles.mutedText}>今日は復習タスクがありません</Text>}\n        {reviewTasks.map((task) => {\n          const quiz = quizByTask[task.id]\n          const themes = splitThemes(task.study_logs?.note || '')\n          const visibleThemes = themes.filter((theme) => !(skippedThemes[task.id] || []).includes(theme))\n          return (\n            <View key={task.id} style={styles.taskCard}>\n              {visibleThemes.map((theme, index) => {\n                const themeQuiz = quiz?.themes?.[theme]\n                const themeKey = getThemeKey(task.id, theme)\n                const selectedDifficulty = difficultyByTheme[themeKey] || DEFAULT_DIFFICULTY\n                return (\n                  <View key={`${task.id}-${index}`} style={styles.themeCard}>\n                    <View style={styles.themeHeader}>\n                      <Text style={styles.themeTitle}>{task.study_logs?.subject || '学習内容'}</Text>\n                      <Text style={styles.mutedText}>{formatReviewDate(task.study_logs?.started_at)}</Text>\n                    </View>\n                    <Text style={styles.mutedText}>{theme}</Text>\n                    <View style={styles.difficultyRow}>\n                      <Text style={styles.difficultyLabel}>難易度</Text>\n                      {[\n                        { key: 'easy' as Difficulty, label: '易しい' },\n                        { key: 'normal' as Difficulty, label: '普通' },\n                        { key: 'hard' as Difficulty, label: '難しい' },\n                      ].map((item) => (\n                        <Pressable\n                          key={item.key}\n                          style={[\n                            styles.difficultyButton,\n                            selectedDifficulty === item.key && styles.difficultyButtonActive,\n                          ]}\n                          onPress={() =>\n                            setDifficultyByTheme((prev) => ({ ...prev, [themeKey]: item.key }))\n                          }\n                        >\n                          <Text\n                            style={[\n                              styles.difficultyText,\n                              selectedDifficulty === item.key && styles.difficultyTextActive,\n                            ]}\n                          >\n                            {item.label}\n                          </Text>\n                        </Pressable>\n                      ))}\n                    </View>\n                    <Pressable style={styles.outlineButton} onPress={() => handleSkipTheme(task.id, theme, visibleThemes)}>\n                      <Text style={styles.outlineButtonText}>このテーマを消す</Text>\n                    </Pressable>\n                    {!themeQuiz && (\n                      <Pressable style={styles.outlineButton} onPress={() => handleGenerateQuiz(task, theme)}>\n                        <Text style={styles.outlineButtonText}>4択を作成（1問）</Text>\n                      </Pressable>\n                    )}\n                    {themeQuiz?.loading && <Text style={styles.mutedText}>クイズ作成中...</Text>}\n                    {themeQuiz?.questions?.length > 0 && (\n                      <View style={styles.quizBlock}>\n                        {themeQuiz.questions.map((q, qIndex) => {\n                          const answered = themeQuiz.answers[qIndex] !== undefined\n                          return (\n                            <View key={`${task.id}-${qIndex}`} style={styles.quizItem}>\n                              <Text style={styles.quizQuestion}>{qIndex + 1}. {q.question}</Text>\n                              {q.choices.map((choice, cIndex) => {\n                                const selected = themeQuiz.answers[qIndex] === cIndex\n                                const isCorrect = q.correct_index === cIndex\n                                return (\n                                  <Pressable\n                                    key={`${task.id}-${qIndex}-${cIndex}`}\n                                    onPress={() => handleAnswer(task.id, theme, qIndex, cIndex)}\n                                    disabled={answered}\n                                    style={[\n                                      styles.choiceButton,\n                                      selected && (isCorrect ? styles.choiceCorrect : styles.choiceWrong),\n                                    ]}\n                                  >\n                                    <Text style={styles.choiceText}>{choice}</Text>\n                                  </Pressable>\n                                )\n                              })}\n                              {answered && (\n                                <Text style={styles.mutedText}>\n                                  正解: {q.correct_index + 1}番\n                                </Text>\n                              )}\n                            </View>\n                          )\n                        })}\n                      </View>\n                    )}\n                  </View>\n                )\n              })}\n              {visibleThemes.length === 0 && (\n                <Text style={styles.mutedText}>この日の復習テーマはすべて非表示にしました</Text>\n              )}\n            </View>\n          )\n        })}\n      </View>\n      </ScrollView>\n    </KeyboardAvoidingView>\n  )\n}\n\nconst styles = StyleSheet.create({\n  screen: {\n    flex: 1,\n  },\n  container: {\n    padding: 16,\n    backgroundColor: '#f8fafc',\n    gap: 12,\n  },\n  card: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 16,\n    padding: 16,\n    backgroundColor: '#ffffff',\n    gap: 10,\n  },\n  cardTitle: {\n    fontSize: 18,\n    fontWeight: '700',\n  },\n  cardSubtitle: {\n    fontSize: 12,\n    color: '#94a3b8',\n  },\n  row: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 8,\n  },\n  rowBetween: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    gap: 8,\n  },\n  flex: {\n    flex: 1,\n  },\n  input: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 10,\n    paddingHorizontal: 12,\n    paddingVertical: 8,\n    fontSize: 14,\n  },\n  noteInput: {\n    minHeight: 80,\n    textAlignVertical: 'top',\n  },\n  noteHeader: {\n    marginTop: 4,\n    gap: 4,\n  },\n  noteTitle: {\n    fontSize: 13,\n    fontWeight: '700',\n    color: '#0f172a',\n  },\n  noteHelper: {\n    fontSize: 11,\n    color: '#64748b',\n  },\n  noteRow: {\n    position: 'relative',\n    marginTop: 8,\n  },\n  noteField: {\n    paddingRight: 36,\n  },\n  noteDeleteButton: {\n    position: 'absolute',\n    right: 8,\n    top: 8,\n    width: 24,\n    height: 24,\n    borderRadius: 6,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#f8fafc',\n  },\n  addNoteButton: {\n    marginTop: 8,\n    borderWidth: 1,\n    borderColor: '#cbd5f5',\n    borderRadius: 10,\n    paddingVertical: 8,\n    paddingHorizontal: 12,\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 6,\n    backgroundColor: '#f8fafc',\n    justifyContent: 'center',\n  },\n  addNoteText: {\n    fontSize: 12,\n    color: '#334155',\n    fontWeight: '600',\n  },\n  primaryButton: {\n    backgroundColor: '#2563eb',\n    paddingVertical: 10,\n    paddingHorizontal: 16,\n    borderRadius: 10,\n    alignItems: 'center',\n  },\n  primaryButtonText: {\n    color: '#ffffff',\n    fontWeight: '600',\n  },\n  outlineButton: {\n    borderWidth: 1,\n    borderColor: '#cbd5f5',\n    paddingVertical: 8,\n    paddingHorizontal: 12,\n    borderRadius: 10,\n    alignItems: 'center',\n  },\n  outlineButtonText: {\n    color: '#2563eb',\n    fontWeight: '600',\n    fontSize: 12,\n  },\n  bookPickerArea: {\n    gap: 8,\n    marginTop: 8,\n  },\n  bookHeaderRow: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    gap: 8,\n  },\n  bookHeaderText: {\n    fontSize: 16,\n    fontWeight: '700',\n  },\n  addChipButton: {\n    borderWidth: 1,\n    borderColor: '#dbeafe',\n    backgroundColor: '#f8fafc',\n    borderRadius: 10,\n    paddingHorizontal: 10,\n    paddingVertical: 6,\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 4,\n  },\n  addChipText: {\n    fontSize: 12,\n    color: '#334155',\n    fontWeight: '600',\n  },\n  addCard: {\n    borderWidth: 2,\n    borderColor: '#bfdbfe',\n    borderRadius: 12,\n    padding: 12,\n    backgroundColor: '#f8fafc',\n    gap: 8,\n  },\n  addCardTitle: {\n    fontSize: 14,\n    fontWeight: '700',\n  },\n  imageSelectButton: {\n    borderWidth: 1,\n    borderColor: '#cbd5f5',\n    borderRadius: 10,\n    paddingVertical: 10,\n    alignItems: 'center',\n    backgroundColor: '#f1f5f9',\n  },\n  imageSelectText: {\n    fontSize: 12,\n    color: '#334155',\n    fontWeight: '600',\n  },\n  bookGrid: {\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    gap: 12,\n  },\n  bookCard: {\n    width: '48%',\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 12,\n    padding: 12,\n    backgroundColor: '#ffffff',\n    position: 'relative',\n  },\n  bookCardActive: {\n    borderColor: '#2563eb',\n    shadowColor: '#93c5fd',\n    shadowOpacity: 0.4,\n    shadowRadius: 6,\n  },\n  bookSelectArea: {\n    alignItems: 'center',\n    gap: 8,\n  },\n  bookImageBox: {\n    width: 64,\n    height: 64,\n    borderRadius: 8,\n    backgroundColor: '#f1f5f9',\n    alignItems: 'center',\n    justifyContent: 'center',\n    overflow: 'hidden',\n  },\n  bookImage: {\n    width: 64,\n    height: 64,\n    resizeMode: 'cover',\n  },\n  bookCardText: {\n    fontSize: 13,\n    fontWeight: '600',\n    color: '#0f172a',\n  },\n  trashButton: {\n    position: 'absolute',\n    right: 8,\n    top: 8,\n    width: 22,\n    height: 22,\n    borderRadius: 6,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#f8fafc',\n    zIndex: 2,\n  },\n  deleteText: {\n    color: '#ef4444',\n    fontSize: 12,\n  },\n  mutedText: {\n    fontSize: 12,\n    color: '#64748b',\n  },\n  timer: {\n    fontSize: 42,\n    fontWeight: '700',\n    textAlign: 'center',\n    color: '#2563eb',\n  },\n  startButton: {\n    backgroundColor: '#7fb8e5',\n    paddingVertical: 12,\n    borderRadius: 12,\n    alignItems: 'center',\n    flexDirection: 'row',\n    justifyContent: 'center',\n    gap: 8,\n  },\n  startButtonDisabled: {\n    backgroundColor: '#cbd5e1',\n  },\n  startButtonText: {\n    color: '#ffffff',\n    fontWeight: '600',\n  },\n  successCard: {\n    backgroundColor: '#ecfdf3',\n    borderRadius: 12,\n    padding: 12,\n    borderWidth: 1,\n    borderColor: '#bbf7d0',\n  },\n  successText: {\n    color: '#166534',\n    fontSize: 13,\n    fontWeight: '600',\n  },\n  taskCard: {\n    marginTop: 12,\n    gap: 12,\n  },\n  themeCard: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 12,\n    padding: 12,\n    gap: 8,\n  },\n  themeHeader: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  themeTitle: {\n    fontSize: 13,\n    fontWeight: '600',\n  },\n  difficultyRow: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 6,\n    flexWrap: 'wrap',\n  },\n  difficultyLabel: {\n    fontSize: 12,\n    color: '#64748b',\n    marginRight: 4,\n  },\n  difficultyButton: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 10,\n    paddingHorizontal: 10,\n    paddingVertical: 6,\n    backgroundColor: '#f8fafc',\n  },\n  difficultyButtonActive: {\n    borderColor: '#2563eb',\n    backgroundColor: '#2563eb',\n  },\n  difficultyText: {\n    fontSize: 11,\n    color: '#334155',\n    fontWeight: '600',\n  },\n  difficultyTextActive: {\n    color: '#ffffff',\n  },\n  quizBlock: {\n    gap: 10,\n  },\n  quizItem: {\n    gap: 8,\n  },\n  quizQuestion: {\n    fontSize: 13,\n    fontWeight: '600',\n  },\n  choiceButton: {\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    borderRadius: 8,\n    padding: 8,\n  },\n  choiceCorrect: {\n    backgroundColor: '#dcfce7',\n    borderColor: '#22c55e',\n  },\n  choiceWrong: {\n    backgroundColor: '#fee2e2',\n    borderColor: '#ef4444',\n  },\n  choiceText: {\n    fontSize: 12,\n  },\n})\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\native\\src\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tsken\\Downloads\\AI-YOBIKOU-main (1)\\AI-YOBIKOU-main\\types\\database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]