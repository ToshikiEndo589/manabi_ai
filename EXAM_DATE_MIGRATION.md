# 試験日ベースの合格率計算への移行手順

## データベース更新

1. Supabaseダッシュボードにアクセス
2. SQL Editorを開く
3. 以下のSQLを実行:

```sql
-- profilesテーブルに試験日（exam_date）カラムを追加
ALTER TABLE profiles 
ADD COLUMN IF NOT EXISTS exam_date DATE;

-- 既存のユーザーにはデフォルトで2025年2月1日を設定
UPDATE profiles 
SET exam_date = '2025-02-01' 
WHERE exam_date IS NULL;
```

## 変更内容

### 1. 合格率計算ロジック
- **変更前**: 偏差値90% + 学習時間10%
- **変更後**: 偏差値100%（学習時間の影響なし）

### 2. 精度係数の導入
- 試験日までの残り日数に応じて、0.0〜1.0の精度係数を計算
- 精度が低い時（試験日が遠い）: 偏差値の変動幅を大きく見積もる
- 精度が高い時（試験日が近い）: 現在の偏差値をより正確に反映

### 3. 表示方法
- **精度が低い時（0.9未満）**: 「50-70%」のような幅で表示
- **精度が高い時（0.9以上）**: 「65%」のように単一値で表示

### 4. 新機能
- オンボーディング画面で試験年度を選択
- 設定画面で試験年度を変更可能
- ホーム画面で精度係数と残り日数を表示

## 精度係数の計算

```
残り365日以上: 精度30% → 偏差値±15の幅
残り180日: 精度50% → 偏差値±10の幅
残り90日: 精度70% → 偏差値±7の幅
残り30日: 精度90% → 偏差値±3の幅
残り7日以下: 精度100% → 現在の偏差値をそのまま使用
```

## 動作確認

1. オンボーディング画面で試験年度を選択できることを確認
2. ホーム画面で合格率が幅表示または単一値で表示されることを確認
3. 設定画面で試験年度を変更できることを確認
4. 合格率説明ページで精度係数が正しく表示されることを確認
